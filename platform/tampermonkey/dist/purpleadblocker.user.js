// ==UserScript==
// @name         Purple Adblocker
// @source       https://github.com/arthurbolsoni/Purple-adblock
// @version      2.6.0
// @description  Per aspera ad astra
// @author       ArthurBolzoni
// @downloadURL  https://raw.githubusercontent.com/arthurbolsoni/Purple-adblock/main/tampermonkey/dist/purpleadblocker.user.js
// @updateURL    https://raw.githubusercontent.com/arthurbolsoni/Purple-adblock/main/tampermonkey/dist/purpleadblocker.user.js
// @match        *://*.twitch.tv/*
// @run-at       document-start
// @grant        none
// ==/UserScript==

/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
//this line gonna import the content from compile worker as string
//@ts-expect-error
const app_worker_js_1 = __importDefault(__webpack_require__(/*! ../dist/app.worker.js */ "./dist/app.worker.js"));
(function () {
    let mainWorker;
    window.Worker = class WorkerInjector extends Worker {
        constructor(twitchBlobUrl) {
            console.log("new worker intance " + twitchBlobUrl);
            if (twitchBlobUrl == "")
                super(twitchBlobUrl);
            console.log("[Purple]: init " + twitchBlobUrl);
            const newBlobStr = `${app_worker_js_1.default}
      importScripts('${twitchBlobUrl}');`;
            super(URL.createObjectURL(new Blob([newBlobStr], { type: "text/javascript" })));
            mainWorker = this;
            mainWorker.declareEventWorker();
            mainWorker.declareEventWindow();
            mainWorker.integrity();
        }
        integrity() {
            return __awaiter(this, void 0, void 0, function* () {
                __webpack_require__.g.request = fetch;
                __webpack_require__.g.fetch = (url, options) => __awaiter(this, void 0, void 0, function* () {
                    const response = yield __webpack_require__.g.request(url, options);
                    const body = yield response.text();
                    if (url == "https://gql.twitch.tv/integrity") {
                        mainWorker.postMessage({ funcName: "setIntegrity", value: body });
                    }
                    return new Response(body, response);
                });
            });
        }
        declareEventWorker() {
            this.addEventListener("message", (event) => {
                var _a, _b, _c, _d, _e;
                switch ((_a = event === null || event === void 0 ? void 0 : event.data) === null || _a === void 0 ? void 0 : _a.type) {
                    case "getSettings": {
                        window.postMessage({ type: "getSettings", value: null });
                        break;
                    }
                    case "PlayerQualityChanged": {
                        mainWorker.postMessage({ funcName: "setQuality", value: event.data.arg.name });
                        break;
                    }
                    case "pause": {
                        mainWorker.postMessage({ funcName: "pause", args: undefined, id: 1 });
                        break;
                    }
                    case "play": {
                        mainWorker.postMessage({ funcName: "play", args: undefined, id: 1 });
                        break;
                    }
                    default: {
                        break;
                    }
                }
                switch ((_c = (_b = event === null || event === void 0 ? void 0 : event.data) === null || _b === void 0 ? void 0 : _b.arg) === null || _c === void 0 ? void 0 : _c.key) {
                    case "quality": {
                        if (!event.data.arg.value.name)
                            break;
                        console.log("Changed quality by player: " + event.data.arg.value.name);
                        mainWorker.postMessage({ funcName: "setQuality", value: event.data.arg.value.name });
                        break;
                    }
                    case "state": {
                        mainWorker.postMessage({ funcName: event.data.arg.value });
                    }
                    default: {
                        break;
                    }
                }
                switch ((_e = (_d = event === null || event === void 0 ? void 0 : event.data) === null || _d === void 0 ? void 0 : _d.arg) === null || _e === void 0 ? void 0 : _e.name) {
                    case "pause": {
                        break;
                    }
                    case "play": {
                        break;
                    }
                    default: {
                        break;
                    }
                }
            });
        }
        declareEventWindow() {
            //Event listener from window and extension.
            window.addEventListener("message", (event) => {
                switch (event.data.type) {
                    case "setSettings": {
                        //send settings to worker
                        mainWorker.postMessage({ funcName: "setSettings", value: event.data.value });
                    }
                }
            });
        }
    };
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSxrRUFBa0U7QUFDbEUsa0JBQWtCO0FBQ2xCLDBFQUF3QztBQUV4QyxDQUFDO0lBQ0MsSUFBSSxVQUFlLENBQUM7SUFFcEIsTUFBTSxDQUFDLE1BQU0sR0FBRyxNQUFNLGNBQWUsU0FBUSxNQUFNO1FBQ2pELFlBQVksYUFBa0I7WUFDNUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsR0FBRyxhQUFhLENBQUMsQ0FBQztZQUVuRCxJQUFJLGFBQWEsSUFBSSxFQUFFO2dCQUFFLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUM5QyxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixHQUFHLGFBQWEsQ0FBQyxDQUFDO1lBRS9DLE1BQU0sVUFBVSxHQUFHLEdBQUcsdUJBQUc7dUJBQ1IsYUFBYSxLQUFLLENBQUM7WUFFcEMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hGLFVBQVUsR0FBRyxJQUFJLENBQUM7WUFDbEIsVUFBVSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDaEMsVUFBVSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDaEMsVUFBVSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ3pCLENBQUM7UUFFSyxTQUFTOztnQkFDYixNQUFNLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQTtnQkFDdEIsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFPLEdBQVEsRUFBRSxPQUFZLEVBQUUsRUFBRTtvQkFDOUMsTUFBTSxRQUFRLEdBQUcsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztvQkFDcEQsTUFB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

/***/ }),

/***/ "./dist/app.worker.js":
/*!****************************!*\
  !*** ./dist/app.worker.js ***!
  \****************************/
/***/ ((module) => {

module.exports = "/******/ (() => { // webpackBootstrap\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ \"./src/app.controller.ts\":\n/*!*******************************!*\\\n  !*** ./src/app.controller.ts ***!\n  \\*******************************/\n/***/ (function(__unused_webpack_module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\r\nexports.AppController = void 0;\r\nconst controller_decorator_1 = __webpack_require__(/*! ./decorator/controller.decorator */ \"./src/decorator/controller.decorator.ts\");\r\nconst handler_decorator_1 = __webpack_require__(/*! ./decorator/handler.decorator */ \"./src/decorator/handler.decorator.ts\");\r\nconst stream_enum_1 = __webpack_require__(/*! ./modules/stream/interface/stream.enum */ \"./src/modules/stream/interface/stream.enum.ts\");\r\nlet AppController = class AppController {\r\n    constructor(appService) {\r\n        this.appService = appService;\r\n        this.getSettings = () => __webpack_require__.g.postMessage({ type: \"getSettings\" });\r\n        this.getSettings();\r\n    }\r\n    setIntegrity(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.appService.setIntegrityToken(JSON.parse(data.value).token);\r\n        });\r\n    }\r\n    onChannel(url, options) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const response = yield __webpack_require__.g.request(url, options);\r\n            if (!response.ok) {\r\n                console.log(\"Error on channel load\");\r\n                return response;\r\n            }\r\n            const text = yield response.text();\r\n            const channelName = /hls\\/(.*).m3u8/gm.exec(url) || [];\r\n            yield this.appService.setChannel(channelName[1]);\r\n            return new Response(text);\r\n        });\r\n    }\r\n    onFetch(url, options) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const body = yield (yield request(url, options)).text();\r\n            const playlist = yield this.appService.onFetch(body);\r\n            return new Response(playlist);\r\n        });\r\n    }\r\n    onChannelPicture(url, options) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const response = yield __webpack_require__.g.request(url, options);\r\n            if (!response.ok) {\r\n                console.log(\"Error on channel load\");\r\n                return response;\r\n            }\r\n            const text = yield response.text();\r\n            yield this.appService.currentStream().setStreamAccess(text, stream_enum_1.StreamType.PICTURE);\r\n            console.log(\"picture-by-picture\", text);\r\n            return new Response();\r\n        });\r\n    }\r\n    setSettings(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.appService.setSettings(data);\r\n        });\r\n    }\r\n    setQuality(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.appService.quality = data.value;\r\n        });\r\n    }\r\n};\r\n__decorate([\r\n    (0, handler_decorator_1.Message)(\"setIntegrity\")\r\n], AppController.prototype, \"setIntegrity\", null);\r\n__decorate([\r\n    (0, handler_decorator_1.Fetch)(\"usher.ttvnw.net/api/channel/hls/\", \"picture-by-picture\")\r\n], AppController.prototype, \"onChannel\", null);\r\n__decorate([\r\n    (0, handler_decorator_1.Fetch)(\"hls.ttvnw.net/v1/playlist/\")\r\n], AppController.prototype, \"onFetch\", null);\r\n__decorate([\r\n    (0, handler_decorator_1.Fetch)(\"picture-by-picture\")\r\n], AppController.prototype, \"onChannelPicture\", null);\r\n__decorate([\r\n    (0, handler_decorator_1.Message)(\"setSettings\")\r\n], AppController.prototype, \"setSettings\", null);\r\n__decorate([\r\n    (0, handler_decorator_1.Message)(\"setQuality\")\r\n], AppController.prototype, \"setQuality\", null);\r\nAppController = __decorate([\r\n    (0, controller_decorator_1.Controller)()\r\n], AppController);\r\nexports.AppController = AppController;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvYXBwLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkVBQThEO0FBQzlELHFFQUErRDtBQUUvRCx3RUFBb0U7QUFHcEUsSUFBYSxhQUFhLEdBQTFCLE1BQWEsYUFBYTtJQUd4QixZQUE2QixVQUFrQjtRQUFsQixlQUFVLEdBQVYsVUFBVSxDQUFRO1FBRi9DLGdCQUFXLEdBQUcsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsQ0FBQyxDQUFDO1FBRzlELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNyQixDQUFDO0lBR0ssWUFBWSxDQUFDLElBQVM7O1lBQzFCLElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEUsQ0FBQztLQUFBO0lBR0ssU0FBUyxDQUFDLEdBQVcsRUFBRSxPQUFZOztZQUN2QyxNQUFNLFFBQVEsR0FBYSxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzlELElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFO2dCQUNoQixPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUM7Z0JBQ3JDLE9BQU8sUUFBUSxDQUFDO2FBQ2pCO1lBRUQsTUFBTSxJQUFJLEdBQUcsTUFBTSxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDbkMsTUFBTSxXQUFXLEdBQUcsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUV2RCxNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pELE9BQU8sSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUIsQ0FBQztLQUFBO0lBR0ssT0FBTyxDQUFDLEdBQVcsRUFBRSxPQUFZOztZQUNyQyxNQUFNLElBQUksR0FBVyxNQUFNLENBQUMsTUFBTSxPQUFPLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDaEUsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNyRCxPQUFPLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hDLENBQUM7S0FBQTtJQUdLLGdCQUFnQixDQUFDLEdBQVcsRUFBRSxPQUFZOztZQUM5QyxNQUFNLFFBQVEsR0FBYSxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzlELElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFO2dCQUNoQixPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUM7Z0JBQ3JDLE9BQU8sUUFBUSxDQUFDO2FBQ2pCO1lBRUQsTUFBTSxJQUFJLEdBQUcsTUFBTSxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7WUFFbkMsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsd0JBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNoRixPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3hDLE9BQU8sSUFBSSxRQUFRLEVBQUUsQ0FBQztRQUN4QixDQUFDO0tBQUE7SUFHSyxXQUFXLENBQUMsSUFBUzs7WUFDekIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEMsQ0FBQztLQUFBO0lBR0ssVUFBVSxDQUFDLElBQVM7O1lBQ3hCLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDdkMsQ0FBQztLQUFBO0NBQ0YsQ0FBQTtBQWxEQztJQURDLElBQUEsMkJBQU8sRUFBQyxjQUFjLENBQUM7aURBR3ZCO0FBR0Q7SUFEQyxJQUFBLHlCQUFLLEVBQUMsa0NBQWtDLEVBQUUsb0JBQW9CLENBQUM7OENBYS9EO0FBR0Q7SUFEQyxJQUFBLHlCQUFLLEVBQUMsNEJBQTRCLENBQUM7NENBS25DO0FBR0Q7SUFEQyxJQUFBLHlCQUFLLEVBQUMsb0JBQW9CLENBQUM7cURBYTNCO0FBR0Q7SUFEQyxJQUFBLDJCQUFPLEVBQUMsYUFBYSxDQUFDO2dEQUd0QjtBQUdEO0lBREMsSUFBQSwyQkFBTyxFQUFDLFlBQVksQ0FBQzsrQ0FHckI7QUF6RFUsYUFBYTtJQUR6QixJQUFBLGlDQUFVLEdBQUU7R0FDQSxhQUFhLENBMER6QjtBQTFEWSxzQ0FBYSJ9\n\n/***/ }),\n\n/***/ \"./src/app.worker.ts\":\n/*!***************************!*\\\n  !*** ./src/app.worker.ts ***!\n  \\***************************/\n/***/ (function(__unused_webpack_module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\r\nconst app_controller_1 = __webpack_require__(/*! ./app.controller */ \"./src/app.controller.ts\");\r\nconst player_1 = __webpack_require__(/*! ./modules/player/player */ \"./src/modules/player/player.ts\");\r\nfunction app() {\r\n    __webpack_require__.g.logPrint = (x) => console.log(\"[Purple]: \", x);\r\n    __webpack_require__.g.appController = new app_controller_1.AppController(new player_1.Player());\r\n    __webpack_require__.g.logPrint(\"Script running\");\r\n}\r\nexports[\"default\"] = app;\r\n__webpack_require__.g.request = __webpack_require__.g.fetch;\r\n__webpack_require__.g.fetch = (url, options) => __awaiter(void 0, void 0, void 0, function* () {\r\n    if (typeof url === \"string\") {\r\n        for (var i = 0, len = routerList.length; i < len; i++) {\r\n            if (url.includes(routerList[i].match) && !url.includes(routerList[i].ignore)) {\r\n                return __webpack_require__.g.appController[routerList[i].propertyKey](url, options);\r\n            }\r\n        }\r\n    }\r\n    return __webpack_require__.g.request.apply(this, [url, options]);\r\n});\r\napp();\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLndvcmtlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAud29ya2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEscURBQWlEO0FBQ2pELG9EQUFpRDtBQVNqRCxTQUF3QixHQUFHO0lBQ3pCLE1BQU0sQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFNLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzNELE1BQU0sQ0FBQyxhQUFhLEdBQUcsSUFBSSw4QkFBYSxDQUFDLElBQUksZUFBTSxFQUFFLENBQUMsQ0FBQztJQUV2RCxNQUFNLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFDcEMsQ0FBQztBQUxELHNCQUtDO0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQzlCLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBTyxHQUFRLEVBQUUsT0FBWSxFQUFFLEVBQUU7SUFDOUMsSUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFRLEVBQUU7UUFDM0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNyRCxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTyxDQUFDLEVBQUU7Z0JBQzdFLE9BQU8sTUFBTSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO2FBQ3RFO1NBQ0Y7S0FDRjtJQUNELE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDcEQsQ0FBQyxDQUFBLENBQUM7QUFFRixHQUFHLEVBQUUsQ0FBQyJ9\n\n/***/ }),\n\n/***/ \"./src/decorator/controller.decorator.ts\":\n/*!***********************************************!*\\\n  !*** ./src/decorator/controller.decorator.ts ***!\n  \\***********************************************/\n/***/ ((__unused_webpack_module, exports) => {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\r\nexports.Controller = void 0;\r\nconst Controller = () => {\r\n    return (target) => { };\r\n};\r\nexports.Controller = Controller;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5kZWNvcmF0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGVjb3JhdG9yL2NvbnRyb2xsZXIuZGVjb3JhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFPLE1BQU0sVUFBVSxHQUFHLEdBQW1CLEVBQUU7SUFDN0MsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLEdBQUUsQ0FBQyxDQUFDO0FBQ3hCLENBQUMsQ0FBQztBQUZXLFFBQUEsVUFBVSxjQUVyQiJ9\n\n/***/ }),\n\n/***/ \"./src/decorator/handler.decorator.ts\":\n/*!********************************************!*\\\n  !*** ./src/decorator/handler.decorator.ts ***!\n  \\********************************************/\n/***/ ((__unused_webpack_module, exports, __webpack_require__) => {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\r\nexports.Message = exports.Fetch = void 0;\r\nconst Fetch = (match, ignore = null) => {\r\n    return (target, propertyKey) => {\r\n        if (!__webpack_require__.g.routerList)\r\n            __webpack_require__.g.routerList = [];\r\n        __webpack_require__.g.routerList.push({ propertyKey: propertyKey, match: match, ignore: ignore });\r\n    };\r\n};\r\nexports.Fetch = Fetch;\r\nconst Message = (match) => {\r\n    return (target, propertyKey) => {\r\n        __webpack_require__.g.addEventListener(\"message\", (e) => {\r\n            var _a;\r\n            if (((_a = e === null || e === void 0 ? void 0 : e.data) === null || _a === void 0 ? void 0 : _a.funcName) == match) {\r\n                __webpack_require__.g.appController[propertyKey](e.data);\r\n            }\r\n        });\r\n    };\r\n};\r\nexports.Message = Message;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFuZGxlci5kZWNvcmF0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGVjb3JhdG9yL2hhbmRsZXIuZGVjb3JhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFPLE1BQU0sS0FBSyxHQUFHLENBQUMsS0FBYSxFQUFFLFNBQXdCLElBQUksRUFBbUIsRUFBRTtJQUNwRixPQUFPLENBQUMsTUFBTSxFQUFFLFdBQVcsRUFBRSxFQUFFO1FBQzdCLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVTtZQUFFLE1BQU0sQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQy9DLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsV0FBVyxFQUFFLFdBQXFCLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUMvRixDQUFDLENBQUM7QUFDSixDQUFDLENBQUM7QUFMVyxRQUFBLEtBQUssU0FLaEI7QUFFSyxNQUFNLE9BQU8sR0FBRyxDQUFDLEtBQWEsRUFBbUIsRUFBRTtJQUN4RCxPQUFPLENBQUMsTUFBTSxFQUFFLFdBQVcsRUFBRSxFQUFFO1FBQzdCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFNLEVBQUUsRUFBRTs7WUFDNUMsSUFBSSxDQUFBLE1BQUEsQ0FBQyxhQUFELENBQUMsdUJBQUQsQ0FBQyxDQUFFLElBQUksMENBQUUsUUFBUSxLQUFJLEtBQUssRUFBRTtnQkFDOUIsTUFBTSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDM0M7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQztBQVJXLFFBQUEsT0FBTyxXQVFsQiJ9\n\n/***/ }),\n\n/***/ \"./src/modules/player/player.ts\":\n/*!**************************************!*\\\n  !*** ./src/modules/player/player.ts ***!\n  \\**************************************/\n/***/ (function(__unused_webpack_module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\r\nexports.Player = void 0;\r\nconst stream_1 = __webpack_require__(/*! ../stream/stream */ \"./src/modules/stream/stream.ts\");\r\nconst stream_enum_1 = __webpack_require__(/*! ../stream/interface/stream.enum */ \"./src/modules/stream/interface/stream.enum.ts\");\r\nconst m3u8_parser_1 = __webpack_require__(/*! m3u8-parser */ \"./node_modules/m3u8-parser/dist/m3u8-parser.es.js\");\r\nclass Player {\r\n    constructor() {\r\n        this.integrityToken = \"\"; //the integrity token\r\n        this.streamList = []; //the list of streams that are currently being played\r\n        this.actualChannel = \"\"; //the channel\r\n        this.playingAds = false; //if the stream is playing ads\r\n        this.quality = \"\"; //the quality of the stream\r\n        this.getQuality = () => __webpack_require__.g.postMessage({ type: \"getQuality\" });\r\n        this.getSettings = () => __webpack_require__.g.postMessage({ type: \"getSettings\" });\r\n        this.pause = () => __webpack_require__.g.postMessage({ type: \"pause\" });\r\n        this.play = () => __webpack_require__.g.postMessage({ type: \"play\" });\r\n        this.setSettings = (setting) => {\r\n            this.setting = setting;\r\n            logPrint(\"Settings loaded\");\r\n        };\r\n        this.setIntegrityToken = (integrityToken) => this.integrityToken = integrityToken;\r\n        this.pauseAndPlay = () => __awaiter(this, void 0, void 0, function* () {\r\n            this.pause();\r\n            yield new Promise(resolve => setTimeout(resolve, 500));\r\n            this.play();\r\n        });\r\n        this.onStartAds = () => {\r\n            console.log(\"ads started\");\r\n            this.pauseAndPlay();\r\n            this.pauseAndPlay();\r\n        };\r\n        this.onEndAds = () => {\r\n            console.log(\"ads ended\");\r\n            this.pauseAndPlay();\r\n            this.pauseAndPlay();\r\n        };\r\n        this.isAds = (x, allowChange = false) => {\r\n            const ads = this.hasAds(x);\r\n            if (!allowChange)\r\n                return ads;\r\n            if (this.playingAds == false && this.playingAds != ads)\r\n                this.onStartAds();\r\n            if (this.playingAds == true && this.playingAds != ads)\r\n                this.onEndAds();\r\n            this.playingAds = ads;\r\n            return this.playingAds;\r\n        };\r\n        this.hasAds = (x) => (x === null || x === void 0 ? void 0 : x.toString().includes(\"stitched\")) || (x === null || x === void 0 ? void 0 : x.toString().includes(\"Amazon\")) || (x === null || x === void 0 ? void 0 : x.toString().includes(\"DCM,\"));\r\n        this.currentStream = (channel = this.actualChannel) => {\r\n            var _a;\r\n            return (_a = this.streamList) === null || _a === void 0 ? void 0 : _a.find((x) => x.channelName === channel);\r\n        };\r\n    }\r\n    isWhitelist() {\r\n        var _a, _b;\r\n        return ((_b = (_a = this.setting) === null || _a === void 0 ? void 0 : _a.whitelist) === null || _b === void 0 ? void 0 : _b.includes(this.actualChannel)) || false;\r\n    }\r\n    onFetch(text) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (this.isWhitelist())\r\n                return text;\r\n            if (!this.isAds(text, true))\r\n                return this.mergeM3u8Contents([text]);\r\n            let dump = [];\r\n            const frontpage = yield this.fetchm3u8ByStreamType(stream_enum_1.StreamType.FRONTPAGE);\r\n            if (!frontpage.data)\r\n                this.currentStream().createStreamAccess(stream_enum_1.StreamType.FRONTPAGE, this.integrityToken);\r\n            if (frontpage.data)\r\n                dump.push(...frontpage.dump);\r\n            const picture = yield this.fetchm3u8ByStreamType(stream_enum_1.StreamType.PICTURE);\r\n            if (!picture.data)\r\n                this.currentStream().createStreamAccess(stream_enum_1.StreamType.PICTURE, this.integrityToken);\r\n            if (picture.data)\r\n                return Promise.resolve((_b = (_a = picture.dump) === null || _a === void 0 ? void 0 : _a[0]) !== null && _b !== void 0 ? _b : \"\");\r\n            return dump.length != 0 ? this.mergeM3u8Contents([text, ...dump]) : text;\r\n        });\r\n    }\r\n    generateM3u8(manifest) {\r\n        let m3u8Content = `#EXTM3U\\n`;\r\n        if (manifest.targetDuration) {\r\n            m3u8Content += `#EXT-X-TARGETDURATION:${manifest.targetDuration}\\n`;\r\n        }\r\n        if (manifest.mediaSequence) {\r\n            m3u8Content += `#EXT-X-MEDIA-SEQUENCE:${manifest.mediaSequence}\\n`;\r\n        }\r\n        if (manifest.segments) {\r\n            manifest.segments.forEach((segment) => {\r\n                if (segment.duration) {\r\n                    m3u8Content += `#EXTINF:${segment.duration}`;\r\n                    m3u8Content += `\\n`;\r\n                }\r\n                m3u8Content += `${segment.uri}\\n`;\r\n            });\r\n        }\r\n        return m3u8Content;\r\n    }\r\n    mergeM3u8Contents(conteudosM3u8) {\r\n        const manifestos = conteudosM3u8.map((conteudo) => {\r\n            const analisador = new m3u8_parser_1.Parser();\r\n            analisador.push(conteudo);\r\n            analisador.end();\r\n            // extract titles from #EXTINF tags in each segment\r\n            const manifest = analisador.manifest;\r\n            if (manifest.segments) {\r\n                manifest.segments.forEach((segment) => {\r\n                    // Find the #EXTINF tag associated with the current segment\r\n                    const extinfTagRegex = new RegExp(`#EXTINF:([0-9.]*)?,?(.*)(?:\\n|\\r\\n)${segment.uri}`);\r\n                    const match = conteudo.match(extinfTagRegex);\r\n                    if (match) {\r\n                        segment.title = match[2] ? match[2].trim() : \"\";\r\n                    }\r\n                });\r\n            }\r\n            return manifest;\r\n        });\r\n        const manifestoPrincipal = manifestos[0];\r\n        const manifestosSuporte = manifestos.slice(1);\r\n        if (manifestoPrincipal.segments) {\r\n            console.log(\"Segmentos encontrados no manifesto principal:\", manifestoPrincipal.segments.length);\r\n            console.log(\"Manifestos de suporte encontrados:\", manifestosSuporte.length);\r\n            let segmentRemoved = 0;\r\n            let segmentRepleced = 0;\r\n            // Percorrer os segmentos do manifesto principal e preencher as lacunas com os segmentos do manifesto de suporte\r\n            for (let i = 0; i < manifestoPrincipal.segments.length; i++) {\r\n                const segmentoPrincipal = manifestoPrincipal.segments[i];\r\n                let isChanged = false;\r\n                if (this.hasAds(segmentoPrincipal.title)) {\r\n                    manifestosSuporte.forEach((manifestoSuporte) => {\r\n                        var _a;\r\n                        // Encontre o primeiro segmento de suporte que NÃO contenha o título \"Amazon\" e tenha um tempo semelhante ao segmentoPrincipal (ignorando milissegundos)\r\n                        const segmentoSuporte = (_a = manifestoSuporte === null || manifestoSuporte === void 0 ? void 0 : manifestoSuporte.segments) === null || _a === void 0 ? void 0 : _a.find((seg) => {\r\n                            if (this.hasAds(seg.title))\r\n                                return false;\r\n                            const dataPrincipal = new Date(segmentoPrincipal.dateTimeString);\r\n                            const dataSuporte = new Date(seg.dateTimeString);\r\n                            dataPrincipal.setMilliseconds(0);\r\n                            dataSuporte.setMilliseconds(0);\r\n                            return dataPrincipal.getTime() === dataSuporte.getTime();\r\n                        });\r\n                        if (segmentoSuporte) {\r\n                            // Substitua o segmento principal pelo segmento de suporte\r\n                            manifestoPrincipal.segments[i] = segmentoSuporte;\r\n                            isChanged = true;\r\n                        }\r\n                    });\r\n                    // Se o segmento principal ainda contiver o título \"Amazon\", remova-o\r\n                    if (!isChanged) {\r\n                        manifestoPrincipal.segments.splice(i, 1);\r\n                        i--;\r\n                        segmentRemoved++;\r\n                    }\r\n                    if (isChanged) {\r\n                        segmentRepleced++;\r\n                    }\r\n                }\r\n            }\r\n            console.log(\"Segmento com ads removidos:\", segmentRemoved);\r\n            console.log(\"Segmento com ads substituídos:\", segmentRepleced);\r\n        }\r\n        // Criar uma nova lista de reprodução M3U8 com os segmentos mesclados\r\n        const conteudoM3u8Mesclado = this.generateM3u8(manifestoPrincipal);\r\n        // console.log(\"Conteúdo M3U8 mesclado:\", conteudoM3u8Mesclado);\r\n        return conteudoM3u8Mesclado;\r\n    }\r\n    fetchm3u8ByStreamType(accessType) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            logPrint(\"Stream Type: \" + accessType);\r\n            let dump = [];\r\n            let servers = this.currentStream().getStreamByStreamType(accessType);\r\n            for (const server of servers) {\r\n                //filter server url by quality or bestquality\r\n                const streamUrl = server.findByQuality(this.quality) || server.bestQuality();\r\n                //try get m3u8 content and return if don't have ads.\r\n                const text = yield (yield __webpack_require__.g.request(streamUrl === null || streamUrl === void 0 ? void 0 : streamUrl.url)).text();\r\n                dump.push(text);\r\n                if (this.isAds(text)) {\r\n                    logPrint(\"Stream Type: \" + accessType + \" - Ads found\");\r\n                    this.currentStream().removeServer(server);\r\n                    continue;\r\n                }\r\n                return { data: text, dump: dump };\r\n            }\r\n            return { data: null, dump: dump };\r\n        });\r\n    }\r\n    setChannel(channelName) {\r\n        logPrint(\"Loading channel\", channelName);\r\n        this.actualChannel = channelName;\r\n        let currentStream = this.streamList.find((stream) => stream.channelName === channelName);\r\n        if (!currentStream) {\r\n            currentStream = new stream_1.Stream(channelName);\r\n            this.streamList.push(currentStream);\r\n        }\r\n    }\r\n}\r\nexports.Player = Player;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZHVsZXMvcGxheWVyL3BsYXllci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSw2Q0FBMEM7QUFFMUMsaUVBQTZEO0FBRTdELDZDQUFxQztBQUVyQyxNQUFhLE1BQU07SUFBbkI7UUFDRSxtQkFBYyxHQUFHLEVBQUUsQ0FBQyxDQUFDLHFCQUFxQjtRQUUxQyxlQUFVLEdBQWEsRUFBRSxDQUFDLENBQUMscURBQXFEO1FBQ2hGLGtCQUFhLEdBQVcsRUFBRSxDQUFDLENBQUMsYUFBYTtRQUN6QyxlQUFVLEdBQUcsS0FBSyxDQUFDLENBQUMsOEJBQThCO1FBRWxELFlBQU8sR0FBVyxFQUFFLENBQUMsQ0FBQywyQkFBMkI7UUFFakQsZUFBVSxHQUFHLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQztRQUM5RCxnQkFBVyxHQUFHLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLENBQUMsQ0FBQztRQUNoRSxVQUFLLEdBQUcsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQ3BELFNBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFFbEQsZ0JBQVcsR0FBRyxDQUFDLE9BQWdCLEVBQUUsRUFBRTtZQUNqQyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUN2QixRQUFRLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM5QixDQUFDLENBQUM7UUFFRixzQkFBaUIsR0FBRyxDQUFDLGNBQXNCLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDO1FBRXJGLGlCQUFZLEdBQUcsR0FBUyxFQUFFO1lBQ3hCLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNiLE1BQU0sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2QsQ0FBQyxDQUFBLENBQUM7UUFFRixlQUFVLEdBQUcsR0FBRyxFQUFFO1lBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN0QixDQUFDLENBQUM7UUFDRixhQUFRLEdBQUcsR0FBRyxFQUFFO1lBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN6QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDcEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3RCLENBQUMsQ0FBQztRQUVGLFVBQUssR0FBRyxDQUFDLENBQVMsRUFBRSxjQUF1QixLQUFLLEVBQUUsRUFBRTtZQUNsRCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNCLElBQUksQ0FBQyxXQUFXO2dCQUFFLE9BQU8sR0FBRyxDQUFDO1lBQzdCLElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxHQUFHO2dCQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUMxRSxJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksR0FBRztnQkFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDdkUsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUM7WUFFdEIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3pCLENBQUMsQ0FBQztRQUVGLFdBQU0sR0FBRyxDQUFDLENBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQSxDQUFDLGFBQUQsQ0FBQyx1QkFBRCxDQUFDLENBQUUsUUFBUSxHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUMsTUFBSSxDQUFDLGFBQUQsQ0FBQyx1QkFBRCxDQUFDLENBQUUsUUFBUSxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQSxLQUFJLENBQUMsYUFBRCxDQUFDLHVCQUFELENBQUMsQ0FBRSxRQUFRLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUM7UUFFakksa0JBQWEsR0FBRyxDQUFDLFVBQWtCLElBQUksQ0FBQyxhQUFhLEVBQVUsRUFBRTs7WUFDL0QsT0FBTyxNQUFBLElBQUksQ0FBQyxVQUFVLDBDQUFFLElBQUksQ0FBQyxDQUFDLENBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsS0FBSyxPQUFPLENBQUUsQ0FBQztRQUMxRSxDQUFDLENBQUM7SUFzS0osQ0FBQztJQXBLQyxXQUFXOztRQUNULE9BQU8sQ0FBQSxNQUFBLE1BQUEsSUFBSSxDQUFDLE9BQU8sMENBQUUsU0FBUywwQ0FBRSxRQUFRLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFJLEtBQUssQ0FBQztJQUN4RSxDQUFDO0lBRUssT0FBTyxDQUFDLElBQVk7OztZQUN4QixJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7Z0JBQUUsT0FBTyxJQUFJLENBQUM7WUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztnQkFBRSxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFFbkUsSUFBSSxJQUFJLEdBQWEsRUFBRSxDQUFDO1lBRXhCLE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBSSxDQUFDLHFCQUFxQixDQUFDLHdCQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDekUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJO2dCQUFFLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyx3QkFBVSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDeEcsSUFBSSxTQUFTLENBQUMsSUFBSTtnQkFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWpELE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLHFCQUFxQixDQUFDLHdCQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDckUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJO2dCQUFFLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyx3QkFBVSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDcEcsSUFBSSxPQUFPLENBQUMsSUFBSTtnQkFBRSxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBQSxNQUFBLE9BQU8sQ0FBQyxJQUFJLDBDQUFHLENBQUMsQ0FBQyxtQ0FBSSxFQUFFLENBQUMsQ0FBQztZQUVsRSxPQUFPLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7O0tBQzFFO0lBRUQsWUFBWSxDQUFDLFFBQWE7UUFDeEIsSUFBSSxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBRTlCLElBQUksUUFBUSxDQUFDLGNBQWMsRUFBRTtZQUMzQixXQUFXLElBQUkseUJBQXlCLFFBQVEsQ0FBQyxjQUFjLElBQUksQ0FBQztTQUNyRTtRQUVELElBQUksUUFBUSxDQUFDLGFBQWEsRUFBRTtZQUMxQixXQUFXLElBQUkseUJBQXlCLFFBQVEsQ0FBQyxhQUFhLElBQUksQ0FBQztTQUNwRTtRQUVELElBQUksUUFBUSxDQUFDLFFBQVEsRUFBRTtZQUNyQixRQUFRLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQVksRUFBRSxFQUFFO2dCQUN6QyxJQUFJLE9BQU8sQ0FBQyxRQUFRLEVBQUU7b0JBQ3BCLFdBQVcsSUFBSSxXQUFXLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztvQkFDN0MsV0FBVyxJQUFJLElBQUksQ0FBQztpQkFDckI7Z0JBQ0QsV0FBVyxJQUFJLEdBQUcsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO1lBQ3BDLENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0lBRUQsaUJBQWlCLENBQUMsYUFBdUI7UUFDdkMsTUFBTSxVQUFVLEdBQUcsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ2hELE1BQU0sVUFBVSxHQUFHLElBQUksb0JBQU0sRUFBRSxDQUFDO1lBRWhDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDMUIsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBRWpCLG1EQUFtRDtZQUNuRCxNQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsUUFBUSxDQUFDO1lBQ3JDLElBQUksUUFBUSxDQUFDLFFBQVEsRUFBRTtnQkFDckIsUUFBUSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFZLEVBQUUsRUFBRTtvQkFDekMsMkRBQTJEO29CQUMzRCxNQUFNLGNBQWMsR0FBRyxJQUFJLE1BQU0sQ0FBQyxzQ0FBc0MsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7b0JBQ3ZGLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7b0JBRTdDLElBQUksS0FBSyxFQUFFO3dCQUNULE9BQU8sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztxQkFDakQ7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7YUFDSjtZQUVELE9BQU8sUUFBUSxDQUFDO1FBQ2xCLENBQUMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxrQkFBa0IsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekMsTUFBTSxpQkFBaUIsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTlDLElBQUksa0JBQWtCLENBQUMsUUFBUSxFQUFFO1lBQy9CLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0NBQStDLEVBQUUsa0JBQWtCLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2pHLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0NBQW9DLEVBQUUsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFNUUsSUFBSSxjQUFjLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZCLElBQUksZUFBZSxHQUFHLENBQUMsQ0FBQztZQUV4QixnSEFBZ0g7WUFDaEgsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQzNELE1BQU0saUJBQWlCLEdBQUcsa0JBQWtCLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUV6RCxJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7Z0JBRXRCLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsRUFBRTtvQkFDeEMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsRUFBRTs7d0JBQzdDLHdKQUF3Sjt3QkFDeEosTUFBTSxlQUFlLEdBQUcsTUFBQSxnQkFBZ0IsYUFBaEIsZ0JBQWdCLHVCQUFoQixnQkFBZ0IsQ0FBRSxRQUFRLDBDQUFFLElBQUksQ0FBQyxDQUFDLEdBQVEsRUFBRSxFQUFFOzRCQUNwRSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQztnQ0FBRSxPQUFPLEtBQUssQ0FBQzs0QkFFekMsTUFBTSxhQUFhLEdBQUcsSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsY0FBYyxDQUFDLENBQUM7NEJBQ2pFLE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQzs0QkFDakQsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQzs0QkFDakMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQzs0QkFFL0IsT0FBTyxhQUFhLENBQUMsT0FBTyxFQUFFLEtBQUssV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDO3dCQUMzRCxDQUFDLENBQUMsQ0FBQzt3QkFFSCxJQUFJLGVBQWUsRUFBRTs0QkFDbkIsMERBQTBEOzRCQUMxRCxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsZUFBZSxDQUFDOzRCQUNqRCxTQUFTLEdBQUcsSUFBSSxDQUFDO3lCQUNsQjtvQkFDSCxDQUFDLENBQUMsQ0FBQztvQkFFSCxxRUFBcUU7b0JBQ3JFLElBQUksQ0FBQyxTQUFTLEVBQUU7d0JBQ2Qsa0JBQWtCLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7d0JBQ3pDLENBQUMsRUFBRSxDQUFDO3dCQUNKLGNBQWMsRUFBRSxDQUFDO3FCQUNsQjtvQkFFRCxJQUFJLFNBQVMsRUFBRTt3QkFDYixlQUFlLEVBQUUsQ0FBQztxQkFDbkI7aUJBQ0Y7YUFDRjtZQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDM0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsRUFBRSxlQUFlLENBQUMsQ0FBQztTQUNoRTtRQUVELHFFQUFxRTtRQUNyRSxNQUFNLG9CQUFvQixHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUNuRSxnRUFBZ0U7UUFDaEUsT0FBTyxvQkFBb0IsQ0FBQztJQUM5QixDQUFDO0lBRUsscUJBQXFCLENBQUMsVUFBc0I7O1lBQ2hELFFBQVEsQ0FBQyxlQUFlLEdBQUcsVUFBVSxDQUFDLENBQUM7WUFFdkMsSUFBSSxJQUFJLEdBQWEsRUFBRSxDQUFDO1lBQ3hCLElBQUksT0FBTyxHQUFhLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUUvRSxLQUFLLE1BQU0sTUFBTSxJQUFJLE9BQU8sRUFBRTtnQkFDNUIsNkNBQTZDO2dCQUM3QyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBRTdFLG9EQUFvRDtnQkFDcEQsTUFBTSxJQUFJLEdBQVcsTUFBTSxDQUFDLE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLGFBQVQsU0FBUyx1QkFBVCxTQUFTLENBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDekUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDaEIsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUNwQixRQUFRLENBQUMsZUFBZSxHQUFHLFVBQVUsR0FBRyxjQUFjLENBQUMsQ0FBQztvQkFDeEQsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDMUMsU0FBUztpQkFDVjtnQkFFRCxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7YUFDbkM7WUFFRCxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDcEMsQ0FBQztLQUFBO0lBRUQsVUFBVSxDQUFDLFdBQW1CO1FBQzVCLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsYUFBYSxHQUFHLFdBQVcsQ0FBQztRQUVqQyxJQUFJLGFBQWEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLFdBQVcsS0FBSyxXQUFXLENBQUMsQ0FBQztRQUN6RixJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ2xCLGFBQWEsR0FBRyxJQUFJLGVBQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN4QyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztTQUNyQztJQUNILENBQUM7Q0FDRjtBQTFORCx3QkEwTkMifQ==\n\n/***/ }),\n\n/***/ \"./src/modules/stream/interface/stream.enum.ts\":\n/*!*****************************************************!*\\\n  !*** ./src/modules/stream/interface/stream.enum.ts ***!\n  \\*****************************************************/\n/***/ ((__unused_webpack_module, exports) => {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\r\nexports.StreamType = void 0;\r\nvar StreamType;\r\n(function (StreamType) {\r\n    StreamType[\"PICTURE\"] = \"picture-by-picture\";\r\n    StreamType[\"THUNDERDOME\"] = \"thunderdome\";\r\n    StreamType[\"EMBED\"] = \"embed\";\r\n    StreamType[\"FRONTPAGE\"] = \"frontpage\";\r\n    StreamType[\"SITE\"] = \"site\";\r\n    StreamType[\"EXTERNAL\"] = \"external\";\r\n    StreamType[\"DNS\"] = \"dns\";\r\n})(StreamType = exports.StreamType || (exports.StreamType = {}));\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyZWFtLmVudW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbW9kdWxlcy9zdHJlYW0vaW50ZXJmYWNlL3N0cmVhbS5lbnVtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLElBQVksVUFRWDtBQVJELFdBQVksVUFBVTtJQUNwQiw0Q0FBOEIsQ0FBQTtJQUM5Qix5Q0FBMkIsQ0FBQTtJQUMzQiw2QkFBZSxDQUFBO0lBQ2YscUNBQXVCLENBQUE7SUFDdkIsMkJBQWEsQ0FBQTtJQUNiLG1DQUFxQixDQUFBO0lBQ3JCLHlCQUFXLENBQUE7QUFDYixDQUFDLEVBUlcsVUFBVSxHQUFWLGtCQUFVLEtBQVYsa0JBQVUsUUFRckIifQ==\n\n/***/ }),\n\n/***/ \"./src/modules/stream/interface/stream.types.ts\":\n/*!******************************************************!*\\\n  !*** ./src/modules/stream/interface/stream.types.ts ***!\n  \\******************************************************/\n/***/ ((__unused_webpack_module, exports) => {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\r\nexports.Server = exports.StreamUrl = void 0;\r\nclass StreamUrl {\r\n    constructor() {\r\n        this.url = \"\";\r\n        this.quality = \"\";\r\n    }\r\n}\r\nexports.StreamUrl = StreamUrl;\r\nclass Server {\r\n    constructor(partial) {\r\n        this.bestQuality = () => {\r\n            return this.urlList[0];\r\n        };\r\n        this.findByQuality = (quality) => this.urlList.find((x) => x.quality == quality);\r\n        Object.assign(this, partial);\r\n    }\r\n}\r\nexports.Server = Server;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyZWFtLnR5cGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvc3RyZWFtL2ludGVyZmFjZS9zdHJlYW0udHlwZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsTUFBYSxTQUFTO0lBQXRCO1FBQ0UsUUFBRyxHQUFXLEVBQUUsQ0FBQztRQUNqQixZQUFPLEdBQVcsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7Q0FBQTtBQUhELDhCQUdDO0FBQ0QsTUFBYSxNQUFNO0lBVWpCLFlBQVksT0FBd0I7UUFMcEMsZ0JBQVcsR0FBRyxHQUFHLEVBQUU7WUFDakIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLENBQUMsQ0FBQztRQUNGLGtCQUFhLEdBQUcsQ0FBQyxPQUFlLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDO1FBR2xGLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQy9CLENBQUM7Q0FDRjtBQWJELHdCQWFDIn0=\n\n/***/ }),\n\n/***/ \"./src/modules/stream/stream.ts\":\n/*!**************************************!*\\\n  !*** ./src/modules/stream/stream.ts ***!\n  \\**************************************/\n/***/ (function(__unused_webpack_module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\r\nexports.Stream = void 0;\r\nconst twitch_service_1 = __webpack_require__(/*! ../twitch/twitch.service */ \"./src/modules/twitch/twitch.service.ts\");\r\nconst stream_types_1 = __webpack_require__(/*! ./interface/stream.types */ \"./src/modules/stream/interface/stream.types.ts\");\r\nclass Stream {\r\n    constructor(channelName) {\r\n        this.serverList = []; //the list of servers links m3u8\r\n        this.channelName = channelName;\r\n        this.twitchService = new twitch_service_1.TwitchService(\"\");\r\n    }\r\n    removeServer(server) {\r\n        const index = this.serverList.indexOf(server);\r\n        if (index > -1)\r\n            this.serverList.splice(index, 1);\r\n    }\r\n    //add m3u8 links with quality to the list of servers\r\n    setStreamAccess(text, type = \"local\", sig = true) {\r\n        const qualityUrlSplit = [];\r\n        let captureArray;\r\n        const REGEX = /NAME=\"((?:\\S+\\s+\\S+|\\S+))\",AUTO(?:^|\\S+\\s+)(?:^|\\S+\\s+)(https:\\/\\/video(\\S+).m3u8)/g;\r\n        while ((captureArray = REGEX.exec(text)) !== null) {\r\n            qualityUrlSplit.push({ quality: captureArray[1], url: captureArray[2] });\r\n        }\r\n        const streamList = new stream_types_1.Server({ type: type, urlList: qualityUrlSplit, sig: sig });\r\n        this.serverList.push(streamList);\r\n    }\r\n    //create a new stream access\r\n    createStreamAccess(playerType, integrityToken) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            try {\r\n                const streamDataAccess = yield this.twitchService.playbackAccessToken(this.channelName, playerType, integrityToken);\r\n                console.log(\"New Connection: \", playerType, streamDataAccess.token.includes('\"hide_ads\":true'));\r\n                const m3u8Text = yield this.twitchService.getM3U8(this.channelName, streamDataAccess);\r\n                this.setStreamAccess(m3u8Text, playerType);\r\n            }\r\n            catch (e) {\r\n                logPrint(e);\r\n            }\r\n        });\r\n    }\r\n    getStreamByStreamType(accessType) {\r\n        //filter all server by type\r\n        const servers = this.serverList.filter((x) => x.type == accessType);\r\n        if (!servers)\r\n            return [];\r\n        return servers;\r\n    }\r\n}\r\nexports.Stream = Stream;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyZWFtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL21vZHVsZXMvc3RyZWFtL3N0cmVhbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSw2REFBeUQ7QUFFekQsMkRBQTZEO0FBRTdELE1BQWEsTUFBTTtJQUtqQixZQUFZLFdBQW1CO1FBSi9CLGVBQVUsR0FBYSxFQUFFLENBQUMsQ0FBQyxnQ0FBZ0M7UUFLekQsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDL0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLDhCQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELFlBQVksQ0FBQyxNQUFjO1FBQ3pCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzlDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztZQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRUQsb0RBQW9EO0lBQ3BELGVBQWUsQ0FBQyxJQUFZLEVBQUUsSUFBSSxHQUFHLE9BQU8sRUFBRSxHQUFHLEdBQUcsSUFBSTtRQUN0RCxNQUFNLGVBQWUsR0FBZ0IsRUFBRSxDQUFDO1FBQ3hDLElBQUksWUFBb0MsQ0FBQztRQUV6QyxNQUFNLEtBQUssR0FBRyxxRkFBcUYsQ0FBQztRQUVwRyxPQUFPLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDakQsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDMUU7UUFFRCxNQUFNLFVBQVUsR0FBVyxJQUFJLHFCQUFNLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDMUYsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVELDRCQUE0QjtJQUN0QixrQkFBa0IsQ0FBQyxVQUFzQixFQUFFLGNBQXNCOztZQUNyRSxJQUFJO2dCQUNGLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsVUFBVSxFQUFFLGNBQWMsQ0FBQyxDQUFDO2dCQUNwSCxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztnQkFDaEcsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLGdCQUFnQixDQUFDLENBQUM7Z0JBQ3RGLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO2FBQzVDO1lBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ1YsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2I7UUFDSCxDQUFDO0tBQUE7SUFFRCxxQkFBcUIsQ0FBQyxVQUFzQjtRQUMxQywyQkFBMkI7UUFDM0IsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksVUFBVSxDQUFDLENBQUM7UUFDcEUsSUFBSSxDQUFDLE9BQU87WUFBRSxPQUFPLEVBQUUsQ0FBQztRQUV4QixPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0NBQ0Y7QUFqREQsd0JBaURDIn0=\n\n/***/ }),\n\n/***/ \"./src/modules/twitch/twitch.service.ts\":\n/*!**********************************************!*\\\n  !*** ./src/modules/twitch/twitch.service.ts ***!\n  \\**********************************************/\n/***/ (function(__unused_webpack_module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\r\nexports.TwitchService = void 0;\r\nclass TwitchService {\r\n    constructor(integrityToken) {\r\n        this.integrityToken = integrityToken;\r\n    }\r\n    playbackAccessToken(channelName, playerType, integrityToken) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const body = {\r\n                operationName: 'PlaybackAccessToken',\r\n                variables: {\r\n                    isLive: true,\r\n                    login: channelName,\r\n                    isVod: false,\r\n                    vodID: '',\r\n                    playerType: playerType\r\n                },\r\n                extensions: {\r\n                    persistedQuery: {\r\n                        version: 1,\r\n                        sha256Hash: '0828119ded1c13477966434e15800ff57ddacf13ba1911c129dc2200705b0712'\r\n                    }\r\n                }\r\n            };\r\n            const gql = yield __webpack_require__.g.request(\"https://gql.twitch.tv/gql#origin=twilight\", {\r\n                method: \"POST\",\r\n                headers: { \"Host\": \"gql.twitch.tv\", \"Client-ID\": \"kimne78kx3ncx6brgo4mv6wki5h1ko\", \"Client-Integrity\": integrityToken },\r\n                body: JSON.stringify(body),\r\n            });\r\n            const streamDataAccess = yield gql.json();\r\n            return { token: streamDataAccess.data.streamPlaybackAccessToken.value, signature: streamDataAccess.data.streamPlaybackAccessToken.signature };\r\n        });\r\n    }\r\n    playbackAccessToken_Template(channelName, playerType) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const query = 'query PlaybackAccessToken_Template($login: String!, $isLive: Boolean!, $vodID: ID!, $isVod: Boolean!, $playerType: String!) { streamPlaybackAccessToken(channelName: $login, params: {platform: \"web\", playerBackend: \"mediaplayer\", playerType: $playerType}) @include(if: $isLive) { value signature __typename } videoPlaybackAccessToken(id: $vodID, params: {platform: \"web\", playerBackend: \"mediaplayer\", playerType: $playerType}) @include(if: $isVod) { value signature __typename }}';\r\n            const body = {\r\n                operationName: \"PlaybackAccessToken_Template\",\r\n                query: query,\r\n                variables: {\r\n                    isLive: true,\r\n                    isVod: false,\r\n                    vodID: \"\",\r\n                    login: channelName,\r\n                    playerType: playerType,\r\n                },\r\n            };\r\n            const gql = yield __webpack_require__.g.request(\"https://gql.twitch.tv/gql\", {\r\n                method: \"POST\",\r\n                headers: { \"Host\": \"gql.twitch.tv\", \"Client-ID\": \"kimne78kx3ncx6brgo4mv6wki5h1ko\" },\r\n                body: JSON.stringify(body),\r\n            });\r\n            const streamDataAccess = yield gql.json();\r\n            return { token: streamDataAccess.data.streamPlaybackAccessToken.value, signature: streamDataAccess.data.streamPlaybackAccessToken.signature };\r\n        });\r\n    }\r\n    getM3U8(channelName, playbackAccessToken) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const params = \"allow_source=true&fast_bread=true&p=\" +\r\n                Math.floor(Math.random() * 1e7) +\r\n                \"&player_backend=mediaplayer&playlist_include_framerate=true&reassignments_supported=false&sig=\" +\r\n                playbackAccessToken.signature +\r\n                \"&supported_codecs=avc1&token=\" +\r\n                playbackAccessToken.token;\r\n            return (yield __webpack_require__.g.request(\"https://usher.ttvnw.net/api/channel/hls/\" + channelName + \".m3u8?\" + params)).text();\r\n        });\r\n    }\r\n}\r\nexports.TwitchService = TwitchService;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHdpdGNoLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbW9kdWxlcy90d2l0Y2gvdHdpdGNoLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEsTUFBYSxhQUFhO0lBQ3RCLFlBQTZCLGNBQXNCO1FBQXRCLG1CQUFjLEdBQWQsY0FBYyxDQUFRO0lBQUksQ0FBQztJQUVsRCxtQkFBbUIsQ0FBQyxXQUFtQixFQUFFLFVBQWtCLEVBQUUsY0FBc0I7O1lBQ3JGLE1BQU0sSUFBSSxHQUFHO2dCQUNULGFBQWEsRUFBRSxxQkFBcUI7Z0JBQ3BDLFNBQVMsRUFBRTtvQkFDUCxNQUFNLEVBQUUsSUFBSTtvQkFDWixLQUFLLEVBQUUsV0FBVztvQkFDbEIsS0FBSyxFQUFFLEtBQUs7b0JBQ1osS0FBSyxFQUFFLEVBQUU7b0JBQ1QsVUFBVSxFQUFFLFVBQVU7aUJBQ3pCO2dCQUNELFVBQVUsRUFBRTtvQkFDUixjQUFjLEVBQUU7d0JBQ1osT0FBTyxFQUFFLENBQUM7d0JBQ1YsVUFBVSxFQUFFLGtFQUFrRTtxQkFDakY7aUJBQ0o7YUFDSixDQUFBO1lBRUQsTUFBTSxHQUFHLEdBQUcsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLDJDQUEyQyxFQUFFO2dCQUMxRSxNQUFNLEVBQUUsTUFBTTtnQkFDZCxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsZUFBZSxFQUFFLFdBQVcsRUFBRSxnQ0FBZ0MsRUFBRSxrQkFBa0IsRUFBRSxjQUFjLEVBQUU7Z0JBQ3ZILElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQzthQUM3QixDQUFDLENBQUM7WUFFSCxNQUFNLGdCQUFnQixHQUFHLE1BQU0sR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQzFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2xKLENBQUM7S0FBQTtJQUVLLDRCQUE0QixDQUFDLFdBQW1CLEVBQUUsVUFBa0I7O1lBQ3RFLE1BQU0sS0FBSyxHQUNQLGllQUFpZSxDQUFDO1lBQ3RlLE1BQU0sSUFBSSxHQUFHO2dCQUNULGFBQWEsRUFBRSw4QkFBOEI7Z0JBQzdDLEtBQUssRUFBRSxLQUFLO2dCQUNaLFNBQVMsRUFBRTtvQkFDUCxNQUFNLEVBQUUsSUFBSTtvQkFDWixLQUFLLEVBQUUsS0FBSztvQkFDWixLQUFLLEVBQUUsRUFBRTtvQkFDVCxLQUFLLEVBQUUsV0FBVztvQkFDbEIsVUFBVSxFQUFFLFVBQVU7aUJBQ3pCO2FBQ0osQ0FBQztZQUVGLE1BQU0sR0FBRyxHQUFHLE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQywyQkFBMkIsRUFBRTtnQkFDMUQsTUFBTSxFQUFFLE1BQU07Z0JBQ2QsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLGVBQWUsRUFBRSxXQUFXLEVBQUUsZ0NBQWdDLEVBQUU7Z0JBQ25GLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQzthQUM3QixDQUFDLENBQUM7WUFDSCxNQUFNLGdCQUFnQixHQUFHLE1BQU0sR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1lBRTFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2xKLENBQUM7S0FBQTtJQUVLLE9BQU8sQ0FBQyxXQUFtQixFQUFFLG1CQUF5RDs7WUFDeEYsTUFBTSxNQUFNLEdBQ1Isc0NBQXNDO2dCQUN0QyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUM7Z0JBQy9CLGdHQUFnRztnQkFDaEcsbUJBQW1CLENBQUMsU0FBUztnQkFDN0IsK0JBQStCO2dCQUMvQixtQkFBbUIsQ0FBQyxLQUFLLENBQUM7WUFFOUIsT0FBTyxDQUFDLE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQywwQ0FBMEMsR0FBRyxXQUFXLEdBQUcsUUFBUSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdkgsQ0FBQztLQUFBO0NBQ0o7QUFuRUQsc0NBbUVDIn0=\n\n/***/ }),\n\n/***/ \"./node_modules/@videojs/vhs-utils/es/decode-b64-to-uint8-array.js\":\n/*!*************************************************************************!*\\\n  !*** ./node_modules/@videojs/vhs-utils/es/decode-b64-to-uint8-array.js ***!\n  \\*************************************************************************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ decodeB64ToUint8Array)\n/* harmony export */ });\n/* harmony import */ var global_window__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! global/window */ \"./node_modules/global/window.js\");\n/* harmony import */ var global_window__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(global_window__WEBPACK_IMPORTED_MODULE_0__);\n\n\nvar atob = function atob(s) {\n  return (global_window__WEBPACK_IMPORTED_MODULE_0___default().atob) ? global_window__WEBPACK_IMPORTED_MODULE_0___default().atob(s) : Buffer.from(s, 'base64').toString('binary');\n};\n\nfunction decodeB64ToUint8Array(b64Text) {\n  var decodedString = atob(b64Text);\n  var array = new Uint8Array(decodedString.length);\n\n  for (var i = 0; i < decodedString.length; i++) {\n    array[i] = decodedString.charCodeAt(i);\n  }\n\n  return array;\n}\n\n/***/ }),\n\n/***/ \"./node_modules/@videojs/vhs-utils/es/stream.js\":\n/*!******************************************************!*\\\n  !*** ./node_modules/@videojs/vhs-utils/es/stream.js ***!\n  \\******************************************************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ Stream)\n/* harmony export */ });\n/**\n * @file stream.js\n */\n\n/**\n * A lightweight readable stream implemention that handles event dispatching.\n *\n * @class Stream\n */\nvar Stream = /*#__PURE__*/function () {\n  function Stream() {\n    this.listeners = {};\n  }\n  /**\n   * Add a listener for a specified event type.\n   *\n   * @param {string} type the event name\n   * @param {Function} listener the callback to be invoked when an event of\n   * the specified type occurs\n   */\n\n\n  var _proto = Stream.prototype;\n\n  _proto.on = function on(type, listener) {\n    if (!this.listeners[type]) {\n      this.listeners[type] = [];\n    }\n\n    this.listeners[type].push(listener);\n  }\n  /**\n   * Remove a listener for a specified event type.\n   *\n   * @param {string} type the event name\n   * @param {Function} listener  a function previously registered for this\n   * type of event through `on`\n   * @return {boolean} if we could turn it off or not\n   */\n  ;\n\n  _proto.off = function off(type, listener) {\n    if (!this.listeners[type]) {\n      return false;\n    }\n\n    var index = this.listeners[type].indexOf(listener); // TODO: which is better?\n    // In Video.js we slice listener functions\n    // on trigger so that it does not mess up the order\n    // while we loop through.\n    //\n    // Here we slice on off so that the loop in trigger\n    // can continue using it's old reference to loop without\n    // messing up the order.\n\n    this.listeners[type] = this.listeners[type].slice(0);\n    this.listeners[type].splice(index, 1);\n    return index > -1;\n  }\n  /**\n   * Trigger an event of the specified type on this stream. Any additional\n   * arguments to this function are passed as parameters to event listeners.\n   *\n   * @param {string} type the event name\n   */\n  ;\n\n  _proto.trigger = function trigger(type) {\n    var callbacks = this.listeners[type];\n\n    if (!callbacks) {\n      return;\n    } // Slicing the arguments on every invocation of this method\n    // can add a significant amount of overhead. Avoid the\n    // intermediate object creation for the common case of a\n    // single callback argument\n\n\n    if (arguments.length === 2) {\n      var length = callbacks.length;\n\n      for (var i = 0; i < length; ++i) {\n        callbacks[i].call(this, arguments[1]);\n      }\n    } else {\n      var args = Array.prototype.slice.call(arguments, 1);\n      var _length = callbacks.length;\n\n      for (var _i = 0; _i < _length; ++_i) {\n        callbacks[_i].apply(this, args);\n      }\n    }\n  }\n  /**\n   * Destroys the stream and cleans up.\n   */\n  ;\n\n  _proto.dispose = function dispose() {\n    this.listeners = {};\n  }\n  /**\n   * Forwards all `data` events on this stream to the destination stream. The\n   * destination stream should provide a method `push` to receive the data\n   * events as they arrive.\n   *\n   * @param {Stream} destination the stream that will receive all `data` events\n   * @see http://nodejs.org/api/stream.html#stream_readable_pipe_destination_options\n   */\n  ;\n\n  _proto.pipe = function pipe(destination) {\n    this.on('data', function (data) {\n      destination.push(data);\n    });\n  };\n\n  return Stream;\n}();\n\n\n\n/***/ }),\n\n/***/ \"./node_modules/global/window.js\":\n/*!***************************************!*\\\n  !*** ./node_modules/global/window.js ***!\n  \\***************************************/\n/***/ ((module, __unused_webpack_exports, __webpack_require__) => {\n\nvar win;\n\nif (typeof window !== \"undefined\") {\n    win = window;\n} else if (typeof __webpack_require__.g !== \"undefined\") {\n    win = __webpack_require__.g;\n} else if (typeof self !== \"undefined\"){\n    win = self;\n} else {\n    win = {};\n}\n\nmodule.exports = win;\n\n\n/***/ }),\n\n/***/ \"./node_modules/m3u8-parser/dist/m3u8-parser.es.js\":\n/*!*********************************************************!*\\\n  !*** ./node_modules/m3u8-parser/dist/m3u8-parser.es.js ***!\n  \\*********************************************************/\n/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"LineStream\": () => (/* binding */ LineStream),\n/* harmony export */   \"ParseStream\": () => (/* binding */ ParseStream),\n/* harmony export */   \"Parser\": () => (/* binding */ Parser)\n/* harmony export */ });\n/* harmony import */ var _videojs_vhs_utils_es_stream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @videojs/vhs-utils/es/stream.js */ \"./node_modules/@videojs/vhs-utils/es/stream.js\");\n/* harmony import */ var _babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/extends */ \"./node_modules/@babel/runtime/helpers/esm/extends.js\");\n/* harmony import */ var _videojs_vhs_utils_es_decode_b64_to_uint8_array_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @videojs/vhs-utils/es/decode-b64-to-uint8-array.js */ \"./node_modules/@videojs/vhs-utils/es/decode-b64-to-uint8-array.js\");\n/*! @name m3u8-parser @version 6.0.0 @license Apache-2.0 */\n\n\n\n\n/**\n * @file m3u8/line-stream.js\n */\n/**\n * A stream that buffers string input and generates a `data` event for each\n * line.\n *\n * @class LineStream\n * @extends Stream\n */\n\nclass LineStream extends _videojs_vhs_utils_es_stream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  constructor() {\n    super();\n    this.buffer = '';\n  }\n  /**\n   * Add new data to be parsed.\n   *\n   * @param {string} data the text to process\n   */\n\n\n  push(data) {\n    let nextNewline;\n    this.buffer += data;\n    nextNewline = this.buffer.indexOf('\\n');\n\n    for (; nextNewline > -1; nextNewline = this.buffer.indexOf('\\n')) {\n      this.trigger('data', this.buffer.substring(0, nextNewline));\n      this.buffer = this.buffer.substring(nextNewline + 1);\n    }\n  }\n\n}\n\nconst TAB = String.fromCharCode(0x09);\n\nconst parseByterange = function (byterangeString) {\n  // optionally match and capture 0+ digits before `@`\n  // optionally match and capture 0+ digits after `@`\n  const match = /([0-9.]*)?@?([0-9.]*)?/.exec(byterangeString || '');\n  const result = {};\n\n  if (match[1]) {\n    result.length = parseInt(match[1], 10);\n  }\n\n  if (match[2]) {\n    result.offset = parseInt(match[2], 10);\n  }\n\n  return result;\n};\n/**\n * \"forgiving\" attribute list psuedo-grammar:\n * attributes -> keyvalue (',' keyvalue)*\n * keyvalue   -> key '=' value\n * key        -> [^=]*\n * value      -> '\"' [^\"]* '\"' | [^,]*\n */\n\n\nconst attributeSeparator = function () {\n  const key = '[^=]*';\n  const value = '\"[^\"]*\"|[^,]*';\n  const keyvalue = '(?:' + key + ')=(?:' + value + ')';\n  return new RegExp('(?:^|,)(' + keyvalue + ')');\n};\n/**\n * Parse attributes from a line given the separator\n *\n * @param {string} attributes the attribute line to parse\n */\n\n\nconst parseAttributes = function (attributes) {\n  const result = {};\n\n  if (!attributes) {\n    return result;\n  } // split the string using attributes as the separator\n\n\n  const attrs = attributes.split(attributeSeparator());\n  let i = attrs.length;\n  let attr;\n\n  while (i--) {\n    // filter out unmatched portions of the string\n    if (attrs[i] === '') {\n      continue;\n    } // split the key and value\n\n\n    attr = /([^=]*)=(.*)/.exec(attrs[i]).slice(1); // trim whitespace and remove optional quotes around the value\n\n    attr[0] = attr[0].replace(/^\\s+|\\s+$/g, '');\n    attr[1] = attr[1].replace(/^\\s+|\\s+$/g, '');\n    attr[1] = attr[1].replace(/^['\"](.*)['\"]$/g, '$1');\n    result[attr[0]] = attr[1];\n  }\n\n  return result;\n};\n/**\n * A line-level M3U8 parser event stream. It expects to receive input one\n * line at a time and performs a context-free parse of its contents. A stream\n * interpretation of a manifest can be useful if the manifest is expected to\n * be too large to fit comfortably into memory or the entirety of the input\n * is not immediately available. Otherwise, it's probably much easier to work\n * with a regular `Parser` object.\n *\n * Produces `data` events with an object that captures the parser's\n * interpretation of the input. That object has a property `tag` that is one\n * of `uri`, `comment`, or `tag`. URIs only have a single additional\n * property, `line`, which captures the entirety of the input without\n * interpretation. Comments similarly have a single additional property\n * `text` which is the input without the leading `#`.\n *\n * Tags always have a property `tagType` which is the lower-cased version of\n * the M3U8 directive without the `#EXT` or `#EXT-X-` prefix. For instance,\n * `#EXT-X-MEDIA-SEQUENCE` becomes `media-sequence` when parsed. Unrecognized\n * tags are given the tag type `unknown` and a single additional property\n * `data` with the remainder of the input.\n *\n * @class ParseStream\n * @extends Stream\n */\n\n\nclass ParseStream extends _videojs_vhs_utils_es_stream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  constructor() {\n    super();\n    this.customParsers = [];\n    this.tagMappers = [];\n  }\n  /**\n   * Parses an additional line of input.\n   *\n   * @param {string} line a single line of an M3U8 file to parse\n   */\n\n\n  push(line) {\n    let match;\n    let event; // strip whitespace\n\n    line = line.trim();\n\n    if (line.length === 0) {\n      // ignore empty lines\n      return;\n    } // URIs\n\n\n    if (line[0] !== '#') {\n      this.trigger('data', {\n        type: 'uri',\n        uri: line\n      });\n      return;\n    } // map tags\n\n\n    const newLines = this.tagMappers.reduce((acc, mapper) => {\n      const mappedLine = mapper(line); // skip if unchanged\n\n      if (mappedLine === line) {\n        return acc;\n      }\n\n      return acc.concat([mappedLine]);\n    }, [line]);\n    newLines.forEach(newLine => {\n      for (let i = 0; i < this.customParsers.length; i++) {\n        if (this.customParsers[i].call(this, newLine)) {\n          return;\n        }\n      } // Comments\n\n\n      if (newLine.indexOf('#EXT') !== 0) {\n        this.trigger('data', {\n          type: 'comment',\n          text: newLine.slice(1)\n        });\n        return;\n      } // strip off any carriage returns here so the regex matching\n      // doesn't have to account for them.\n\n\n      newLine = newLine.replace('\\r', ''); // Tags\n\n      match = /^#EXTM3U/.exec(newLine);\n\n      if (match) {\n        this.trigger('data', {\n          type: 'tag',\n          tagType: 'm3u'\n        });\n        return;\n      }\n\n      match = /^#EXTINF:([0-9\\.]*)?,?(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'inf'\n        };\n\n        if (match[1]) {\n          event.duration = parseFloat(match[1]);\n        }\n\n        if (match[2]) {\n          event.title = match[2];\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'targetduration'\n        };\n\n        if (match[1]) {\n          event.duration = parseInt(match[1], 10);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-VERSION:([0-9.]*)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'version'\n        };\n\n        if (match[1]) {\n          event.version = parseInt(match[1], 10);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-MEDIA-SEQUENCE:(\\-?[0-9.]*)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'media-sequence'\n        };\n\n        if (match[1]) {\n          event.number = parseInt(match[1], 10);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-DISCONTINUITY-SEQUENCE:(\\-?[0-9.]*)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'discontinuity-sequence'\n        };\n\n        if (match[1]) {\n          event.number = parseInt(match[1], 10);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'playlist-type'\n        };\n\n        if (match[1]) {\n          event.playlistType = match[1];\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-BYTERANGE:(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = (0,_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(parseByterange(match[1]), {\n          type: 'tag',\n          tagType: 'byterange'\n        });\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'allow-cache'\n        };\n\n        if (match[1]) {\n          event.allowed = !/NO/.test(match[1]);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-MAP:(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'map'\n        };\n\n        if (match[1]) {\n          const attributes = parseAttributes(match[1]);\n\n          if (attributes.URI) {\n            event.uri = attributes.URI;\n          }\n\n          if (attributes.BYTERANGE) {\n            event.byterange = parseByterange(attributes.BYTERANGE);\n          }\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-STREAM-INF:(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'stream-inf'\n        };\n\n        if (match[1]) {\n          event.attributes = parseAttributes(match[1]);\n\n          if (event.attributes.RESOLUTION) {\n            const split = event.attributes.RESOLUTION.split('x');\n            const resolution = {};\n\n            if (split[0]) {\n              resolution.width = parseInt(split[0], 10);\n            }\n\n            if (split[1]) {\n              resolution.height = parseInt(split[1], 10);\n            }\n\n            event.attributes.RESOLUTION = resolution;\n          }\n\n          if (event.attributes.BANDWIDTH) {\n            event.attributes.BANDWIDTH = parseInt(event.attributes.BANDWIDTH, 10);\n          }\n\n          if (event.attributes['FRAME-RATE']) {\n            event.attributes['FRAME-RATE'] = parseFloat(event.attributes['FRAME-RATE']);\n          }\n\n          if (event.attributes['PROGRAM-ID']) {\n            event.attributes['PROGRAM-ID'] = parseInt(event.attributes['PROGRAM-ID'], 10);\n          }\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-MEDIA:(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'media'\n        };\n\n        if (match[1]) {\n          event.attributes = parseAttributes(match[1]);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-ENDLIST/.exec(newLine);\n\n      if (match) {\n        this.trigger('data', {\n          type: 'tag',\n          tagType: 'endlist'\n        });\n        return;\n      }\n\n      match = /^#EXT-X-DISCONTINUITY/.exec(newLine);\n\n      if (match) {\n        this.trigger('data', {\n          type: 'tag',\n          tagType: 'discontinuity'\n        });\n        return;\n      }\n\n      match = /^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'program-date-time'\n        };\n\n        if (match[1]) {\n          event.dateTimeString = match[1];\n          event.dateTimeObject = new Date(match[1]);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-KEY:(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'key'\n        };\n\n        if (match[1]) {\n          event.attributes = parseAttributes(match[1]); // parse the IV string into a Uint32Array\n\n          if (event.attributes.IV) {\n            if (event.attributes.IV.substring(0, 2).toLowerCase() === '0x') {\n              event.attributes.IV = event.attributes.IV.substring(2);\n            }\n\n            event.attributes.IV = event.attributes.IV.match(/.{8}/g);\n            event.attributes.IV[0] = parseInt(event.attributes.IV[0], 16);\n            event.attributes.IV[1] = parseInt(event.attributes.IV[1], 16);\n            event.attributes.IV[2] = parseInt(event.attributes.IV[2], 16);\n            event.attributes.IV[3] = parseInt(event.attributes.IV[3], 16);\n            event.attributes.IV = new Uint32Array(event.attributes.IV);\n          }\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-START:(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'start'\n        };\n\n        if (match[1]) {\n          event.attributes = parseAttributes(match[1]);\n          event.attributes['TIME-OFFSET'] = parseFloat(event.attributes['TIME-OFFSET']);\n          event.attributes.PRECISE = /YES/.test(event.attributes.PRECISE);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'cue-out-cont'\n        };\n\n        if (match[1]) {\n          event.data = match[1];\n        } else {\n          event.data = '';\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-CUE-OUT:(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'cue-out'\n        };\n\n        if (match[1]) {\n          event.data = match[1];\n        } else {\n          event.data = '';\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-CUE-IN:(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'cue-in'\n        };\n\n        if (match[1]) {\n          event.data = match[1];\n        } else {\n          event.data = '';\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-SKIP:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'skip'\n        };\n        event.attributes = parseAttributes(match[1]);\n\n        if (event.attributes.hasOwnProperty('SKIPPED-SEGMENTS')) {\n          event.attributes['SKIPPED-SEGMENTS'] = parseInt(event.attributes['SKIPPED-SEGMENTS'], 10);\n        }\n\n        if (event.attributes.hasOwnProperty('RECENTLY-REMOVED-DATERANGES')) {\n          event.attributes['RECENTLY-REMOVED-DATERANGES'] = event.attributes['RECENTLY-REMOVED-DATERANGES'].split(TAB);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-PART:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'part'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['DURATION'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseFloat(event.attributes[key]);\n          }\n        });\n        ['INDEPENDENT', 'GAP'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = /YES/.test(event.attributes[key]);\n          }\n        });\n\n        if (event.attributes.hasOwnProperty('BYTERANGE')) {\n          event.attributes.byterange = parseByterange(event.attributes.BYTERANGE);\n        }\n\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-SERVER-CONTROL:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'server-control'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['CAN-SKIP-UNTIL', 'PART-HOLD-BACK', 'HOLD-BACK'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseFloat(event.attributes[key]);\n          }\n        });\n        ['CAN-SKIP-DATERANGES', 'CAN-BLOCK-RELOAD'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = /YES/.test(event.attributes[key]);\n          }\n        });\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-PART-INF:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'part-inf'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['PART-TARGET'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseFloat(event.attributes[key]);\n          }\n        });\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-PRELOAD-HINT:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'preload-hint'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['BYTERANGE-START', 'BYTERANGE-LENGTH'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseInt(event.attributes[key], 10);\n            const subkey = key === 'BYTERANGE-LENGTH' ? 'length' : 'offset';\n            event.attributes.byterange = event.attributes.byterange || {};\n            event.attributes.byterange[subkey] = event.attributes[key]; // only keep the parsed byterange object.\n\n            delete event.attributes[key];\n          }\n        });\n        this.trigger('data', event);\n        return;\n      }\n\n      match = /^#EXT-X-RENDITION-REPORT:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'rendition-report'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['LAST-MSN', 'LAST-PART'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseInt(event.attributes[key], 10);\n          }\n        });\n        this.trigger('data', event);\n        return;\n      } // unknown tag type\n\n\n      this.trigger('data', {\n        type: 'tag',\n        data: newLine.slice(4)\n      });\n    });\n  }\n  /**\n   * Add a parser for custom headers\n   *\n   * @param {Object}   options              a map of options for the added parser\n   * @param {RegExp}   options.expression   a regular expression to match the custom header\n   * @param {string}   options.customType   the custom type to register to the output\n   * @param {Function} [options.dataParser] function to parse the line into an object\n   * @param {boolean}  [options.segment]    should tag data be attached to the segment object\n   */\n\n\n  addParser({\n    expression,\n    customType,\n    dataParser,\n    segment\n  }) {\n    if (typeof dataParser !== 'function') {\n      dataParser = line => line;\n    }\n\n    this.customParsers.push(line => {\n      const match = expression.exec(line);\n\n      if (match) {\n        this.trigger('data', {\n          type: 'custom',\n          data: dataParser(line),\n          customType,\n          segment\n        });\n        return true;\n      }\n    });\n  }\n  /**\n   * Add a custom header mapper\n   *\n   * @param {Object}   options\n   * @param {RegExp}   options.expression   a regular expression to match the custom header\n   * @param {Function} options.map          function to translate tag into a different tag\n   */\n\n\n  addTagMapper({\n    expression,\n    map\n  }) {\n    const mapFn = line => {\n      if (expression.test(line)) {\n        return map(line);\n      }\n\n      return line;\n    };\n\n    this.tagMappers.push(mapFn);\n  }\n\n}\n\nconst camelCase = str => str.toLowerCase().replace(/-(\\w)/g, a => a[1].toUpperCase());\n\nconst camelCaseKeys = function (attributes) {\n  const result = {};\n  Object.keys(attributes).forEach(function (key) {\n    result[camelCase(key)] = attributes[key];\n  });\n  return result;\n}; // set SERVER-CONTROL hold back based upon targetDuration and partTargetDuration\n// we need this helper because defaults are based upon targetDuration and\n// partTargetDuration being set, but they may not be if SERVER-CONTROL appears before\n// target durations are set.\n\n\nconst setHoldBack = function (manifest) {\n  const {\n    serverControl,\n    targetDuration,\n    partTargetDuration\n  } = manifest;\n\n  if (!serverControl) {\n    return;\n  }\n\n  const tag = '#EXT-X-SERVER-CONTROL';\n  const hb = 'holdBack';\n  const phb = 'partHoldBack';\n  const minTargetDuration = targetDuration && targetDuration * 3;\n  const minPartDuration = partTargetDuration && partTargetDuration * 2;\n\n  if (targetDuration && !serverControl.hasOwnProperty(hb)) {\n    serverControl[hb] = minTargetDuration;\n    this.trigger('info', {\n      message: `${tag} defaulting HOLD-BACK to targetDuration * 3 (${minTargetDuration}).`\n    });\n  }\n\n  if (minTargetDuration && serverControl[hb] < minTargetDuration) {\n    this.trigger('warn', {\n      message: `${tag} clamping HOLD-BACK (${serverControl[hb]}) to targetDuration * 3 (${minTargetDuration})`\n    });\n    serverControl[hb] = minTargetDuration;\n  } // default no part hold back to part target duration * 3\n\n\n  if (partTargetDuration && !serverControl.hasOwnProperty(phb)) {\n    serverControl[phb] = partTargetDuration * 3;\n    this.trigger('info', {\n      message: `${tag} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${serverControl[phb]}).`\n    });\n  } // if part hold back is too small default it to part target duration * 2\n\n\n  if (partTargetDuration && serverControl[phb] < minPartDuration) {\n    this.trigger('warn', {\n      message: `${tag} clamping PART-HOLD-BACK (${serverControl[phb]}) to partTargetDuration * 2 (${minPartDuration}).`\n    });\n    serverControl[phb] = minPartDuration;\n  }\n};\n/**\n * A parser for M3U8 files. The current interpretation of the input is\n * exposed as a property `manifest` on parser objects. It's just two lines to\n * create and parse a manifest once you have the contents available as a string:\n *\n * ```js\n * var parser = new m3u8.Parser();\n * parser.push(xhr.responseText);\n * ```\n *\n * New input can later be applied to update the manifest object by calling\n * `push` again.\n *\n * The parser attempts to create a usable manifest object even if the\n * underlying input is somewhat nonsensical. It emits `info` and `warning`\n * events during the parse if it encounters input that seems invalid or\n * requires some property of the manifest object to be defaulted.\n *\n * @class Parser\n * @extends Stream\n */\n\n\nclass Parser extends _videojs_vhs_utils_es_stream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  constructor() {\n    super();\n    this.lineStream = new LineStream();\n    this.parseStream = new ParseStream();\n    this.lineStream.pipe(this.parseStream);\n    /* eslint-disable consistent-this */\n\n    const self = this;\n    /* eslint-enable consistent-this */\n\n    const uris = [];\n    let currentUri = {}; // if specified, the active EXT-X-MAP definition\n\n    let currentMap; // if specified, the active decryption key\n\n    let key;\n    let hasParts = false;\n\n    const noop = function () {};\n\n    const defaultMediaGroups = {\n      'AUDIO': {},\n      'VIDEO': {},\n      'CLOSED-CAPTIONS': {},\n      'SUBTITLES': {}\n    }; // This is the Widevine UUID from DASH IF IOP. The same exact string is\n    // used in MPDs with Widevine encrypted streams.\n\n    const widevineUuid = 'urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed'; // group segments into numbered timelines delineated by discontinuities\n\n    let currentTimeline = 0; // the manifest is empty until the parse stream begins delivering data\n\n    this.manifest = {\n      allowCache: true,\n      discontinuityStarts: [],\n      segments: []\n    }; // keep track of the last seen segment's byte range end, as segments are not required\n    // to provide the offset, in which case it defaults to the next byte after the\n    // previous segment\n\n    let lastByterangeEnd = 0; // keep track of the last seen part's byte range end.\n\n    let lastPartByterangeEnd = 0;\n    this.on('end', () => {\n      // only add preloadSegment if we don't yet have a uri for it.\n      // and we actually have parts/preloadHints\n      if (currentUri.uri || !currentUri.parts && !currentUri.preloadHints) {\n        return;\n      }\n\n      if (!currentUri.map && currentMap) {\n        currentUri.map = currentMap;\n      }\n\n      if (!currentUri.key && key) {\n        currentUri.key = key;\n      }\n\n      if (!currentUri.timeline && typeof currentTimeline === 'number') {\n        currentUri.timeline = currentTimeline;\n      }\n\n      this.manifest.preloadSegment = currentUri;\n    }); // update the manifest with the m3u8 entry from the parse stream\n\n    this.parseStream.on('data', function (entry) {\n      let mediaGroup;\n      let rendition;\n      ({\n        tag() {\n          // switch based on the tag type\n          (({\n            version() {\n              if (entry.version) {\n                this.manifest.version = entry.version;\n              }\n            },\n\n            'allow-cache'() {\n              this.manifest.allowCache = entry.allowed;\n\n              if (!('allowed' in entry)) {\n                this.trigger('info', {\n                  message: 'defaulting allowCache to YES'\n                });\n                this.manifest.allowCache = true;\n              }\n            },\n\n            byterange() {\n              const byterange = {};\n\n              if ('length' in entry) {\n                currentUri.byterange = byterange;\n                byterange.length = entry.length;\n\n                if (!('offset' in entry)) {\n                  /*\n                   * From the latest spec (as of this writing):\n                   * https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.2.2\n                   *\n                   * Same text since EXT-X-BYTERANGE's introduction in draft 7:\n                   * https://tools.ietf.org/html/draft-pantos-http-live-streaming-07#section-3.3.1)\n                   *\n                   * \"If o [offset] is not present, the sub-range begins at the next byte\n                   * following the sub-range of the previous media segment.\"\n                   */\n                  entry.offset = lastByterangeEnd;\n                }\n              }\n\n              if ('offset' in entry) {\n                currentUri.byterange = byterange;\n                byterange.offset = entry.offset;\n              }\n\n              lastByterangeEnd = byterange.offset + byterange.length;\n            },\n\n            endlist() {\n              this.manifest.endList = true;\n            },\n\n            inf() {\n              if (!('mediaSequence' in this.manifest)) {\n                this.manifest.mediaSequence = 0;\n                this.trigger('info', {\n                  message: 'defaulting media sequence to zero'\n                });\n              }\n\n              if (!('discontinuitySequence' in this.manifest)) {\n                this.manifest.discontinuitySequence = 0;\n                this.trigger('info', {\n                  message: 'defaulting discontinuity sequence to zero'\n                });\n              }\n\n              if (entry.duration > 0) {\n                currentUri.duration = entry.duration;\n              }\n\n              if (entry.duration === 0) {\n                currentUri.duration = 0.01;\n                this.trigger('info', {\n                  message: 'updating zero segment duration to a small value'\n                });\n              }\n\n              this.manifest.segments = uris;\n            },\n\n            key() {\n              if (!entry.attributes) {\n                this.trigger('warn', {\n                  message: 'ignoring key declaration without attribute list'\n                });\n                return;\n              } // clear the active encryption key\n\n\n              if (entry.attributes.METHOD === 'NONE') {\n                key = null;\n                return;\n              }\n\n              if (!entry.attributes.URI) {\n                this.trigger('warn', {\n                  message: 'ignoring key declaration without URI'\n                });\n                return;\n              }\n\n              if (entry.attributes.KEYFORMAT === 'com.apple.streamingkeydelivery') {\n                this.manifest.contentProtection = this.manifest.contentProtection || {}; // TODO: add full support for this.\n\n                this.manifest.contentProtection['com.apple.fps.1_0'] = {\n                  attributes: entry.attributes\n                };\n                return;\n              }\n\n              if (entry.attributes.KEYFORMAT === 'com.microsoft.playready') {\n                this.manifest.contentProtection = this.manifest.contentProtection || {}; // TODO: add full support for this.\n\n                this.manifest.contentProtection['com.microsoft.playready'] = {\n                  uri: entry.attributes.URI\n                };\n                return;\n              } // check if the content is encrypted for Widevine\n              // Widevine/HLS spec: https://storage.googleapis.com/wvdocs/Widevine_DRM_HLS.pdf\n\n\n              if (entry.attributes.KEYFORMAT === widevineUuid) {\n                const VALID_METHODS = ['SAMPLE-AES', 'SAMPLE-AES-CTR', 'SAMPLE-AES-CENC'];\n\n                if (VALID_METHODS.indexOf(entry.attributes.METHOD) === -1) {\n                  this.trigger('warn', {\n                    message: 'invalid key method provided for Widevine'\n                  });\n                  return;\n                }\n\n                if (entry.attributes.METHOD === 'SAMPLE-AES-CENC') {\n                  this.trigger('warn', {\n                    message: 'SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead'\n                  });\n                }\n\n                if (entry.attributes.URI.substring(0, 23) !== 'data:text/plain;base64,') {\n                  this.trigger('warn', {\n                    message: 'invalid key URI provided for Widevine'\n                  });\n                  return;\n                }\n\n                if (!(entry.attributes.KEYID && entry.attributes.KEYID.substring(0, 2) === '0x')) {\n                  this.trigger('warn', {\n                    message: 'invalid key ID provided for Widevine'\n                  });\n                  return;\n                } // if Widevine key attributes are valid, store them as `contentProtection`\n                // on the manifest to emulate Widevine tag structure in a DASH mpd\n\n\n                this.manifest.contentProtection = this.manifest.contentProtection || {};\n                this.manifest.contentProtection['com.widevine.alpha'] = {\n                  attributes: {\n                    schemeIdUri: entry.attributes.KEYFORMAT,\n                    // remove '0x' from the key id string\n                    keyId: entry.attributes.KEYID.substring(2)\n                  },\n                  // decode the base64-encoded PSSH box\n                  pssh: (0,_videojs_vhs_utils_es_decode_b64_to_uint8_array_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(entry.attributes.URI.split(',')[1])\n                };\n                return;\n              }\n\n              if (!entry.attributes.METHOD) {\n                this.trigger('warn', {\n                  message: 'defaulting key method to AES-128'\n                });\n              } // setup an encryption key for upcoming segments\n\n\n              key = {\n                method: entry.attributes.METHOD || 'AES-128',\n                uri: entry.attributes.URI\n              };\n\n              if (typeof entry.attributes.IV !== 'undefined') {\n                key.iv = entry.attributes.IV;\n              }\n            },\n\n            'media-sequence'() {\n              if (!isFinite(entry.number)) {\n                this.trigger('warn', {\n                  message: 'ignoring invalid media sequence: ' + entry.number\n                });\n                return;\n              }\n\n              this.manifest.mediaSequence = entry.number;\n            },\n\n            'discontinuity-sequence'() {\n              if (!isFinite(entry.number)) {\n                this.trigger('warn', {\n                  message: 'ignoring invalid discontinuity sequence: ' + entry.number\n                });\n                return;\n              }\n\n              this.manifest.discontinuitySequence = entry.number;\n              currentTimeline = entry.number;\n            },\n\n            'playlist-type'() {\n              if (!/VOD|EVENT/.test(entry.playlistType)) {\n                this.trigger('warn', {\n                  message: 'ignoring unknown playlist type: ' + entry.playlist\n                });\n                return;\n              }\n\n              this.manifest.playlistType = entry.playlistType;\n            },\n\n            map() {\n              currentMap = {};\n\n              if (entry.uri) {\n                currentMap.uri = entry.uri;\n              }\n\n              if (entry.byterange) {\n                currentMap.byterange = entry.byterange;\n              }\n\n              if (key) {\n                currentMap.key = key;\n              }\n            },\n\n            'stream-inf'() {\n              this.manifest.playlists = uris;\n              this.manifest.mediaGroups = this.manifest.mediaGroups || defaultMediaGroups;\n\n              if (!entry.attributes) {\n                this.trigger('warn', {\n                  message: 'ignoring empty stream-inf attributes'\n                });\n                return;\n              }\n\n              if (!currentUri.attributes) {\n                currentUri.attributes = {};\n              }\n\n              (0,_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(currentUri.attributes, entry.attributes);\n            },\n\n            media() {\n              this.manifest.mediaGroups = this.manifest.mediaGroups || defaultMediaGroups;\n\n              if (!(entry.attributes && entry.attributes.TYPE && entry.attributes['GROUP-ID'] && entry.attributes.NAME)) {\n                this.trigger('warn', {\n                  message: 'ignoring incomplete or missing media group'\n                });\n                return;\n              } // find the media group, creating defaults as necessary\n\n\n              const mediaGroupType = this.manifest.mediaGroups[entry.attributes.TYPE];\n              mediaGroupType[entry.attributes['GROUP-ID']] = mediaGroupType[entry.attributes['GROUP-ID']] || {};\n              mediaGroup = mediaGroupType[entry.attributes['GROUP-ID']]; // collect the rendition metadata\n\n              rendition = {\n                default: /yes/i.test(entry.attributes.DEFAULT)\n              };\n\n              if (rendition.default) {\n                rendition.autoselect = true;\n              } else {\n                rendition.autoselect = /yes/i.test(entry.attributes.AUTOSELECT);\n              }\n\n              if (entry.attributes.LANGUAGE) {\n                rendition.language = entry.attributes.LANGUAGE;\n              }\n\n              if (entry.attributes.URI) {\n                rendition.uri = entry.attributes.URI;\n              }\n\n              if (entry.attributes['INSTREAM-ID']) {\n                rendition.instreamId = entry.attributes['INSTREAM-ID'];\n              }\n\n              if (entry.attributes.CHARACTERISTICS) {\n                rendition.characteristics = entry.attributes.CHARACTERISTICS;\n              }\n\n              if (entry.attributes.FORCED) {\n                rendition.forced = /yes/i.test(entry.attributes.FORCED);\n              } // insert the new rendition\n\n\n              mediaGroup[entry.attributes.NAME] = rendition;\n            },\n\n            discontinuity() {\n              currentTimeline += 1;\n              currentUri.discontinuity = true;\n              this.manifest.discontinuityStarts.push(uris.length);\n            },\n\n            'program-date-time'() {\n              if (typeof this.manifest.dateTimeString === 'undefined') {\n                // PROGRAM-DATE-TIME is a media-segment tag, but for backwards\n                // compatibility, we add the first occurence of the PROGRAM-DATE-TIME tag\n                // to the manifest object\n                // TODO: Consider removing this in future major version\n                this.manifest.dateTimeString = entry.dateTimeString;\n                this.manifest.dateTimeObject = entry.dateTimeObject;\n              }\n\n              currentUri.dateTimeString = entry.dateTimeString;\n              currentUri.dateTimeObject = entry.dateTimeObject;\n            },\n\n            targetduration() {\n              if (!isFinite(entry.duration) || entry.duration < 0) {\n                this.trigger('warn', {\n                  message: 'ignoring invalid target duration: ' + entry.duration\n                });\n                return;\n              }\n\n              this.manifest.targetDuration = entry.duration;\n              setHoldBack.call(this, this.manifest);\n            },\n\n            start() {\n              if (!entry.attributes || isNaN(entry.attributes['TIME-OFFSET'])) {\n                this.trigger('warn', {\n                  message: 'ignoring start declaration without appropriate attribute list'\n                });\n                return;\n              }\n\n              this.manifest.start = {\n                timeOffset: entry.attributes['TIME-OFFSET'],\n                precise: entry.attributes.PRECISE\n              };\n            },\n\n            'cue-out'() {\n              currentUri.cueOut = entry.data;\n            },\n\n            'cue-out-cont'() {\n              currentUri.cueOutCont = entry.data;\n            },\n\n            'cue-in'() {\n              currentUri.cueIn = entry.data;\n            },\n\n            'skip'() {\n              this.manifest.skip = camelCaseKeys(entry.attributes);\n              this.warnOnMissingAttributes_('#EXT-X-SKIP', entry.attributes, ['SKIPPED-SEGMENTS']);\n            },\n\n            'part'() {\n              hasParts = true; // parts are always specifed before a segment\n\n              const segmentIndex = this.manifest.segments.length;\n              const part = camelCaseKeys(entry.attributes);\n              currentUri.parts = currentUri.parts || [];\n              currentUri.parts.push(part);\n\n              if (part.byterange) {\n                if (!part.byterange.hasOwnProperty('offset')) {\n                  part.byterange.offset = lastPartByterangeEnd;\n                }\n\n                lastPartByterangeEnd = part.byterange.offset + part.byterange.length;\n              }\n\n              const partIndex = currentUri.parts.length - 1;\n              this.warnOnMissingAttributes_(`#EXT-X-PART #${partIndex} for segment #${segmentIndex}`, entry.attributes, ['URI', 'DURATION']);\n\n              if (this.manifest.renditionReports) {\n                this.manifest.renditionReports.forEach((r, i) => {\n                  if (!r.hasOwnProperty('lastPart')) {\n                    this.trigger('warn', {\n                      message: `#EXT-X-RENDITION-REPORT #${i} lacks required attribute(s): LAST-PART`\n                    });\n                  }\n                });\n              }\n            },\n\n            'server-control'() {\n              const attrs = this.manifest.serverControl = camelCaseKeys(entry.attributes);\n\n              if (!attrs.hasOwnProperty('canBlockReload')) {\n                attrs.canBlockReload = false;\n                this.trigger('info', {\n                  message: '#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false'\n                });\n              }\n\n              setHoldBack.call(this, this.manifest);\n\n              if (attrs.canSkipDateranges && !attrs.hasOwnProperty('canSkipUntil')) {\n                this.trigger('warn', {\n                  message: '#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set'\n                });\n              }\n            },\n\n            'preload-hint'() {\n              // parts are always specifed before a segment\n              const segmentIndex = this.manifest.segments.length;\n              const hint = camelCaseKeys(entry.attributes);\n              const isPart = hint.type && hint.type === 'PART';\n              currentUri.preloadHints = currentUri.preloadHints || [];\n              currentUri.preloadHints.push(hint);\n\n              if (hint.byterange) {\n                if (!hint.byterange.hasOwnProperty('offset')) {\n                  // use last part byterange end or zero if not a part.\n                  hint.byterange.offset = isPart ? lastPartByterangeEnd : 0;\n\n                  if (isPart) {\n                    lastPartByterangeEnd = hint.byterange.offset + hint.byterange.length;\n                  }\n                }\n              }\n\n              const index = currentUri.preloadHints.length - 1;\n              this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${index} for segment #${segmentIndex}`, entry.attributes, ['TYPE', 'URI']);\n\n              if (!hint.type) {\n                return;\n              } // search through all preload hints except for the current one for\n              // a duplicate type.\n\n\n              for (let i = 0; i < currentUri.preloadHints.length - 1; i++) {\n                const otherHint = currentUri.preloadHints[i];\n\n                if (!otherHint.type) {\n                  continue;\n                }\n\n                if (otherHint.type === hint.type) {\n                  this.trigger('warn', {\n                    message: `#EXT-X-PRELOAD-HINT #${index} for segment #${segmentIndex} has the same TYPE ${hint.type} as preload hint #${i}`\n                  });\n                }\n              }\n            },\n\n            'rendition-report'() {\n              const report = camelCaseKeys(entry.attributes);\n              this.manifest.renditionReports = this.manifest.renditionReports || [];\n              this.manifest.renditionReports.push(report);\n              const index = this.manifest.renditionReports.length - 1;\n              const required = ['LAST-MSN', 'URI'];\n\n              if (hasParts) {\n                required.push('LAST-PART');\n              }\n\n              this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${index}`, entry.attributes, required);\n            },\n\n            'part-inf'() {\n              this.manifest.partInf = camelCaseKeys(entry.attributes);\n              this.warnOnMissingAttributes_('#EXT-X-PART-INF', entry.attributes, ['PART-TARGET']);\n\n              if (this.manifest.partInf.partTarget) {\n                this.manifest.partTargetDuration = this.manifest.partInf.partTarget;\n              }\n\n              setHoldBack.call(this, this.manifest);\n            }\n\n          })[entry.tagType] || noop).call(self);\n        },\n\n        uri() {\n          currentUri.uri = entry.uri;\n          uris.push(currentUri); // if no explicit duration was declared, use the target duration\n\n          if (this.manifest.targetDuration && !('duration' in currentUri)) {\n            this.trigger('warn', {\n              message: 'defaulting segment duration to the target duration'\n            });\n            currentUri.duration = this.manifest.targetDuration;\n          } // annotate with encryption information, if necessary\n\n\n          if (key) {\n            currentUri.key = key;\n          }\n\n          currentUri.timeline = currentTimeline; // annotate with initialization segment information, if necessary\n\n          if (currentMap) {\n            currentUri.map = currentMap;\n          } // reset the last byterange end as it needs to be 0 between parts\n\n\n          lastPartByterangeEnd = 0; // prepare for the next URI\n\n          currentUri = {};\n        },\n\n        comment() {// comments are not important for playback\n        },\n\n        custom() {\n          // if this is segment-level data attach the output to the segment\n          if (entry.segment) {\n            currentUri.custom = currentUri.custom || {};\n            currentUri.custom[entry.customType] = entry.data; // if this is manifest-level data attach to the top level manifest object\n          } else {\n            this.manifest.custom = this.manifest.custom || {};\n            this.manifest.custom[entry.customType] = entry.data;\n          }\n        }\n\n      })[entry.type].call(self);\n    });\n  }\n\n  warnOnMissingAttributes_(identifier, attributes, required) {\n    const missing = [];\n    required.forEach(function (key) {\n      if (!attributes.hasOwnProperty(key)) {\n        missing.push(key);\n      }\n    });\n\n    if (missing.length) {\n      this.trigger('warn', {\n        message: `${identifier} lacks required attribute(s): ${missing.join(', ')}`\n      });\n    }\n  }\n  /**\n   * Parse the input string and update the manifest object.\n   *\n   * @param {string} chunk a potentially incomplete portion of the manifest\n   */\n\n\n  push(chunk) {\n    this.lineStream.push(chunk);\n  }\n  /**\n   * Flush any remaining input. This can be handy if the last line of an M3U8\n   * manifest did not contain a trailing newline but the file has been\n   * completely received.\n   */\n\n\n  end() {\n    // flush any buffered input\n    this.lineStream.push('\\n');\n    this.trigger('end');\n  }\n  /**\n   * Add an additional parser for non-standard tags\n   *\n   * @param {Object}   options              a map of options for the added parser\n   * @param {RegExp}   options.expression   a regular expression to match the custom header\n   * @param {string}   options.type         the type to register to the output\n   * @param {Function} [options.dataParser] function to parse the line into an object\n   * @param {boolean}  [options.segment]    should tag data be attached to the segment object\n   */\n\n\n  addParser(options) {\n    this.parseStream.addParser(options);\n  }\n  /**\n   * Add a custom header mapper\n   *\n   * @param {Object}   options\n   * @param {RegExp}   options.expression   a regular expression to match the custom header\n   * @param {Function} options.map          function to translate tag into a different tag\n   */\n\n\n  addTagMapper(options) {\n    this.parseStream.addTagMapper(options);\n  }\n\n}\n\n\n\n\n/***/ }),\n\n/***/ \"./node_modules/@babel/runtime/helpers/esm/extends.js\":\n/*!************************************************************!*\\\n  !*** ./node_modules/@babel/runtime/helpers/esm/extends.js ***!\n  \\************************************************************/\n/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ _extends)\n/* harmony export */ });\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/compat get default export */\n/******/ \t(() => {\n/******/ \t\t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t\t__webpack_require__.n = (module) => {\n/******/ \t\t\tvar getter = module && module.__esModule ?\n/******/ \t\t\t\t() => (module['default']) :\n/******/ \t\t\t\t() => (module);\n/******/ \t\t\t__webpack_require__.d(getter, { a: getter });\n/******/ \t\t\treturn getter;\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t(() => {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = (exports, definition) => {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/global */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.g = (function() {\n/******/ \t\t\tif (typeof globalThis === 'object') return globalThis;\n/******/ \t\t\ttry {\n/******/ \t\t\t\treturn this || new Function('return this')();\n/******/ \t\t\t} catch (e) {\n/******/ \t\t\t\tif (typeof window === 'object') return window;\n/******/ \t\t\t}\n/******/ \t\t})();\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t(() => {\n/******/ \t\t__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\n/******/ \t})();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t(() => {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = (exports) => {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t})();\n/******/ \t\n/************************************************************************/\n/******/ \t\n/******/ \t// startup\n/******/ \t// Load entry module and return exports\n/******/ \t// This entry module is referenced by other modules so it can't be inlined\n/******/ \tvar __webpack_exports__ = __webpack_require__(\"./src/app.worker.ts\");\n/******/ \t\n/******/ })()\n;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0JBQWdCLDBFQUFRO0FBQ3hCO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx3REFBd0Q7O0FBRXhEO0FBQ0E7QUFDQTtBQUNBOztBQUVBLCtEQUErRCxFQUFFO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0U7O0FBRXhFO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxRQUFROzs7QUFHUjtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxVQUFVO0FBQ3ZCLGFBQWEsVUFBVTtBQUN2QixhQUFhLFVBQVU7QUFDdkIsYUFBYSxVQUFVO0FBQ3ZCLGFBQWEsVUFB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O0FBQ0E7QUFDQTs7QUFFQTs7QUFFMkM7Ozs7Ozs7Ozs7Ozs7Ozs7QUM5OUM1QjtBQUNmO0FBQ0Esb0JBQW9CLHNCQUFzQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7VUNiQTtVQUNBOztVQUVBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBOztVQUVBO1VBQ0E7O1VBRUE7VUFDQTtVQUNBOzs7OztXQ3RCQTtXQUNBO1dBQ0E7V0FDQTtXQUNBO1dBQ0EsaUNBQWlDLFdBQVc7V0FDNUM7V0FDQTs7Ozs7V0NQQTtXQUNBO1dBQ0E7V0FDQTtXQUNBLHlDQUF5Qyx3Q0FBd0M7V0FDakY7V0FDQTtXQUNBOzs7OztXQ1BBO1dBQ0E7V0FDQTtXQUNBO1dBQ0EsR0FBRztXQUNIO1dBQ0E7V0FDQSxDQUFDOzs7OztXQ1BEOzs7OztXQ0FBO1dBQ0E7V0FDQTtXQUNBLHVEQUF1RCxpQkFBaUI7V0FDeEU7V0FDQSxnREFBZ0QsYUFBYTtXQUM3RDs7Ozs7VUVOQTtVQUNBO1VBQ0E7VUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9hcHAuY29udHJvbGxlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvYXBwLndvcmtlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZGVjb3JhdG9yL2NvbnRyb2xsZXIuZGVjb3JhdG9yLnRzIiwid2VicGFjazovLy8uL3NyYy9kZWNvcmF0b3IvaGFuZGxlci5kZWNvcmF0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvcGxheWVyL3BsYXllci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbW9kdWxlcy9zdHJlYW0vaW50ZXJmYWNlL3N0cmVhbS5lbnVtLnRzIiwid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL3N0cmVhbS9pbnRlcmZhY2Uvc3RyZWFtLnR5cGVzLnRzIiwid2VicGFjazovLy8uL3NyYy9tb2R1bGVzL3N0cmVhbS9zdHJlYW0udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21vZHVsZXMvdHdpdGNoL3R3aXRjaC5zZXJ2aWNlLnRzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9AdmlkZW9qcy92aHMtdXRpbHMvZXMvZGVjb2RlLWI2NC10by11aW50OC1hcnJheS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQHZpZGVvanMvdmhzLXV0aWxzL2VzL3N0cmVhbS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvZ2xvYmFsL3dpbmRvdy5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvbTN1OC1wYXJzZXIvZGlzdC9tM3U4LXBhcnNlci5lcy5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZXh0ZW5kcy5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovLy93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYmVmb3JlLXN0YXJ0dXAiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly8vd2VicGFjay9hZnRlci1zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5BcHBDb250cm9sbGVyID0gdm9pZCAwO1xyXG5jb25zdCBjb250cm9sbGVyX2RlY29yYXRvcl8xID0gcmVxdWlyZShcIi4vZGVjb3JhdG9yL2NvbnRyb2xsZXIuZGVjb3JhdG9yXCIpO1xyXG5jb25zdCBoYW5kbGVyX2RlY29yYXRvcl8xID0gcmVxdWlyZShcIi4vZGVjb3JhdG9yL2hhbmRsZXIuZGVjb3JhdG9yXCIpO1xyXG5jb25zdCBzdHJlYW1fZW51bV8xID0gcmVxdWlyZShcIi4vbW9kdWxlcy9zdHJlYW0vaW50ZXJmYWNlL3N0cmVhbS5lbnVtXCIpO1xyXG5sZXQgQXBwQ29udHJvbGxlciA9IGNsYXNzIEFwcENvbnRyb2xsZXIge1xyXG4gICAgY29uc3RydWN0b3IoYXBwU2VydmljZSkge1xyXG4gICAgICAgIHRoaXMuYXBwU2VydmljZSA9IGFwcFNlcnZpY2U7XHJcbiAgICAgICAgdGhpcy5nZXRTZXR0aW5ncyA9ICgpID0+IGdsb2JhbC5wb3N0TWVzc2FnZSh7IHR5cGU6IFwiZ2V0U2V0dGluZ3NcIiB9KTtcclxuICAgICAgICB0aGlzLmdldFNldHRpbmdzKCk7XHJcbiAgICB9XHJcbiAgICBzZXRJbnRlZ3JpdHkoZGF0YSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwU2VydmljZS5zZXRJbnRlZ3JpdHlUb2tlbihKU09OLnBhcnNlKGRhdGEudmFsdWUpLnRva2VuKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG9uQ2hhbm5lbCh1cmwsIG9wdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIGdsb2JhbC5yZXF1ZXN0KHVybCwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3Igb24gY2hhbm5lbCBsb2FkXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHQgPSB5aWVsZCByZXNwb25zZS50ZXh0KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoYW5uZWxOYW1lID0gL2hsc1xcLyguKikubTN1OC9nbS5leGVjKHVybCkgfHwgW107XHJcbiAgICAgICAgICAgIHlpZWxkIHRoaXMuYXBwU2VydmljZS5zZXRDaGFubmVsKGNoYW5uZWxOYW1lWzFdKTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZSh0ZXh0KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG9uRmV0Y2godXJsLCBvcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgYm9keSA9IHlpZWxkICh5aWVsZCByZXF1ZXN0KHVybCwgb3B0aW9ucykpLnRleHQoKTtcclxuICAgICAgICAgICAgY29uc3QgcGxheWxpc3QgPSB5aWVsZCB0aGlzLmFwcFNlcnZpY2Uub25GZXRjaChib2R5KTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShwbGF5bGlzdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBvbkNoYW5uZWxQaWN0dXJlKHVybCwgb3B0aW9ucykge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgZ2xvYmFsLnJlcXVlc3QodXJsLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciBvbiBjaGFubmVsIGxvYWRcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdGV4dCA9IHlpZWxkIHJlc3BvbnNlLnRleHQoKTtcclxuICAgICAgICAgICAgeWllbGQgdGhpcy5hcHBTZXJ2aWNlLmN1cnJlbnRTdHJlYW0oKS5zZXRTdHJlYW1BY2Nlc3ModGV4dCwgc3RyZWFtX2VudW1fMS5TdHJlYW1UeXBlLlBJQ1RVUkUpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInBpY3R1cmUtYnktcGljdHVyZVwiLCB0ZXh0KTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc2V0U2V0dGluZ3MoZGF0YSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwU2VydmljZS5zZXRTZXR0aW5ncyhkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHNldFF1YWxpdHkoZGF0YSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwU2VydmljZS5xdWFsaXR5ID0gZGF0YS52YWx1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuX19kZWNvcmF0ZShbXHJcbiAgICAoMCwgaGFuZGxlcl9kZWNvcmF0b3JfMS5NZXNzYWdlKShcInNldEludGVncml0eVwiKVxyXG5dLCBBcHBDb250cm9sbGVyLnByb3RvdHlwZSwgXCJzZXRJbnRlZ3JpdHlcIiwgbnVsbCk7XHJcbl9fZGVjb3JhdGUoW1xyXG4gICAgKDAsIGhhbmRsZXJfZGVjb3JhdG9yXzEuRmV0Y2gpKFwidXNoZXIudHR2bncubmV0L2FwaS9jaGFubmVsL2hscy9cIiwgXCJwaWN0dXJlLWJ5LXBpY3R1cmVcIilcclxuXSwgQXBwQ29udHJvbGxlci5wcm90b3R5cGUsIFwib25DaGFubmVsXCIsIG51bGwpO1xyXG5fX2RlY29yYXRlKFtcclxuICAgICgwLCBoYW5kbGVyX2RlY29yYXRvcl8xLkZldGNoKShcImhscy50dHZudy5uZXQvdjEvcGxheWxpc3QvXCIpXHJcbl0sIEFwcENvbnRyb2xsZXIucHJvdG90eXBlLCBcIm9uRmV0Y2hcIiwgbnVsbCk7XHJcbl9fZGVjb3JhdGUoW1xyXG4gICAgKDAsIGhhbmRsZXJfZGVjb3JhdG9yXzEuRmV0Y2gpKFwicGljdHVyZS1ieS1waWN0dXJlXCIpXHJcbl0sIEFwcENvbnRyb2xsZXIucHJvdG90eXBlLCBcIm9uQ2hhbm5lbFBpY3R1cmVcIiwgbnVsbCk7XHJcbl9fZGVjb3JhdGUoW1xyXG4gICAgKDAsIGhhbmRsZXJfZGVjb3JhdG9yXzEuTWVzc2FnZSkoXCJzZXRTZXR0aW5nc1wiKVxyXG5dLCBBcHBDb250cm9sbGVyLnByb3RvdHlwZSwgXCJzZXRTZXR0aW5nc1wiLCBudWxsKTtcclxuX19kZWNvcmF0ZShbXHJcbiAgICAoMCwgaGFuZGxlcl9kZWNvcmF0b3JfMS5NZXNzYWdlKShcInNldFF1YWxpdHlcIilcclxuXSwgQXBwQ29udHJvbGxlci5wcm90b3R5cGUsIFwic2V0UXVhbGl0eVwiLCBudWxsKTtcclxuQXBwQ29udHJvbGxlciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgKDAsIGNvbnRyb2xsZXJfZGVjb3JhdG9yXzEuQ29udHJvbGxlcikoKVxyXG5dLCBBcHBDb250cm9sbGVyKTtcclxuZXhwb3J0cy5BcHBDb250cm9sbGVyID0gQXBwQ29udHJvbGxlcjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2Jhc2U2NCxleUoyWlhKemFXOXVJam96TENKbWFXeGxJam9pWVhCd0xtTnZiblJ5YjJ4c1pYSXVhbk1pTENKemIzVnlZMlZTYjI5MElqb2lJaXdpYzI5MWNtTmxjeUk2V3lJdUxpOXpjbU12WVhCd0xtTnZiblJ5YjJ4c1pYSXVkSE1pWFN3aWJtRnRaWE1pT2x0ZExDSnRZWEJ3YVc1bmN5STZJanM3T3pzN096czdPenM3T3pzN096czdPMEZCUVVFc01rVkJRVGhFTzBGQlF6bEVMSEZGUVVFclJEdEJRVVV2UkN4M1JVRkJiMFU3UVVGSGNFVXNTVUZCWVN4aFFVRmhMRWRCUVRGQ0xFMUJRV0VzWVVGQllUdEpRVWQ0UWl4WlFVRTJRaXhWUVVGclFqdFJRVUZzUWl4bFFVRlZMRWRCUVZZc1ZVRkJWU3hEUVVGUk8xRkJSaTlETEdkQ1FVRlhMRWRCUVVjc1IwRkJSeXhGUVVGRkxFTkJRVU1zVFVGQlRTeERRVUZETEZkQlFWY3NRMEZCUXl4RlFVRkZMRWxCUVVrc1JVRkJSU3hoUVVGaExFVkJRVVVzUTBGQlF5eERRVUZETzFGQlJ6bEVMRWxCUVVrc1EwRkJReXhYUVVGWExFVkJRVVVzUTBGQlF6dEpRVU55UWl4RFFVRkRPMGxCUjBzc1dVRkJXU3hEUVVGRExFbEJRVk03TzFsQlF6RkNMRWxCUVVrc1EwRkJReXhWUVVGVkxFTkJRVU1zYVVKQlFXbENMRU5CUVVNc1NVRkJTU3hEUVVGRExFdEJRVXNzUTBGQlF5eEpRVUZKTEVOQlFVTXNTMEZCU3l4RFFVRkRMRU5CUVVNc1MwRkJTeXhEUVVGRExFTkJRVU03VVVGRGJFVXNRMEZCUXp0TFFVRkJPMGxCUjBzc1UwRkJVeXhEUVVGRExFZEJRVmNzUlVGQlJTeFBRVUZaT3p0WlFVTjJReXhOUVVGTkxGRkJRVkVzUjBGQllTeE5RVUZOTEUxQlFVMHNRMEZCUXl4UFFVRlBMRU5CUVVNc1IwRkJSeXhGUVVGRkxFOUJRVThzUTBGQlF5eERRVUZETzFsQlF6bEVMRWxCUVVrc1EwRkJReXhSUVVGUkxFTkJRVU1zUlVGQlJTeEZRVUZGTzJkQ1FVTm9RaXhQUVVGUExFTkJRVU1zUjBGQlJ5eERRVUZETEhWQ1FVRjFRaXhEUVVGRExFTkJRVU03WjBKQlEzSkRMRTlCUVU4c1VVRkJVU3hEUVVGRE8yRkJRMnBDTzFsQlJVUXNUVUZCVFN4SlFVRkpMRWRCUVVjc1RVRkJUU3hSUVVGUkxFTkJRVU1zU1VGQlNTeEZRVUZGTEVOQlFVTTdXVUZEYmtNc1RVRkJUU3hYUVVGWExFZEJRVWNzYTBKQlFXdENMRU5CUVVNc1NVRkJTU3hEUVVGRExFZEJRVWNzUTBGQlF5eEpRVUZKTEVWQlFVVXNRMEZCUXp0WlFVVjJSQ3hOUVVGTkxFbEJRVWtzUTBGQlF5eFZRVUZWTEVOQlFVTXNWVUZCVlN4RFFVRkRMRmRCUVZjc1EwRkJReXhEUVVGRExFTkJRVU1zUTBGQlF5eERRVUZETzFsQlEycEVMRTlCUVU4c1NVRkJTU3hSUVVGUkxFTkJRVU1zU1VGQlNTeERRVUZETEVOQlFVTTdVVUZETlVJc1EwRkJRenRMUVVGQk8wbEJSMHNzVDBGQlR5eERRVUZETEVkQlFWY3NSVUZCUlN4UFFVRlpPenRaUVVOeVF5eE5RVUZOTEVsQlFVa3NSMEZCVnl4TlFVRk5MRU5CUVVNc1RVRkJUU3hQUVVGUExFTkJRVU1zUjBGQlJ5eEZRVUZGTEU5QlFVOHNRMEZCUXl4RFFVRkRMRU5CUVVNc1NVRkJTU3hGUVVGRkxFTkJRVU03V1VGRGFFVXNUVUZCVFN4UlFVRlJMRWRCUVVjc1RVRkJUU3hKUVVGSkxFTkJRVU1zVlVGQlZTeERRVUZETEU5QlFVOHNRMEZCUXl4SlFVRkpMRU5CUVVNc1EwRkJRenRaUVVOeVJDeFBRVUZQTEVsQlFVa3NVVUZCVVN4RFFVRkRMRkZCUVZFc1EwRkJReXhEUVVGRE8xRkJRMmhETEVOQlFVTTdTMEZCUVR0SlFVZExMR2RDUVVGblFpeERRVUZETEVkQlFWY3NSVUZCUlN4UFFVRlpPenRaUVVNNVF5eE5RVUZOTEZGQlFWRXNSMEZCWVN4TlFVRk5MRTFCUVUwc1EwRkJReXhQUVVGUExFTkJRVU1zUjBGQlJ5eEZRVUZGTEU5QlFVOHNRMEZCUXl4RFFVRkRPMWxCUXpsRUxFbEJRVWtzUTBGQlF5eFJRVUZSTEVOQlFVTXNSVUZCUlN4RlFVRkZPMmRDUVVOb1FpeFBRVUZQTEVOQlFVTXNSMEZCUnl4RFFVRkRMSFZDUVVGMVFpeERRVUZETEVOQlFVTTdaMEpCUTNKRExFOUJRVThzVVVGQlVTeERRVUZETzJGQlEycENPMWxCUlVRc1RVRkJUU3hKUVVGSkxFZEJRVWNzVFVGQlRTeFJRVUZSTEVOQlFVTXNTVUZCU1N4RlFVRkZMRU5CUVVNN1dVRkZia01zVFVGQlRTeEpRVUZKTEVOQlFVTXNWVUZCVlN4RFFVRkRMR0ZCUVdFc1JVRkJSU3hEUVVGRExHVkJRV1VzUTBGQlF5eEpRVUZKTEVWQlFVVXNkMEpCUVZVc1EwRkJReXhQUVVGUExFTkJRVU1zUTBGQlF6dFpRVU5vUml4UFFVRlBMRU5CUVVNc1IwRkJSeXhEUVVGRExHOUNRVUZ2UWl4RlFVRkZMRWxCUVVrc1EwRkJReXhEUVVGRE8xbEJRM2hETEU5QlFVOHNTVUZCU1N4UlFVRlJMRVZCUVVVc1EwRkJRenRSUVVONFFpeERRVUZETzB0QlFVRTdTVUZIU3l4WFFVRlhMRU5CUVVNc1NVRkJVenM3V1VGRGVrSXNTVUZCU1N4RFFVRkRMRlZCUVZVc1EwRkJReXhYUVVGWExFTkJRVU1zU1VGQlNTeERRVUZETEVOQlFVTTdVVUZEY0VNc1EwRkJRenRMUVVGQk8wbEJSMHNzVlVGQlZTeERRVUZETEVsQlFWTTdPMWxCUTNoQ0xFbEJRVWtzUTBGQlF5eFZRVUZWTEVOQlFVTXNUMEZCVHl4SFFVRkhMRWxCUVVrc1EwRkJReXhMUVVGTExFTkJRVU03VVVGRGRrTXNRMEZCUXp0TFFVRkJPME5CUTBZc1EwRkJRVHRCUVd4RVF6dEpRVVJETEVsQlFVRXNNa0pCUVU4c1JVRkJReXhqUVVGakxFTkJRVU03YVVSQlIzWkNPMEZCUjBRN1NVRkVReXhKUVVGQkxIbENRVUZMTEVWQlFVTXNhME5CUVd0RExFVkJRVVVzYjBKQlFXOUNMRU5CUVVNN09FTkJZUzlFTzBGQlIwUTdTVUZFUXl4SlFVRkJMSGxDUVVGTExFVkJRVU1zTkVKQlFUUkNMRU5CUVVNN05FTkJTMjVETzBGQlIwUTdTVUZFUXl4SlFVRkJMSGxDUVVGTExFVkJRVU1zYjBKQlFXOUNMRU5CUVVNN2NVUkJZVE5DTzBGQlIwUTdTVUZFUXl4SlFVRkJMREpDUVVGUExFVkJRVU1zWVVGQllTeERRVUZETzJkRVFVZDBRanRCUVVkRU8wbEJSRU1zU1VGQlFTd3lRa0ZCVHl4RlFVRkRMRmxCUVZrc1EwRkJRenNyUTBGSGNrSTdRVUY2UkZVc1lVRkJZVHRKUVVSNlFpeEpRVUZCTEdsRFFVRlZMRWRCUVVVN1IwRkRRU3hoUVVGaExFTkJNRVI2UWp0QlFURkVXU3h6UTBGQllTSjkiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGFwcF9jb250cm9sbGVyXzEgPSByZXF1aXJlKFwiLi9hcHAuY29udHJvbGxlclwiKTtcclxuY29uc3QgcGxheWVyXzEgPSByZXF1aXJlKFwiLi9tb2R1bGVzL3BsYXllci9wbGF5ZXJcIik7XHJcbmZ1bmN0aW9uIGFwcCgpIHtcclxuICAgIGdsb2JhbC5sb2dQcmludCA9ICh4KSA9PiBjb25zb2xlLmxvZyhcIltQdXJwbGVdOiBcIiwgeCk7XHJcbiAgICBnbG9iYWwuYXBwQ29udHJvbGxlciA9IG5ldyBhcHBfY29udHJvbGxlcl8xLkFwcENvbnRyb2xsZXIobmV3IHBsYXllcl8xLlBsYXllcigpKTtcclxuICAgIGdsb2JhbC5sb2dQcmludChcIlNjcmlwdCBydW5uaW5nXCIpO1xyXG59XHJcbmV4cG9ydHMuZGVmYXVsdCA9IGFwcDtcclxuZ2xvYmFsLnJlcXVlc3QgPSBnbG9iYWwuZmV0Y2g7XHJcbmdsb2JhbC5mZXRjaCA9ICh1cmwsIG9wdGlvbnMpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgaWYgKHR5cGVvZiB1cmwgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcm91dGVyTGlzdC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBpZiAodXJsLmluY2x1ZGVzKHJvdXRlckxpc3RbaV0ubWF0Y2gpICYmICF1cmwuaW5jbHVkZXMocm91dGVyTGlzdFtpXS5pZ25vcmUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2xvYmFsLmFwcENvbnRyb2xsZXJbcm91dGVyTGlzdFtpXS5wcm9wZXJ0eUtleV0odXJsLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBnbG9iYWwucmVxdWVzdC5hcHBseSh0aGlzLCBbdXJsLCBvcHRpb25zXSk7XHJcbn0pO1xyXG5hcHAoKTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2Jhc2U2NCxleUoyWlhKemFXOXVJam96TENKbWFXeGxJam9pWVhCd0xuZHZjbXRsY2k1cWN5SXNJbk52ZFhKalpWSnZiM1FpT2lJaUxDSnpiM1Z5WTJWeklqcGJJaTR1TDNOeVl5OWhjSEF1ZDI5eWEyVnlMblJ6SWwwc0ltNWhiV1Z6SWpwYlhTd2liV0Z3Y0dsdVozTWlPaUk3T3pzN096czdPenM3TzBGQlFVRXNjVVJCUVdsRU8wRkJRMnBFTEc5RVFVRnBSRHRCUVZOcVJDeFRRVUYzUWl4SFFVRkhPMGxCUTNwQ0xFMUJRVTBzUTBGQlF5eFJRVUZSTEVkQlFVY3NRMEZCUXl4RFFVRk5MRVZCUVVVc1JVRkJSU3hEUVVGRExFOUJRVThzUTBGQlF5eEhRVUZITEVOQlFVTXNXVUZCV1N4RlFVRkZMRU5CUVVNc1EwRkJReXhEUVVGRE8wbEJRek5FTEUxQlFVMHNRMEZCUXl4aFFVRmhMRWRCUVVjc1NVRkJTU3c0UWtGQllTeERRVUZETEVsQlFVa3NaVUZCVFN4RlFVRkZMRU5CUVVNc1EwRkJRenRKUVVWMlJDeE5RVUZOTEVOQlFVTXNVVUZCVVN4RFFVRkRMR2RDUVVGblFpeERRVUZETEVOQlFVTTdRVUZEY0VNc1EwRkJRenRCUVV4RUxITkNRVXRETzBGQlJVUXNUVUZCVFN4RFFVRkRMRTlCUVU4c1IwRkJSeXhOUVVGTkxFTkJRVU1zUzBGQlN5eERRVUZETzBGQlF6bENMRTFCUVUwc1EwRkJReXhMUVVGTExFZEJRVWNzUTBGQlR5eEhRVUZSTEVWQlFVVXNUMEZCV1N4RlFVRkZMRVZCUVVVN1NVRkRPVU1zU1VGQlNTeFBRVUZQTEVkQlFVY3NTMEZCU3l4UlFVRlJMRVZCUVVVN1VVRkRNMElzUzBGQlN5eEpRVUZKTEVOQlFVTXNSMEZCUnl4RFFVRkRMRVZCUVVVc1IwRkJSeXhIUVVGSExGVkJRVlVzUTBGQlF5eE5RVUZOTEVWQlFVVXNRMEZCUXl4SFFVRkhMRWRCUVVjc1JVRkJSU3hEUVVGRExFVkJRVVVzUlVGQlJUdFpRVU55UkN4SlFVRkpMRWRCUVVjc1EwRkJReXhSUVVGUkxFTkJRVU1zVlVGQlZTeERRVUZETEVOQlFVTXNRMEZCUXl4RFFVRkRMRXRCUVVzc1EwRkJReXhKUVVGSkxFTkJRVU1zUjBGQlJ5eERRVUZETEZGQlFWRXNRMEZCUXl4VlFVRlZMRU5CUVVNc1EwRkJReXhEUVVGRExFTkJRVU1zVFVGQlR5eERRVUZETEVWQlFVVTdaMEpCUXpkRkxFOUJRVThzVFVGQlRTeERRVUZETEdGQlFXRXNRMEZCUXl4VlFVRlZMRU5CUVVNc1EwRkJReXhEUVVGRExFTkJRVU1zVjBGQlZ5eERRVUZETEVOQlFVTXNSMEZCUnl4RlFVRkZMRTlCUVU4c1EwRkJReXhEUVVGRE8yRkJRM1JGTzFOQlEwWTdTMEZEUmp0SlFVTkVMRTlCUVU4c1RVRkJUU3hEUVVGRExFOUJRVThzUTBGQlF5eExRVUZMTEVOQlFVTXNTVUZCU1N4RlFVRkZMRU5CUVVNc1IwRkJSeXhGUVVGRkxFOUJRVThzUTBGQlF5eERRVUZETEVOQlFVTTdRVUZEY0VRc1EwRkJReXhEUVVGQkxFTkJRVU03UVVGRlJpeEhRVUZITEVWQlFVVXNRMEZCUXlKOSIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuQ29udHJvbGxlciA9IHZvaWQgMDtcclxuY29uc3QgQ29udHJvbGxlciA9ICgpID0+IHtcclxuICAgIHJldHVybiAodGFyZ2V0KSA9PiB7IH07XHJcbn07XHJcbmV4cG9ydHMuQ29udHJvbGxlciA9IENvbnRyb2xsZXI7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtiYXNlNjQsZXlKMlpYSnphVzl1SWpvekxDSm1hV3hsSWpvaVkyOXVkSEp2Ykd4bGNpNWtaV052Y21GMGIzSXVhbk1pTENKemIzVnlZMlZTYjI5MElqb2lJaXdpYzI5MWNtTmxjeUk2V3lJdUxpOHVMaTl6Y21NdlpHVmpiM0poZEc5eUwyTnZiblJ5YjJ4c1pYSXVaR1ZqYjNKaGRHOXlMblJ6SWwwc0ltNWhiV1Z6SWpwYlhTd2liV0Z3Y0dsdVozTWlPaUk3T3p0QlFVRlBMRTFCUVUwc1ZVRkJWU3hIUVVGSExFZEJRVzFDTEVWQlFVVTdTVUZETjBNc1QwRkJUeXhEUVVGRExFMUJRVTBzUlVGQlJTeEZRVUZGTEVkQlFVVXNRMEZCUXl4RFFVRkRPMEZCUTNoQ0xFTkJRVU1zUTBGQlF6dEJRVVpYTEZGQlFVRXNWVUZCVlN4alFVVnlRaUo5IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5NZXNzYWdlID0gZXhwb3J0cy5GZXRjaCA9IHZvaWQgMDtcclxuY29uc3QgRmV0Y2ggPSAobWF0Y2gsIGlnbm9yZSA9IG51bGwpID0+IHtcclxuICAgIHJldHVybiAodGFyZ2V0LCBwcm9wZXJ0eUtleSkgPT4ge1xyXG4gICAgICAgIGlmICghZ2xvYmFsLnJvdXRlckxpc3QpXHJcbiAgICAgICAgICAgIGdsb2JhbC5yb3V0ZXJMaXN0ID0gW107XHJcbiAgICAgICAgZ2xvYmFsLnJvdXRlckxpc3QucHVzaCh7IHByb3BlcnR5S2V5OiBwcm9wZXJ0eUtleSwgbWF0Y2g6IG1hdGNoLCBpZ25vcmU6IGlnbm9yZSB9KTtcclxuICAgIH07XHJcbn07XHJcbmV4cG9ydHMuRmV0Y2ggPSBGZXRjaDtcclxuY29uc3QgTWVzc2FnZSA9IChtYXRjaCkgPT4ge1xyXG4gICAgcmV0dXJuICh0YXJnZXQsIHByb3BlcnR5S2V5KSA9PiB7XHJcbiAgICAgICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBfYTtcclxuICAgICAgICAgICAgaWYgKCgoX2EgPSBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuZGF0YSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZ1bmNOYW1lKSA9PSBtYXRjaCkge1xyXG4gICAgICAgICAgICAgICAgZ2xvYmFsLmFwcENvbnRyb2xsZXJbcHJvcGVydHlLZXldKGUuZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbn07XHJcbmV4cG9ydHMuTWVzc2FnZSA9IE1lc3NhZ2U7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtiYXNlNjQsZXlKMlpYSnphVzl1SWpvekxDSm1hV3hsSWpvaWFHRnVaR3hsY2k1a1pXTnZjbUYwYjNJdWFuTWlMQ0p6YjNWeVkyVlNiMjkwSWpvaUlpd2ljMjkxY21ObGN5STZXeUl1TGk4dUxpOXpjbU12WkdWamIzSmhkRzl5TDJoaGJtUnNaWEl1WkdWamIzSmhkRzl5TG5SeklsMHNJbTVoYldWeklqcGJYU3dpYldGd2NHbHVaM01pT2lJN096dEJRVUZQTEUxQlFVMHNTMEZCU3l4SFFVRkhMRU5CUVVNc1MwRkJZU3hGUVVGRkxGTkJRWGRDTEVsQlFVa3NSVUZCYlVJc1JVRkJSVHRKUVVOd1JpeFBRVUZQTEVOQlFVTXNUVUZCVFN4RlFVRkZMRmRCUVZjc1JVRkJSU3hGUVVGRk8xRkJRemRDTEVsQlFVa3NRMEZCUXl4TlFVRk5MRU5CUVVNc1ZVRkJWVHRaUVVGRkxFMUJRVTBzUTBGQlF5eFZRVUZWTEVkQlFVY3NSVUZCUlN4RFFVRkRPMUZCUXk5RExFMUJRVTBzUTBGQlF5eFZRVUZWTEVOQlFVTXNTVUZCU1N4RFFVRkRMRVZCUVVVc1YwRkJWeXhGUVVGRkxGZEJRWEZDTEVWQlFVVXNTMEZCU3l4RlFVRkZMRXRCUVVzc1JVRkJSU3hOUVVGTkxFVkJRVVVzVFVGQlRTeEZRVUZGTEVOQlFVTXNRMEZCUXp0SlFVTXZSaXhEUVVGRExFTkJRVU03UVVGRFNpeERRVUZETEVOQlFVTTdRVUZNVnl4UlFVRkJMRXRCUVVzc1UwRkxhRUk3UVVGRlN5eE5RVUZOTEU5QlFVOHNSMEZCUnl4RFFVRkRMRXRCUVdFc1JVRkJiVUlzUlVGQlJUdEpRVU40UkN4UFFVRlBMRU5CUVVNc1RVRkJUU3hGUVVGRkxGZEJRVmNzUlVGQlJTeEZRVUZGTzFGQlF6ZENMRTFCUVUwc1EwRkJReXhuUWtGQlowSXNRMEZCUXl4VFFVRlRMRVZCUVVVc1EwRkJReXhEUVVGTkxFVkJRVVVzUlVGQlJUczdXVUZETlVNc1NVRkJTU3hEUVVGQkxFMUJRVUVzUTBGQlF5eGhRVUZFTEVOQlFVTXNkVUpCUVVRc1EwRkJReXhEUVVGRkxFbEJRVWtzTUVOQlFVVXNVVUZCVVN4TFFVRkpMRXRCUVVzc1JVRkJSVHRuUWtGRE9VSXNUVUZCVFN4RFFVRkRMR0ZCUVdFc1EwRkJReXhYUVVGWExFTkJRVU1zUTBGQlF5eERRVUZETEVOQlFVTXNTVUZCU1N4RFFVRkRMRU5CUVVNN1lVRkRNME03VVVGRFNDeERRVUZETEVOQlFVTXNRMEZCUXp0SlFVTk1MRU5CUVVNc1EwRkJRenRCUVVOS0xFTkJRVU1zUTBGQlF6dEJRVkpYTEZGQlFVRXNUMEZCVHl4WFFWRnNRaUo5IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlBsYXllciA9IHZvaWQgMDtcclxuY29uc3Qgc3RyZWFtXzEgPSByZXF1aXJlKFwiLi4vc3RyZWFtL3N0cmVhbVwiKTtcclxuY29uc3Qgc3RyZWFtX2VudW1fMSA9IHJlcXVpcmUoXCIuLi9zdHJlYW0vaW50ZXJmYWNlL3N0cmVhbS5lbnVtXCIpO1xyXG5jb25zdCBtM3U4X3BhcnNlcl8xID0gcmVxdWlyZShcIm0zdTgtcGFyc2VyXCIpO1xyXG5jbGFzcyBQbGF5ZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5pbnRlZ3JpdHlUb2tlbiA9IFwiXCI7IC8vdGhlIGludGVncml0eSB0b2tlblxyXG4gICAgICAgIHRoaXMuc3RyZWFtTGlzdCA9IFtdOyAvL3RoZSBsaXN0IG9mIHN0cmVhbXMgdGhhdCBhcmUgY3VycmVudGx5IGJlaW5nIHBsYXllZFxyXG4gICAgICAgIHRoaXMuYWN0dWFsQ2hhbm5lbCA9IFwiXCI7IC8vdGhlIGNoYW5uZWxcclxuICAgICAgICB0aGlzLnBsYXlpbmdBZHMgPSBmYWxzZTsgLy9pZiB0aGUgc3RyZWFtIGlzIHBsYXlpbmcgYWRzXHJcbiAgICAgICAgdGhpcy5xdWFsaXR5ID0gXCJcIjsgLy90aGUgcXVhbGl0eSBvZiB0aGUgc3RyZWFtXHJcbiAgICAgICAgdGhpcy5nZXRRdWFsaXR5ID0gKCkgPT4gZ2xvYmFsLnBvc3RNZXNzYWdlKHsgdHlwZTogXCJnZXRRdWFsaXR5XCIgfSk7XHJcbiAgICAgICAgdGhpcy5nZXRTZXR0aW5ncyA9ICgpID0+IGdsb2JhbC5wb3N0TWVzc2FnZSh7IHR5cGU6IFwiZ2V0U2V0dGluZ3NcIiB9KTtcclxuICAgICAgICB0aGlzLnBhdXNlID0gKCkgPT4gZ2xvYmFsLnBvc3RNZXNzYWdlKHsgdHlwZTogXCJwYXVzZVwiIH0pO1xyXG4gICAgICAgIHRoaXMucGxheSA9ICgpID0+IGdsb2JhbC5wb3N0TWVzc2FnZSh7IHR5cGU6IFwicGxheVwiIH0pO1xyXG4gICAgICAgIHRoaXMuc2V0U2V0dGluZ3MgPSAoc2V0dGluZykgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNldHRpbmcgPSBzZXR0aW5nO1xyXG4gICAgICAgICAgICBsb2dQcmludChcIlNldHRpbmdzIGxvYWRlZFwiKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuc2V0SW50ZWdyaXR5VG9rZW4gPSAoaW50ZWdyaXR5VG9rZW4pID0+IHRoaXMuaW50ZWdyaXR5VG9rZW4gPSBpbnRlZ3JpdHlUb2tlbjtcclxuICAgICAgICB0aGlzLnBhdXNlQW5kUGxheSA9ICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgdGhpcy5wYXVzZSgpO1xyXG4gICAgICAgICAgICB5aWVsZCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTAwKSk7XHJcbiAgICAgICAgICAgIHRoaXMucGxheSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMub25TdGFydEFkcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJhZHMgc3RhcnRlZFwiKTtcclxuICAgICAgICAgICAgdGhpcy5wYXVzZUFuZFBsYXkoKTtcclxuICAgICAgICAgICAgdGhpcy5wYXVzZUFuZFBsYXkoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMub25FbmRBZHMgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWRzIGVuZGVkXCIpO1xyXG4gICAgICAgICAgICB0aGlzLnBhdXNlQW5kUGxheSgpO1xyXG4gICAgICAgICAgICB0aGlzLnBhdXNlQW5kUGxheSgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5pc0FkcyA9ICh4LCBhbGxvd0NoYW5nZSA9IGZhbHNlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFkcyA9IHRoaXMuaGFzQWRzKHgpO1xyXG4gICAgICAgICAgICBpZiAoIWFsbG93Q2hhbmdlKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFkcztcclxuICAgICAgICAgICAgaWYgKHRoaXMucGxheWluZ0FkcyA9PSBmYWxzZSAmJiB0aGlzLnBsYXlpbmdBZHMgIT0gYWRzKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5vblN0YXJ0QWRzKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBsYXlpbmdBZHMgPT0gdHJ1ZSAmJiB0aGlzLnBsYXlpbmdBZHMgIT0gYWRzKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkVuZEFkcygpO1xyXG4gICAgICAgICAgICB0aGlzLnBsYXlpbmdBZHMgPSBhZHM7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYXlpbmdBZHM7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmhhc0FkcyA9ICh4KSA9PiAoeCA9PT0gbnVsbCB8fCB4ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB4LnRvU3RyaW5nKCkuaW5jbHVkZXMoXCJzdGl0Y2hlZFwiKSkgfHwgKHggPT09IG51bGwgfHwgeCA9PT0gdm9pZCAwID8gdm9pZCAwIDogeC50b1N0cmluZygpLmluY2x1ZGVzKFwiQW1hem9uXCIpKSB8fCAoeCA9PT0gbnVsbCB8fCB4ID09PSB2b2lkIDAgPyB2b2lkIDAgOiB4LnRvU3RyaW5nKCkuaW5jbHVkZXMoXCJEQ00sXCIpKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRTdHJlYW0gPSAoY2hhbm5lbCA9IHRoaXMuYWN0dWFsQ2hhbm5lbCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgICAgIHJldHVybiAoX2EgPSB0aGlzLnN0cmVhbUxpc3QpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5maW5kKCh4KSA9PiB4LmNoYW5uZWxOYW1lID09PSBjaGFubmVsKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgaXNXaGl0ZWxpc3QoKSB7XHJcbiAgICAgICAgdmFyIF9hLCBfYjtcclxuICAgICAgICByZXR1cm4gKChfYiA9IChfYSA9IHRoaXMuc2V0dGluZykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLndoaXRlbGlzdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmluY2x1ZGVzKHRoaXMuYWN0dWFsQ2hhbm5lbCkpIHx8IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgb25GZXRjaCh0ZXh0KSB7XHJcbiAgICAgICAgdmFyIF9hLCBfYjtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc1doaXRlbGlzdCgpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQ7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0Fkcyh0ZXh0LCB0cnVlKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1lcmdlTTN1OENvbnRlbnRzKFt0ZXh0XSk7XHJcbiAgICAgICAgICAgIGxldCBkdW1wID0gW107XHJcbiAgICAgICAgICAgIGNvbnN0IGZyb250cGFnZSA9IHlpZWxkIHRoaXMuZmV0Y2htM3U4QnlTdHJlYW1UeXBlKHN0cmVhbV9lbnVtXzEuU3RyZWFtVHlwZS5GUk9OVFBBR0UpO1xyXG4gICAgICAgICAgICBpZiAoIWZyb250cGFnZS5kYXRhKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RyZWFtKCkuY3JlYXRlU3RyZWFtQWNjZXNzKHN0cmVhbV9lbnVtXzEuU3RyZWFtVHlwZS5GUk9OVFBBR0UsIHRoaXMuaW50ZWdyaXR5VG9rZW4pO1xyXG4gICAgICAgICAgICBpZiAoZnJvbnRwYWdlLmRhdGEpXHJcbiAgICAgICAgICAgICAgICBkdW1wLnB1c2goLi4uZnJvbnRwYWdlLmR1bXApO1xyXG4gICAgICAgICAgICBjb25zdCBwaWN0dXJlID0geWllbGQgdGhpcy5mZXRjaG0zdThCeVN0cmVhbVR5cGUoc3RyZWFtX2VudW1fMS5TdHJlYW1UeXBlLlBJQ1RVUkUpO1xyXG4gICAgICAgICAgICBpZiAoIXBpY3R1cmUuZGF0YSlcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFN0cmVhbSgpLmNyZWF0ZVN0cmVhbUFjY2VzcyhzdHJlYW1fZW51bV8xLlN0cmVhbVR5cGUuUElDVFVSRSwgdGhpcy5pbnRlZ3JpdHlUb2tlbik7XHJcbiAgICAgICAgICAgIGlmIChwaWN0dXJlLmRhdGEpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKChfYiA9IChfYSA9IHBpY3R1cmUuZHVtcCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBcIlwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIGR1bXAubGVuZ3RoICE9IDAgPyB0aGlzLm1lcmdlTTN1OENvbnRlbnRzKFt0ZXh0LCAuLi5kdW1wXSkgOiB0ZXh0O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZ2VuZXJhdGVNM3U4KG1hbmlmZXN0KSB7XHJcbiAgICAgICAgbGV0IG0zdThDb250ZW50ID0gYCNFWFRNM1VcXG5gO1xyXG4gICAgICAgIGlmIChtYW5pZmVzdC50YXJnZXREdXJhdGlvbikge1xyXG4gICAgICAgICAgICBtM3U4Q29udGVudCArPSBgI0VYVC1YLVRBUkdFVERVUkFUSU9OOiR7bWFuaWZlc3QudGFyZ2V0RHVyYXRpb259XFxuYDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1hbmlmZXN0Lm1lZGlhU2VxdWVuY2UpIHtcclxuICAgICAgICAgICAgbTN1OENvbnRlbnQgKz0gYCNFWFQtWC1NRURJQS1TRVFVRU5DRToke21hbmlmZXN0Lm1lZGlhU2VxdWVuY2V9XFxuYDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1hbmlmZXN0LnNlZ21lbnRzKSB7XHJcbiAgICAgICAgICAgIG1hbmlmZXN0LnNlZ21lbnRzLmZvckVhY2goKHNlZ21lbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChzZWdtZW50LmR1cmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbTN1OENvbnRlbnQgKz0gYCNFWFRJTkY6JHtzZWdtZW50LmR1cmF0aW9ufWA7XHJcbiAgICAgICAgICAgICAgICAgICAgbTN1OENvbnRlbnQgKz0gYFxcbmA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBtM3U4Q29udGVudCArPSBgJHtzZWdtZW50LnVyaX1cXG5gO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG0zdThDb250ZW50O1xyXG4gICAgfVxyXG4gICAgbWVyZ2VNM3U4Q29udGVudHMoY29udGV1ZG9zTTN1OCkge1xyXG4gICAgICAgIGNvbnN0IG1hbmlmZXN0b3MgPSBjb250ZXVkb3NNM3U4Lm1hcCgoY29udGV1ZG8pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYW5hbGlzYWRvciA9IG5ldyBtM3U4X3BhcnNlcl8xLlBhcnNlcigpO1xyXG4gICAgICAgICAgICBhbmFsaXNhZG9yLnB1c2goY29udGV1ZG8pO1xyXG4gICAgICAgICAgICBhbmFsaXNhZG9yLmVuZCgpO1xyXG4gICAgICAgICAgICAvLyBleHRyYWN0IHRpdGxlcyBmcm9tICNFWFRJTkYgdGFncyBpbiBlYWNoIHNlZ21lbnRcclxuICAgICAgICAgICAgY29uc3QgbWFuaWZlc3QgPSBhbmFsaXNhZG9yLm1hbmlmZXN0O1xyXG4gICAgICAgICAgICBpZiAobWFuaWZlc3Quc2VnbWVudHMpIHtcclxuICAgICAgICAgICAgICAgIG1hbmlmZXN0LnNlZ21lbnRzLmZvckVhY2goKHNlZ21lbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBGaW5kIHRoZSAjRVhUSU5GIHRhZyBhc3NvY2lhdGVkIHdpdGggdGhlIGN1cnJlbnQgc2VnbWVudFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4dGluZlRhZ1JlZ2V4ID0gbmV3IFJlZ0V4cChgI0VYVElORjooWzAtOS5dKik/LD8oLiopKD86XFxufFxcclxcbikke3NlZ21lbnQudXJpfWApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gY29udGV1ZG8ubWF0Y2goZXh0aW5mVGFnUmVnZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50LnRpdGxlID0gbWF0Y2hbMl0gPyBtYXRjaFsyXS50cmltKCkgOiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBtYW5pZmVzdDtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBtYW5pZmVzdG9QcmluY2lwYWwgPSBtYW5pZmVzdG9zWzBdO1xyXG4gICAgICAgIGNvbnN0IG1hbmlmZXN0b3NTdXBvcnRlID0gbWFuaWZlc3Rvcy5zbGljZSgxKTtcclxuICAgICAgICBpZiAobWFuaWZlc3RvUHJpbmNpcGFsLnNlZ21lbnRzKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VnbWVudG9zIGVuY29udHJhZG9zIG5vIG1hbmlmZXN0byBwcmluY2lwYWw6XCIsIG1hbmlmZXN0b1ByaW5jaXBhbC5zZWdtZW50cy5sZW5ndGgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1hbmlmZXN0b3MgZGUgc3Vwb3J0ZSBlbmNvbnRyYWRvczpcIiwgbWFuaWZlc3Rvc1N1cG9ydGUubGVuZ3RoKTtcclxuICAgICAgICAgICAgbGV0IHNlZ21lbnRSZW1vdmVkID0gMDtcclxuICAgICAgICAgICAgbGV0IHNlZ21lbnRSZXBsZWNlZCA9IDA7XHJcbiAgICAgICAgICAgIC8vIFBlcmNvcnJlciBvcyBzZWdtZW50b3MgZG8gbWFuaWZlc3RvIHByaW5jaXBhbCBlIHByZWVuY2hlciBhcyBsYWN1bmFzIGNvbSBvcyBzZWdtZW50b3MgZG8gbWFuaWZlc3RvIGRlIHN1cG9ydGVcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYW5pZmVzdG9QcmluY2lwYWwuc2VnbWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlZ21lbnRvUHJpbmNpcGFsID0gbWFuaWZlc3RvUHJpbmNpcGFsLnNlZ21lbnRzW2ldO1xyXG4gICAgICAgICAgICAgICAgbGV0IGlzQ2hhbmdlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzQWRzKHNlZ21lbnRvUHJpbmNpcGFsLnRpdGxlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hbmlmZXN0b3NTdXBvcnRlLmZvckVhY2goKG1hbmlmZXN0b1N1cG9ydGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmNvbnRyZSBvIHByaW1laXJvIHNlZ21lbnRvIGRlIHN1cG9ydGUgcXVlIE7Dg08gY29udGVuaGEgbyB0w610dWxvIFwiQW1hem9uXCIgZSB0ZW5oYSB1bSB0ZW1wbyBzZW1lbGhhbnRlIGFvIHNlZ21lbnRvUHJpbmNpcGFsIChpZ25vcmFuZG8gbWlsaXNzZWd1bmRvcylcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VnbWVudG9TdXBvcnRlID0gKF9hID0gbWFuaWZlc3RvU3Vwb3J0ZSA9PT0gbnVsbCB8fCBtYW5pZmVzdG9TdXBvcnRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYW5pZmVzdG9TdXBvcnRlLnNlZ21lbnRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmluZCgoc2VnKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNBZHMoc2VnLnRpdGxlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhUHJpbmNpcGFsID0gbmV3IERhdGUoc2VnbWVudG9QcmluY2lwYWwuZGF0ZVRpbWVTdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YVN1cG9ydGUgPSBuZXcgRGF0ZShzZWcuZGF0ZVRpbWVTdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVByaW5jaXBhbC5zZXRNaWxsaXNlY29uZHMoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhU3Vwb3J0ZS5zZXRNaWxsaXNlY29uZHMoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVByaW5jaXBhbC5nZXRUaW1lKCkgPT09IGRhdGFTdXBvcnRlLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWdtZW50b1N1cG9ydGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1YnN0aXR1YSBvIHNlZ21lbnRvIHByaW5jaXBhbCBwZWxvIHNlZ21lbnRvIGRlIHN1cG9ydGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbmlmZXN0b1ByaW5jaXBhbC5zZWdtZW50c1tpXSA9IHNlZ21lbnRvU3Vwb3J0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2hhbmdlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBTZSBvIHNlZ21lbnRvIHByaW5jaXBhbCBhaW5kYSBjb250aXZlciBvIHTDrXR1bG8gXCJBbWF6b25cIiwgcmVtb3ZhLW9cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQ2hhbmdlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYW5pZmVzdG9QcmluY2lwYWwuc2VnbWVudHMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlZ21lbnRSZW1vdmVkKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0NoYW5nZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudFJlcGxlY2VkKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VnbWVudG8gY29tIGFkcyByZW1vdmlkb3M6XCIsIHNlZ21lbnRSZW1vdmVkKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTZWdtZW50byBjb20gYWRzIHN1YnN0aXR1w61kb3M6XCIsIHNlZ21lbnRSZXBsZWNlZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIENyaWFyIHVtYSBub3ZhIGxpc3RhIGRlIHJlcHJvZHXDp8OjbyBNM1U4IGNvbSBvcyBzZWdtZW50b3MgbWVzY2xhZG9zXHJcbiAgICAgICAgY29uc3QgY29udGV1ZG9NM3U4TWVzY2xhZG8gPSB0aGlzLmdlbmVyYXRlTTN1OChtYW5pZmVzdG9QcmluY2lwYWwpO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiQ29udGXDumRvIE0zVTggbWVzY2xhZG86XCIsIGNvbnRldWRvTTN1OE1lc2NsYWRvKTtcclxuICAgICAgICByZXR1cm4gY29udGV1ZG9NM3U4TWVzY2xhZG87XHJcbiAgICB9XHJcbiAgICBmZXRjaG0zdThCeVN0cmVhbVR5cGUoYWNjZXNzVHlwZSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGxvZ1ByaW50KFwiU3RyZWFtIFR5cGU6IFwiICsgYWNjZXNzVHlwZSk7XHJcbiAgICAgICAgICAgIGxldCBkdW1wID0gW107XHJcbiAgICAgICAgICAgIGxldCBzZXJ2ZXJzID0gdGhpcy5jdXJyZW50U3RyZWFtKCkuZ2V0U3RyZWFtQnlTdHJlYW1UeXBlKGFjY2Vzc1R5cGUpO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNlcnZlciBvZiBzZXJ2ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAvL2ZpbHRlciBzZXJ2ZXIgdXJsIGJ5IHF1YWxpdHkgb3IgYmVzdHF1YWxpdHlcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVhbVVybCA9IHNlcnZlci5maW5kQnlRdWFsaXR5KHRoaXMucXVhbGl0eSkgfHwgc2VydmVyLmJlc3RRdWFsaXR5KCk7XHJcbiAgICAgICAgICAgICAgICAvL3RyeSBnZXQgbTN1OCBjb250ZW50IGFuZCByZXR1cm4gaWYgZG9uJ3QgaGF2ZSBhZHMuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0geWllbGQgKHlpZWxkIGdsb2JhbC5yZXF1ZXN0KHN0cmVhbVVybCA9PT0gbnVsbCB8fCBzdHJlYW1VcmwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHN0cmVhbVVybC51cmwpKS50ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICBkdW1wLnB1c2godGV4dCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0Fkcyh0ZXh0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ1ByaW50KFwiU3RyZWFtIFR5cGU6IFwiICsgYWNjZXNzVHlwZSArIFwiIC0gQWRzIGZvdW5kXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFN0cmVhbSgpLnJlbW92ZVNlcnZlcihzZXJ2ZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgZGF0YTogdGV4dCwgZHVtcDogZHVtcCB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB7IGRhdGE6IG51bGwsIGR1bXA6IGR1bXAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHNldENoYW5uZWwoY2hhbm5lbE5hbWUpIHtcclxuICAgICAgICBsb2dQcmludChcIkxvYWRpbmcgY2hhbm5lbFwiLCBjaGFubmVsTmFtZSk7XHJcbiAgICAgICAgdGhpcy5hY3R1YWxDaGFubmVsID0gY2hhbm5lbE5hbWU7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRTdHJlYW0gPSB0aGlzLnN0cmVhbUxpc3QuZmluZCgoc3RyZWFtKSA9PiBzdHJlYW0uY2hhbm5lbE5hbWUgPT09IGNoYW5uZWxOYW1lKTtcclxuICAgICAgICBpZiAoIWN1cnJlbnRTdHJlYW0pIHtcclxuICAgICAgICAgICAgY3VycmVudFN0cmVhbSA9IG5ldyBzdHJlYW1fMS5TdHJlYW0oY2hhbm5lbE5hbWUpO1xyXG4gICAgICAgICAgICB0aGlzLnN0cmVhbUxpc3QucHVzaChjdXJyZW50U3RyZWFtKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5QbGF5ZXIgPSBQbGF5ZXI7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtiYXNlNjQsZXlKMlpYSnphVzl1SWpvekxDSm1hV3hsSWpvaWNHeGhlV1Z5TG1weklpd2ljMjkxY21ObFVtOXZkQ0k2SWlJc0luTnZkWEpqWlhNaU9sc2lMaTR2TGk0dkxpNHZjM0pqTDIxdlpIVnNaWE12Y0d4aGVXVnlMM0JzWVhsbGNpNTBjeUpkTENKdVlXMWxjeUk2VzEwc0ltMWhjSEJwYm1keklqb2lPenM3T3pzN096czdPenM3UVVGQlFTdzJRMEZCTUVNN1FVRkZNVU1zYVVWQlFUWkVPMEZCUlRkRUxEWkRRVUZ4UXp0QlFVVnlReXhOUVVGaExFMUJRVTA3U1VGQmJrSTdVVUZEUlN4dFFrRkJZeXhIUVVGSExFVkJRVVVzUTBGQlF5eERRVUZETEhGQ1FVRnhRanRSUVVVeFF5eGxRVUZWTEVkQlFXRXNSVUZCUlN4RFFVRkRMRU5CUVVNc2NVUkJRWEZFTzFGQlEyaEdMR3RDUVVGaExFZEJRVmNzUlVGQlJTeERRVUZETEVOQlFVTXNZVUZCWVR0UlFVTjZReXhsUVVGVkxFZEJRVWNzUzBGQlN5eERRVUZETEVOQlFVTXNPRUpCUVRoQ08xRkJSV3hFTEZsQlFVOHNSMEZCVnl4RlFVRkZMRU5CUVVNc1EwRkJReXd5UWtGQk1rSTdVVUZGYWtRc1pVRkJWU3hIUVVGSExFZEJRVWNzUlVGQlJTeERRVUZETEUxQlFVMHNRMEZCUXl4WFFVRlhMRU5CUVVNc1JVRkJSU3hKUVVGSkxFVkJRVVVzV1VGQldTeEZRVUZGTEVOQlFVTXNRMEZCUXp0UlFVTTVSQ3huUWtGQlZ5eEhRVUZITEVkQlFVY3NSVUZCUlN4RFFVRkRMRTFCUVUwc1EwRkJReXhYUVVGWExFTkJRVU1zUlVGQlJTeEpRVUZKTEVWQlFVVXNZVUZCWVN4RlFVRkZMRU5CUVVNc1EwRkJRenRSUVVOb1JTeFZRVUZMTEVkQlFVY3NSMEZCUnl4RlFVRkZMRU5CUVVNc1RVRkJUU3hEUVVGRExGZEJRVmNzUTBGQlF5eEZRVUZGTEVsQlFVa3NSVUZCUlN4UFFVRlBMRVZCUVVVc1EwRkJReXhEUVVGRE8xRkJRM0JFTEZOQlFVa3NSMEZCUnl4SFFVRkhMRVZCUVVVc1EwRkJReXhOUVVGTkxFTkJRVU1zVjBGQlZ5eERRVUZETEVWQlFVVXNTVUZCU1N4RlFVRkZMRTFCUVUwc1JVRkJSU3hEUVVGRExFTkJRVU03VVVGRmJFUXNaMEpCUVZjc1IwRkJSeXhEUVVGRExFOUJRV2RDTEVWQlFVVXNSVUZCUlR0WlFVTnFReXhKUVVGSkxFTkJRVU1zVDBGQlR5eEhRVUZITEU5QlFVOHNRMEZCUXp0WlFVTjJRaXhSUVVGUkxFTkJRVU1zYVVKQlFXbENMRU5CUVVNc1EwRkJRenRSUVVNNVFpeERRVUZETEVOQlFVTTdVVUZGUml4elFrRkJhVUlzUjBGQlJ5eERRVUZETEdOQlFYTkNMRVZCUVVVc1JVRkJSU3hEUVVGRExFbEJRVWtzUTBGQlF5eGpRVUZqTEVkQlFVY3NZMEZCWXl4RFFVRkRPMUZCUlhKR0xHbENRVUZaTEVkQlFVY3NSMEZCVXl4RlFVRkZPMWxCUTNoQ0xFbEJRVWtzUTBGQlF5eExRVUZMTEVWQlFVVXNRMEZCUXp0WlFVTmlMRTFCUVUwc1NVRkJTU3hQUVVGUExFTkJRVU1zVDBGQlR5eERRVUZETEVWQlFVVXNRMEZCUXl4VlFVRlZMRU5CUVVNc1QwRkJUeXhGUVVGRkxFZEJRVWNzUTBGQlF5eERRVUZETEVOQlFVTTdXVUZEZGtRc1NVRkJTU3hEUVVGRExFbEJRVWtzUlVGQlJTeERRVUZETzFGQlEyUXNRMEZCUXl4RFFVRkJMRU5CUVVNN1VVRkZSaXhsUVVGVkxFZEJRVWNzUjBGQlJ5eEZRVUZGTzFsQlEyaENMRTlCUVU4c1EwRkJReXhIUVVGSExFTkJRVU1zWVVGQllTeERRVUZETEVOQlFVTTdXVUZETTBJc1NVRkJTU3hEUVVGRExGbEJRVmtzUlVGQlJTeERRVUZETzFsQlEzQkNMRWxCUVVrc1EwRkJReXhaUVVGWkxFVkJRVVVzUTBGQlF6dFJRVU4wUWl4RFFVRkRMRU5CUVVNN1VVRkRSaXhoUVVGUkxFZEJRVWNzUjBGQlJ5eEZRVUZGTzFsQlEyUXNUMEZCVHl4RFFVRkRMRWRCUVVjc1EwRkJReXhYUVVGWExFTkJRVU1zUTBGQlF6dFpRVU42UWl4SlFVRkpMRU5CUVVNc1dVRkJXU3hGUVVGRkxFTkJRVU03V1VGRGNFSXNTVUZCU1N4RFFVRkRMRmxCUVZrc1JVRkJSU3hEUVVGRE8xRkJRM1JDTEVOQlFVTXNRMEZCUXp0UlFVVkdMRlZCUVVzc1IwRkJSeXhEUVVGRExFTkJRVk1zUlVGQlJTeGpRVUYxUWl4TFFVRkxMRVZCUVVVc1JVRkJSVHRaUVVOc1JDeE5RVUZOTEVkQlFVY3NSMEZCUnl4SlFVRkpMRU5CUVVNc1RVRkJUU3hEUVVGRExFTkJRVU1zUTBGQlF5eERRVUZETzFsQlF6TkNMRWxCUVVrc1EwRkJReXhYUVVGWE8yZENRVUZGTEU5QlFVOHNSMEZCUnl4RFFVRkRPMWxCUXpkQ0xFbEJRVWtzU1VGQlNTeERRVUZETEZWQlFWVXNTVUZCU1N4TFFVRkxMRWxCUVVrc1NVRkJTU3hEUVVGRExGVkJRVlVzU1VGQlNTeEhRVUZITzJkQ1FVRkZMRWxCUVVrc1EwRkJReXhWUVVGVkxFVkJRVVVzUTBGQlF6dFpRVU14UlN4SlFVRkpMRWxCUVVrc1EwRkJReXhWUVVGVkxFbEJRVWtzU1VGQlNTeEpRVUZKTEVsQlFVa3NRMEZCUXl4VlFVRlZMRWxCUVVrc1IwRkJSenRuUWtGQlJTeEpRVUZKTEVOQlFVTXNVVUZCVVN4RlFVRkZMRU5CUVVNN1dVRkRka1VzU1VGQlNTeERRVUZETEZWQlFWVXNSMEZCUnl4SFFVRkhMRU5CUVVNN1dVRkZkRUlzVDBGQlR5eEpRVUZKTEVOQlFVTXNWVUZCVlN4RFFVRkRPMUZCUTNwQ0xFTkJRVU1zUTBGQlF6dFJRVVZHTEZkQlFVMHNSMEZCUnl4RFFVRkRMRU5CUVZNc1JVRkJSU3hGUVVGRkxFTkJRVU1zUTBGQlFTeERRVUZETEdGQlFVUXNRMEZCUXl4MVFrRkJSQ3hEUVVGRExFTkJRVVVzVVVGQlVTeEhRVUZITEZGQlFWRXNRMEZCUXl4VlFVRlZMRU5CUVVNc1RVRkJTU3hEUVVGRExHRkJRVVFzUTBGQlF5eDFRa0ZCUkN4RFFVRkRMRU5CUVVVc1VVRkJVU3hIUVVGSExGRkJRVkVzUTBGQlF5eFJRVUZSTEVOQlFVTXNRMEZCUVN4TFFVRkpMRU5CUVVNc1lVRkJSQ3hEUVVGRExIVkNRVUZFTEVOQlFVTXNRMEZCUlN4UlFVRlJMRWRCUVVjc1VVRkJVU3hEUVVGRExFMUJRVTBzUTBGQlF5eERRVUZCTEVOQlFVTTdVVUZGYWtrc2EwSkJRV0VzUjBGQlJ5eERRVUZETEZWQlFXdENMRWxCUVVrc1EwRkJReXhoUVVGaExFVkJRVlVzUlVGQlJUczdXVUZETDBRc1QwRkJUeXhOUVVGQkxFbEJRVWtzUTBGQlF5eFZRVUZWTERCRFFVRkZMRWxCUVVrc1EwRkJReXhEUVVGRExFTkJRVk1zUlVGQlJTeEZRVUZGTEVOQlFVTXNRMEZCUXl4RFFVRkRMRmRCUVZjc1MwRkJTeXhQUVVGUExFTkJRVVVzUTBGQlF6dFJRVU14UlN4RFFVRkRMRU5CUVVNN1NVRnpTMG9zUTBGQlF6dEpRWEJMUXl4WFFVRlhPenRSUVVOVUxFOUJRVThzUTBGQlFTeE5RVUZCTEUxQlFVRXNTVUZCU1N4RFFVRkRMRTlCUVU4c01FTkJRVVVzVTBGQlV5d3dRMEZCUlN4UlFVRlJMRU5CUVVNc1NVRkJTU3hEUVVGRExHRkJRV0VzUTBGQlF5eExRVUZKTEV0QlFVc3NRMEZCUXp0SlFVTjRSU3hEUVVGRE8wbEJSVXNzVDBGQlR5eERRVUZETEVsQlFWazdPenRaUVVONFFpeEpRVUZKTEVsQlFVa3NRMEZCUXl4WFFVRlhMRVZCUVVVN1owSkJRVVVzVDBGQlR5eEpRVUZKTEVOQlFVTTdXVUZEY0VNc1NVRkJTU3hEUVVGRExFbEJRVWtzUTBGQlF5eExRVUZMTEVOQlFVTXNTVUZCU1N4RlFVRkZMRWxCUVVrc1EwRkJRenRuUWtGQlJTeFBRVUZQTEVsQlFVa3NRMEZCUXl4cFFrRkJhVUlzUTBGQlF5eERRVUZETEVsQlFVa3NRMEZCUXl4RFFVRkRMRU5CUVVNN1dVRkZia1VzU1VGQlNTeEpRVUZKTEVkQlFXRXNSVUZCUlN4RFFVRkRPMWxCUlhoQ0xFMUJRVTBzVTBGQlV5eEhRVUZITEUxQlFVMHNTVUZCU1N4RFFVRkRMSEZDUVVGeFFpeERRVUZETEhkQ1FVRlZMRU5CUVVNc1UwRkJVeXhEUVVGRExFTkJRVU03V1VGRGVrVXNTVUZCU1N4RFFVRkRMRk5CUVZNc1EwRkJReXhKUVVGSk8yZENRVUZGTEVsQlFVa3NRMEZCUXl4aFFVRmhMRVZCUVVVc1EwRkJReXhyUWtGQmEwSXNRMEZCUXl4M1FrRkJWU3hEUVVGRExGTkJRVk1zUlVGQlJTeEpRVUZKTEVOQlFVTXNZMEZCWXl4RFFVRkRMRU5CUVVNN1dVRkRlRWNzU1VGQlNTeFRRVUZUTEVOQlFVTXNTVUZCU1R0blFrRkJSU3hKUVVGSkxFTkJRVU1zU1VGQlNTeERRVUZETEVkQlFVY3NVMEZCVXl4RFFVRkRMRWxCUVVrc1EwRkJReXhEUVVGRE8xbEJSV3BFTEUxQlFVMHNUMEZCVHl4SFFVRkhMRTFCUVUwc1NVRkJTU3hEUVVGRExIRkNRVUZ4UWl4RFFVRkRMSGRDUVVGVkxFTkJRVU1zVDBGQlR5eERRVUZETEVOQlFVTTdXVUZEY2tVc1NVRkJTU3hEUVVGRExFOUJRVThzUTBGQlF5eEpRVUZKTzJkQ1FVRkZMRWxCUVVrc1EwRkJReXhoUVVGaExFVkJRVVVzUTBGQlF5eHJRa0ZCYTBJc1EwRkJReXgzUWtGQlZTeERRVUZETEU5QlFVOHNSVUZCUlN4SlFVRkpMRU5CUVVNc1kwRkJZeXhEUVVGRExFTkJRVU03V1VGRGNFY3NTVUZCU1N4UFFVRlBMRU5CUVVNc1NVRkJTVHRuUWtGQlJTeFBRVUZQTEU5QlFVOHNRMEZCUXl4UFFVRlBMRU5CUVVNc1RVRkJRU3hOUVVGQkxFOUJRVThzUTBGQlF5eEpRVUZKTERCRFFVRkhMRU5CUVVNc1EwRkJReXh0UTBGQlNTeEZRVUZGTEVOQlFVTXNRMEZCUXp0WlFVVnNSU3hQUVVGUExFbEJRVWtzUTBGQlF5eE5RVUZOTEVsQlFVa3NRMEZCUXl4RFFVRkRMRU5CUVVNc1EwRkJReXhKUVVGSkxFTkJRVU1zYVVKQlFXbENMRU5CUVVNc1EwRkJReXhKUVVGSkxFVkJRVVVzUjBGQlJ5eEpRVUZKTEVOQlFVTXNRMEZCUXl4RFFVRkRMRU5CUVVNc1EwRkJReXhKUVVGSkxFTkJRVU03TzB0QlF6RkZPMGxCUlVRc1dVRkJXU3hEUVVGRExGRkJRV0U3VVVGRGVFSXNTVUZCU1N4WFFVRlhMRWRCUVVjc1YwRkJWeXhEUVVGRE8xRkJSVGxDTEVsQlFVa3NVVUZCVVN4RFFVRkRMR05CUVdNc1JVRkJSVHRaUVVNelFpeFhRVUZYTEVsQlFVa3NlVUpCUVhsQ0xGRkJRVkVzUTBGQlF5eGpRVUZqTEVsQlFVa3NRMEZCUXp0VFFVTnlSVHRSUVVWRUxFbEJRVWtzVVVGQlVTeERRVUZETEdGQlFXRXNSVUZCUlR0WlFVTXhRaXhYUVVGWExFbEJRVWtzZVVKQlFYbENMRkZCUVZFc1EwRkJReXhoUVVGaExFbEJRVWtzUTBGQlF6dFRRVU53UlR0UlFVVkVMRWxCUVVrc1VVRkJVU3hEUVVGRExGRkJRVkVzUlVGQlJUdFpRVU55UWl4UlFVRlJMRU5CUVVNc1VVRkJVU3hEUVVGRExFOUJRVThzUTBGQlF5eERRVUZETEU5QlFWa3NSVUZCUlN4RlFVRkZPMmRDUVVONlF5eEpRVUZKTEU5QlFVOHNRMEZCUXl4UlFVRlJMRVZCUVVVN2IwSkJRM0JDTEZkQlFWY3NTVUZCU1N4WFFVRlhMRTlCUVU4c1EwRkJReXhSUVVGUkxFVkJRVVVzUTBGQlF6dHZRa0ZETjBNc1YwRkJWeXhKUVVGSkxFbEJRVWtzUTBGQlF6dHBRa0ZEY2tJN1owSkJRMFFzVjBGQlZ5eEpRVUZKTEVkQlFVY3NUMEZCVHl4RFFVRkRMRWRCUVVjc1NVRkJTU3hEUVVGRE8xbEJRM0JETEVOQlFVTXNRMEZCUXl4RFFVRkRPMU5CUTBvN1VVRkZSQ3hQUVVGUExGZEJRVmNzUTBGQlF6dEpRVU55UWl4RFFVRkRPMGxCUlVRc2FVSkJRV2xDTEVOQlFVTXNZVUZCZFVJN1VVRkRka01zVFVGQlRTeFZRVUZWTEVkQlFVY3NZVUZCWVN4RFFVRkRMRWRCUVVjc1EwRkJReXhEUVVGRExGRkJRVkVzUlVGQlJTeEZRVUZGTzFsQlEyaEVMRTFCUVUwc1ZVRkJWU3hIUVVGSExFbEJRVWtzYjBKQlFVMHNSVUZCUlN4RFFVRkRPMWxCUldoRExGVkJRVlVzUTBGQlF5eEpRVUZKTEVOQlFVTXNVVUZCVVN4RFFVRkRMRU5CUVVNN1dVRkRNVUlzVlVGQlZTeERRVUZETEVkQlFVY3NSVUZCUlN4RFFVRkRPMWxCUldwQ0xHMUVRVUZ0UkR0WlFVTnVSQ3hOUVVGTkxGRkJRVkVzUjBGQlJ5eFZRVUZWTEVOQlFVTXNVVUZCVVN4RFFVRkRPMWxCUTNKRExFbEJRVWtzVVVGQlVTeERRVUZETEZGQlFWRXNSVUZCUlR0blFrRkRja0lzVVVGQlVTeERRVUZETEZGQlFWRXNRMEZCUXl4UFFVRlBMRU5CUVVNc1EwRkJReXhQUVVGWkxFVkJRVVVzUlVGQlJUdHZRa0ZEZWtNc01rUkJRVEpFTzI5Q1FVTXpSQ3hOUVVGTkxHTkJRV01zUjBGQlJ5eEpRVUZKTEUxQlFVMHNRMEZCUXl4elEwRkJjME1zVDBGQlR5eERRVUZETEVkQlFVY3NSVUZCUlN4RFFVRkRMRU5CUVVNN2IwSkJRM1pHTEUxQlFVMHNTMEZCU3l4SFFVRkhMRkZCUVZFc1EwRkJReXhMUVVGTExFTkJRVU1zWTBGQll5eERRVUZETEVOQlFVTTdiMEpCUlRkRExFbEJRVWtzUzBGQlN5eEZRVUZGTzNkQ1FVTlVMRTlCUVU4c1EwRkJReXhMUVVGTExFZEJRVWNzUzBGQlN5eERRVUZETEVOQlFVTXNRMEZCUXl4RFFVRkRMRU5CUVVNc1EwRkJReXhMUVVGTExFTkJRVU1zUTBGQlF5eERRVUZETEVOQlFVTXNTVUZCU1N4RlFVRkZMRU5CUVVNc1EwRkJReXhEUVVGRExFVkJRVVVzUTBGQlF6dHhRa0ZEYWtRN1owSkJRMGdzUTBGQlF5eERRVUZETEVOQlFVTTdZVUZEU2p0WlFVVkVMRTlCUVU4c1VVRkJVU3hEUVVGRE8xRkJRMnhDTEVOQlFVTXNRMEZCUXl4RFFVRkRPMUZCUlVnc1RVRkJUU3hyUWtGQmEwSXNSMEZCUnl4VlFVRlZMRU5CUVVNc1EwRkJReXhEUVVGRExFTkJRVU03VVVGRGVrTXNUVUZCVFN4cFFrRkJhVUlzUjBGQlJ5eFZRVUZWTEVOQlFVTXNTMEZCU3l4RFFVRkRMRU5CUVVNc1EwRkJReXhEUVVGRE8xRkJSVGxETEVsQlFVa3NhMEpCUVd0Q0xFTkJRVU1zVVVGQlVTeEZRVUZGTzFsQlF5OUNMRTlCUVU4c1EwRkJReXhIUVVGSExFTkJRVU1zSzBOQlFTdERMRVZCUVVVc2EwSkJRV3RDTEVOQlFVTXNVVUZCVVN4RFFVRkRMRTFCUVUwc1EwRkJReXhEUVVGRE8xbEJRMnBITEU5QlFVOHNRMEZCUXl4SFFVRkhMRU5CUVVNc2IwTkJRVzlETEVWQlFVVXNhVUpCUVdsQ0xFTkJRVU1zVFVGQlRTeERRVUZETEVOQlFVTTdXVUZGTlVVc1NVRkJTU3hqUVVGakxFZEJRVWNzUTBGQlF5eERRVUZETzFsQlEzWkNMRWxCUVVrc1pVRkJaU3hIUVVGSExFTkJRVU1zUTBGQlF6dFpRVVY0UWl4blNFRkJaMGc3V1VGRGFFZ3NTMEZCU3l4SlFVRkpMRU5CUVVNc1IwRkJSeXhEUVVGRExFVkJRVVVzUTBGQlF5eEhRVUZITEd0Q1FVRnJRaXhEUVVGRExGRkJRVkVzUTBGQlF5eE5RVUZOTEVWQlFVVXNRMEZCUXl4RlFVRkZMRVZCUVVVN1owSkJRek5FTEUxQlFVMHNhVUpCUVdsQ0xFZEJRVWNzYTBKQlFXdENMRU5CUVVNc1VVRkJVU3hEUVVGRExFTkJRVU1zUTBGQlF5eERRVUZETzJkQ1FVVjZSQ3hKUVVGSkxGTkJRVk1zUjBGQlJ5eExRVUZMTEVOQlFVTTdaMEpCUlhSQ0xFbEJRVWtzU1VGQlNTeERRVUZETEUxQlFVMHNRMEZCUXl4cFFrRkJhVUlzUTBGQlF5eExRVUZMTEVOQlFVTXNSVUZCUlR0dlFrRkRlRU1zYVVKQlFXbENMRU5CUVVNc1QwRkJUeXhEUVVGRExFTkJRVU1zWjBKQlFXZENMRVZCUVVVc1JVRkJSVHM3ZDBKQlF6ZERMSGRLUVVGM1NqdDNRa0ZEZUVvc1RVRkJUU3hsUVVGbExFZEJRVWNzVFVGQlFTeG5Ra0ZCWjBJc1lVRkJhRUlzWjBKQlFXZENMSFZDUVVGb1FpeG5Ra0ZCWjBJc1EwRkJSU3hSUVVGUkxEQkRRVUZGTEVsQlFVa3NRMEZCUXl4RFFVRkRMRWRCUVZFc1JVRkJSU3hGUVVGRk96UkNRVU53UlN4SlFVRkpMRWxCUVVrc1EwRkJReXhOUVVGTkxFTkJRVU1zUjBGQlJ5eERRVUZETEV0QlFVc3NRMEZCUXp0blEwRkJSU3hQUVVGUExFdEJRVXNzUTBGQlF6czBRa0ZGZWtNc1RVRkJUU3hoUVVGaExFZEJRVWNzU1VGQlNTeEpRVUZKTEVOQlFVTXNhVUpCUVdsQ0xFTkJRVU1zWTBGQll5eERRVUZETEVOQlFVTTdORUpCUTJwRkxFMUJRVTBzVjBGQlZ5eEhRVUZITEVsQlFVa3NTVUZCU1N4RFFVRkRMRWRCUVVjc1EwRkJReXhqUVVGakxFTkJRVU1zUTBGQlF6czBRa0ZEYWtRc1lVRkJZU3hEUVVGRExHVkJRV1VzUTBGQlF5eERRVUZETEVOQlFVTXNRMEZCUXpzMFFrRkRha01zVjBGQlZ5eERRVUZETEdWQlFXVXNRMEZCUXl4RFFVRkRMRU5CUVVNc1EwRkJRenMwUWtGRkwwSXNUMEZCVHl4aFFVRmhMRU5CUVVNc1QwRkJUeXhGUVVGRkxFdEJRVXNzVjBGQlZ5eERRVUZETEU5QlFVOHNSVUZCUlN4RFFVRkRPM2RDUVVNelJDeERRVUZETEVOQlFVTXNRMEZCUXp0M1FrRkZTQ3hKUVVGSkxHVkJRV1VzUlVGQlJUczBRa0ZEYmtJc01FUkJRVEJFT3pSQ1FVTXhSQ3hyUWtGQmEwSXNRMEZCUXl4UlFVRlJMRU5CUVVNc1EwRkJReXhEUVVGRExFZEJRVWNzWlVGQlpTeERRVUZET3pSQ1FVTnFSQ3hUUVVGVExFZEJRVWNzU1VGQlNTeERRVUZETzNsQ1FVTnNRanR2UWtGRFNDeERRVUZETEVOQlFVTXNRMEZCUXp0dlFrRkZTQ3h4UlVGQmNVVTdiMEpCUTNKRkxFbEJRVWtzUTBGQlF5eFRRVUZUTEVWQlFVVTdkMEpCUTJRc2EwSkJRV3RDTEVOQlFVTXNVVUZCVVN4RFFVRkRMRTFCUVUwc1EwRkJReXhEUVVGRExFVkJRVVVzUTBGQlF5eERRVUZETEVOQlFVTTdkMEpCUTNwRExFTkJRVU1zUlVGQlJTeERRVUZETzNkQ1FVTktMR05CUVdNc1JVRkJSU3hEUVVGRE8zRkNRVU5zUWp0dlFrRkZSQ3hKUVVGSkxGTkJRVk1zUlVGQlJUdDNRa0ZEWWl4bFFVRmxMRVZCUVVVc1EwRkJRenR4UWtGRGJrSTdhVUpCUTBZN1lVRkRSanRaUVVWRUxFOUJRVThzUTBGQlF5eEhRVUZITEVOQlFVTXNOa0pCUVRaQ0xFVkJRVVVzWTBGQll5eERRVUZETEVOQlFVTTdXVUZETTBRc1QwRkJUeXhEUVVGRExFZEJRVWNzUTBGQlF5eG5RMEZCWjBNc1JVRkJSU3hsUVVGbExFTkJRVU1zUTBGQlF6dFRRVU5vUlR0UlFVVkVMSEZGUVVGeFJUdFJRVU55UlN4TlFVRk5MRzlDUVVGdlFpeEhRVUZITEVsQlFVa3NRMEZCUXl4WlFVRlpMRU5CUVVNc2EwSkJRV3RDTEVOQlFVTXNRMEZCUXp0UlFVTnVSU3huUlVGQlowVTdVVUZEYUVVc1QwRkJUeXh2UWtGQmIwSXNRMEZCUXp0SlFVTTVRaXhEUVVGRE8wbEJSVXNzY1VKQlFYRkNMRU5CUVVNc1ZVRkJjMEk3TzFsQlEyaEVMRkZCUVZFc1EwRkJReXhsUVVGbExFZEJRVWNzVlVGQlZTeERRVUZETEVOQlFVTTdXVUZGZGtNc1NVRkJTU3hKUVVGSkxFZEJRV0VzUlVGQlJTeERRVUZETzFsQlEzaENMRWxCUVVrc1QwRkJUeXhIUVVGaExFbEJRVWtzUTBGQlF5eGhRVUZoTEVWQlFVVXNRMEZCUXl4eFFrRkJjVUlzUTBGQlF5eFZRVUZWTEVOQlFVTXNRMEZCUXp0WlFVVXZSU3hMUVVGTExFMUJRVTBzVFVGQlRTeEpRVUZKTEU5QlFVOHNSVUZCUlR0blFrRkROVUlzTmtOQlFUWkRPMmRDUVVNM1F5eE5RVUZOTEZOQlFWTXNSMEZCUnl4TlFVRk5MRU5CUVVNc1lVRkJZU3hEUVVGRExFbEJRVWtzUTBGQlF5eFBRVUZQTEVOQlFVTXNTVUZCU1N4TlFVRk5MRU5CUVVNc1YwRkJWeXhGUVVGRkxFTkJRVU03WjBKQlJUZEZMRzlFUVVGdlJEdG5Ra0ZEY0VRc1RVRkJUU3hKUVVGSkxFZEJRVmNzVFVGQlRTeERRVUZETEUxQlFVMHNUVUZCVFN4RFFVRkRMRTlCUVU4c1EwRkJReXhUUVVGVExHRkJRVlFzVTBGQlV5eDFRa0ZCVkN4VFFVRlRMRU5CUVVVc1IwRkJSeXhEUVVGRExFTkJRVU1zUTBGQlF5eEpRVUZKTEVWQlFVVXNRMEZCUXp0blFrRkRla1VzU1VGQlNTeERRVUZETEVsQlFVa3NRMEZCUXl4SlFVRkpMRU5CUVVNc1EwRkJRenRuUWtGRGFFSXNTVUZCU1N4SlFVRkpMRU5CUVVNc1MwRkJTeXhEUVVGRExFbEJRVWtzUTBGQlF5eEZRVUZGTzI5Q1FVTndRaXhSUVVGUkxFTkJRVU1zWlVGQlpTeEhRVUZITEZWQlFWVXNSMEZCUnl4alFVRmpMRU5CUVVNc1EwRkJRenR2UWtGRGVFUXNTVUZCU1N4RFFVRkRMR0ZCUVdFc1JVRkJSU3hEUVVGRExGbEJRVmtzUTBGQlF5eE5RVUZOTEVOQlFVTXNRMEZCUXp0dlFrRkRNVU1zVTBGQlV6dHBRa0ZEVmp0blFrRkZSQ3hQUVVGUExFVkJRVVVzU1VGQlNTeEZRVUZGTEVsQlFVa3NSVUZCUlN4SlFVRkpMRVZCUVVVc1NVRkJTU3hGUVVGRkxFTkJRVU03WVVGRGJrTTdXVUZGUkN4UFFVRlBMRVZCUVVVc1NVRkJTU3hGUVVGRkxFbEJRVWtzUlVGQlJTeEpRVUZKTEVWQlFVVXNTVUZCU1N4RlFVRkZMRU5CUVVNN1VVRkRjRU1zUTBGQlF6dExRVUZCTzBsQlJVUXNWVUZCVlN4RFFVRkRMRmRCUVcxQ08xRkJRelZDTEZGQlFWRXNRMEZCUXl4cFFrRkJhVUlzUlVGQlJTeFhRVUZYTEVOQlFVTXNRMEZCUXp0UlFVTjZReXhKUVVGSkxFTkJRVU1zWVVGQllTeEhRVUZITEZkQlFWY3NRMEZCUXp0UlFVVnFReXhKUVVGSkxHRkJRV0VzUjBGQlJ5eEpRVUZKTEVOQlFVTXNWVUZCVlN4RFFVRkRMRWxCUVVrc1EwRkJReXhEUVVGRExFMUJRVTBzUlVGQlJTeEZRVUZGTEVOQlFVTXNUVUZCVFN4RFFVRkRMRmRCUVZjc1MwRkJTeXhYUVVGWExFTkJRVU1zUTBGQlF6dFJRVU42Uml4SlFVRkpMRU5CUVVNc1lVRkJZU3hGUVVGRk8xbEJRMnhDTEdGQlFXRXNSMEZCUnl4SlFVRkpMR1ZCUVUwc1EwRkJReXhYUVVGWExFTkJRVU1zUTBGQlF6dFpRVU40UXl4SlFVRkpMRU5CUVVNc1ZVRkJWU3hEUVVGRExFbEJRVWtzUTBGQlF5eGhRVUZoTEVOQlFVTXNRMEZCUXp0VFFVTnlRenRKUVVOSUxFTkJRVU03UTBGRFJqdEJRVEZPUkN4M1FrRXdUa01pZlE9PSIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuU3RyZWFtVHlwZSA9IHZvaWQgMDtcclxudmFyIFN0cmVhbVR5cGU7XHJcbihmdW5jdGlvbiAoU3RyZWFtVHlwZSkge1xyXG4gICAgU3RyZWFtVHlwZVtcIlBJQ1RVUkVcIl0gPSBcInBpY3R1cmUtYnktcGljdHVyZVwiO1xyXG4gICAgU3RyZWFtVHlwZVtcIlRIVU5ERVJET01FXCJdID0gXCJ0aHVuZGVyZG9tZVwiO1xyXG4gICAgU3RyZWFtVHlwZVtcIkVNQkVEXCJdID0gXCJlbWJlZFwiO1xyXG4gICAgU3RyZWFtVHlwZVtcIkZST05UUEFHRVwiXSA9IFwiZnJvbnRwYWdlXCI7XHJcbiAgICBTdHJlYW1UeXBlW1wiU0lURVwiXSA9IFwic2l0ZVwiO1xyXG4gICAgU3RyZWFtVHlwZVtcIkVYVEVSTkFMXCJdID0gXCJleHRlcm5hbFwiO1xyXG4gICAgU3RyZWFtVHlwZVtcIkROU1wiXSA9IFwiZG5zXCI7XHJcbn0pKFN0cmVhbVR5cGUgPSBleHBvcnRzLlN0cmVhbVR5cGUgfHwgKGV4cG9ydHMuU3RyZWFtVHlwZSA9IHt9KSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtiYXNlNjQsZXlKMlpYSnphVzl1SWpvekxDSm1hV3hsSWpvaWMzUnlaV0Z0TG1WdWRXMHVhbk1pTENKemIzVnlZMlZTYjI5MElqb2lJaXdpYzI5MWNtTmxjeUk2V3lJdUxpOHVMaTh1TGk4dUxpOXpjbU12Ylc5a2RXeGxjeTl6ZEhKbFlXMHZhVzUwWlhKbVlXTmxMM04wY21WaGJTNWxiblZ0TG5SeklsMHNJbTVoYldWeklqcGJYU3dpYldGd2NHbHVaM01pT2lJN096dEJRVUZCTEVsQlFWa3NWVUZSV0R0QlFWSkVMRmRCUVZrc1ZVRkJWVHRKUVVOd1FpdzBRMEZCT0VJc1EwRkJRVHRKUVVNNVFpeDVRMEZCTWtJc1EwRkJRVHRKUVVNelFpdzJRa0ZCWlN4RFFVRkJPMGxCUTJZc2NVTkJRWFZDTEVOQlFVRTdTVUZEZGtJc01rSkJRV0VzUTBGQlFUdEpRVU5pTEcxRFFVRnhRaXhEUVVGQk8wbEJRM0pDTEhsQ1FVRlhMRU5CUVVFN1FVRkRZaXhEUVVGRExFVkJVbGNzVlVGQlZTeEhRVUZXTEd0Q1FVRlZMRXRCUVZZc2EwSkJRVlVzVVVGUmNrSWlmUT09IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5TZXJ2ZXIgPSBleHBvcnRzLlN0cmVhbVVybCA9IHZvaWQgMDtcclxuY2xhc3MgU3RyZWFtVXJsIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMudXJsID0gXCJcIjtcclxuICAgICAgICB0aGlzLnF1YWxpdHkgPSBcIlwiO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuU3RyZWFtVXJsID0gU3RyZWFtVXJsO1xyXG5jbGFzcyBTZXJ2ZXIge1xyXG4gICAgY29uc3RydWN0b3IocGFydGlhbCkge1xyXG4gICAgICAgIHRoaXMuYmVzdFF1YWxpdHkgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVybExpc3RbMF07XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmZpbmRCeVF1YWxpdHkgPSAocXVhbGl0eSkgPT4gdGhpcy51cmxMaXN0LmZpbmQoKHgpID0+IHgucXVhbGl0eSA9PSBxdWFsaXR5KTtcclxuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIHBhcnRpYWwpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuU2VydmVyID0gU2VydmVyO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1kYXRhOmFwcGxpY2F0aW9uL2pzb247YmFzZTY0LGV5SjJaWEp6YVc5dUlqb3pMQ0ptYVd4bElqb2ljM1J5WldGdExuUjVjR1Z6TG1weklpd2ljMjkxY21ObFVtOXZkQ0k2SWlJc0luTnZkWEpqWlhNaU9sc2lMaTR2TGk0dkxpNHZMaTR2YzNKakwyMXZaSFZzWlhNdmMzUnlaV0Z0TDJsdWRHVnlabUZqWlM5emRISmxZVzB1ZEhsd1pYTXVkSE1pWFN3aWJtRnRaWE1pT2x0ZExDSnRZWEJ3YVc1bmN5STZJanM3TzBGQlFVRXNUVUZCWVN4VFFVRlRPMGxCUVhSQ08xRkJRMFVzVVVGQlJ5eEhRVUZYTEVWQlFVVXNRMEZCUXp0UlFVTnFRaXhaUVVGUExFZEJRVmNzUlVGQlJTeERRVUZETzBsQlEzWkNMRU5CUVVNN1EwRkJRVHRCUVVoRUxEaENRVWRETzBGQlEwUXNUVUZCWVN4TlFVRk5PMGxCVldwQ0xGbEJRVmtzVDBGQmQwSTdVVUZNY0VNc1owSkJRVmNzUjBGQlJ5eEhRVUZITEVWQlFVVTdXVUZEYWtJc1QwRkJUeXhKUVVGSkxFTkJRVU1zVDBGQlR5eERRVUZETEVOQlFVTXNRMEZCUXl4RFFVRkRPMUZCUTNwQ0xFTkJRVU1zUTBGQlF6dFJRVU5HTEd0Q1FVRmhMRWRCUVVjc1EwRkJReXhQUVVGbExFVkJRVVVzUlVGQlJTeERRVUZETEVsQlFVa3NRMEZCUXl4UFFVRlBMRU5CUVVNc1NVRkJTU3hEUVVGRExFTkJRVU1zUTBGQlF5eEZRVUZGTEVWQlFVVXNRMEZCUXl4RFFVRkRMRU5CUVVNc1QwRkJUeXhKUVVGSkxFOUJRVThzUTBGQlF5eERRVUZETzFGQlIyeEdMRTFCUVUwc1EwRkJReXhOUVVGTkxFTkJRVU1zU1VGQlNTeEZRVUZGTEU5QlFVOHNRMEZCUXl4RFFVRkRPMGxCUXk5Q0xFTkJRVU03UTBGRFJqdEJRV0pFTEhkQ1FXRkRJbjA9IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLlN0cmVhbSA9IHZvaWQgMDtcclxuY29uc3QgdHdpdGNoX3NlcnZpY2VfMSA9IHJlcXVpcmUoXCIuLi90d2l0Y2gvdHdpdGNoLnNlcnZpY2VcIik7XHJcbmNvbnN0IHN0cmVhbV90eXBlc18xID0gcmVxdWlyZShcIi4vaW50ZXJmYWNlL3N0cmVhbS50eXBlc1wiKTtcclxuY2xhc3MgU3RyZWFtIHtcclxuICAgIGNvbnN0cnVjdG9yKGNoYW5uZWxOYW1lKSB7XHJcbiAgICAgICAgdGhpcy5zZXJ2ZXJMaXN0ID0gW107IC8vdGhlIGxpc3Qgb2Ygc2VydmVycyBsaW5rcyBtM3U4XHJcbiAgICAgICAgdGhpcy5jaGFubmVsTmFtZSA9IGNoYW5uZWxOYW1lO1xyXG4gICAgICAgIHRoaXMudHdpdGNoU2VydmljZSA9IG5ldyB0d2l0Y2hfc2VydmljZV8xLlR3aXRjaFNlcnZpY2UoXCJcIik7XHJcbiAgICB9XHJcbiAgICByZW1vdmVTZXJ2ZXIoc2VydmVyKSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNlcnZlckxpc3QuaW5kZXhPZihzZXJ2ZXIpO1xyXG4gICAgICAgIGlmIChpbmRleCA+IC0xKVxyXG4gICAgICAgICAgICB0aGlzLnNlcnZlckxpc3Quc3BsaWNlKGluZGV4LCAxKTtcclxuICAgIH1cclxuICAgIC8vYWRkIG0zdTggbGlua3Mgd2l0aCBxdWFsaXR5IHRvIHRoZSBsaXN0IG9mIHNlcnZlcnNcclxuICAgIHNldFN0cmVhbUFjY2Vzcyh0ZXh0LCB0eXBlID0gXCJsb2NhbFwiLCBzaWcgPSB0cnVlKSB7XHJcbiAgICAgICAgY29uc3QgcXVhbGl0eVVybFNwbGl0ID0gW107XHJcbiAgICAgICAgbGV0IGNhcHR1cmVBcnJheTtcclxuICAgICAgICBjb25zdCBSRUdFWCA9IC9OQU1FPVwiKCg/OlxcUytcXHMrXFxTK3xcXFMrKSlcIixBVVRPKD86XnxcXFMrXFxzKykoPzpefFxcUytcXHMrKShodHRwczpcXC9cXC92aWRlbyhcXFMrKS5tM3U4KS9nO1xyXG4gICAgICAgIHdoaWxlICgoY2FwdHVyZUFycmF5ID0gUkVHRVguZXhlYyh0ZXh0KSkgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcXVhbGl0eVVybFNwbGl0LnB1c2goeyBxdWFsaXR5OiBjYXB0dXJlQXJyYXlbMV0sIHVybDogY2FwdHVyZUFycmF5WzJdIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzdHJlYW1MaXN0ID0gbmV3IHN0cmVhbV90eXBlc18xLlNlcnZlcih7IHR5cGU6IHR5cGUsIHVybExpc3Q6IHF1YWxpdHlVcmxTcGxpdCwgc2lnOiBzaWcgfSk7XHJcbiAgICAgICAgdGhpcy5zZXJ2ZXJMaXN0LnB1c2goc3RyZWFtTGlzdCk7XHJcbiAgICB9XHJcbiAgICAvL2NyZWF0ZSBhIG5ldyBzdHJlYW0gYWNjZXNzXHJcbiAgICBjcmVhdGVTdHJlYW1BY2Nlc3MocGxheWVyVHlwZSwgaW50ZWdyaXR5VG9rZW4pIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFtRGF0YUFjY2VzcyA9IHlpZWxkIHRoaXMudHdpdGNoU2VydmljZS5wbGF5YmFja0FjY2Vzc1Rva2VuKHRoaXMuY2hhbm5lbE5hbWUsIHBsYXllclR5cGUsIGludGVncml0eVRva2VuKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTmV3IENvbm5lY3Rpb246IFwiLCBwbGF5ZXJUeXBlLCBzdHJlYW1EYXRhQWNjZXNzLnRva2VuLmluY2x1ZGVzKCdcImhpZGVfYWRzXCI6dHJ1ZScpKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG0zdThUZXh0ID0geWllbGQgdGhpcy50d2l0Y2hTZXJ2aWNlLmdldE0zVTgodGhpcy5jaGFubmVsTmFtZSwgc3RyZWFtRGF0YUFjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0cmVhbUFjY2VzcyhtM3U4VGV4dCwgcGxheWVyVHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIGxvZ1ByaW50KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnZXRTdHJlYW1CeVN0cmVhbVR5cGUoYWNjZXNzVHlwZSkge1xyXG4gICAgICAgIC8vZmlsdGVyIGFsbCBzZXJ2ZXIgYnkgdHlwZVxyXG4gICAgICAgIGNvbnN0IHNlcnZlcnMgPSB0aGlzLnNlcnZlckxpc3QuZmlsdGVyKCh4KSA9PiB4LnR5cGUgPT0gYWNjZXNzVHlwZSk7XHJcbiAgICAgICAgaWYgKCFzZXJ2ZXJzKVxyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgcmV0dXJuIHNlcnZlcnM7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5TdHJlYW0gPSBTdHJlYW07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtiYXNlNjQsZXlKMlpYSnphVzl1SWpvekxDSm1hV3hsSWpvaWMzUnlaV0Z0TG1weklpd2ljMjkxY21ObFVtOXZkQ0k2SWlJc0luTnZkWEpqWlhNaU9sc2lMaTR2TGk0dkxpNHZjM0pqTDIxdlpIVnNaWE12YzNSeVpXRnRMM04wY21WaGJTNTBjeUpkTENKdVlXMWxjeUk2VzEwc0ltMWhjSEJwYm1keklqb2lPenM3T3pzN096czdPenM3UVVGQlFTdzJSRUZCZVVRN1FVRkZla1FzTWtSQlFUWkVPMEZCUlRkRUxFMUJRV0VzVFVGQlRUdEpRVXRxUWl4WlFVRlpMRmRCUVcxQ08xRkJTaTlDTEdWQlFWVXNSMEZCWVN4RlFVRkZMRU5CUVVNc1EwRkJReXhuUTBGQlowTTdVVUZMZWtRc1NVRkJTU3hEUVVGRExGZEJRVmNzUjBGQlJ5eFhRVUZYTEVOQlFVTTdVVUZETDBJc1NVRkJTU3hEUVVGRExHRkJRV0VzUjBGQlJ5eEpRVUZKTERoQ1FVRmhMRU5CUVVNc1JVRkJSU3hEUVVGRExFTkJRVU03U1VGRE4wTXNRMEZCUXp0SlFVVkVMRmxCUVZrc1EwRkJReXhOUVVGak8xRkJRM3BDTEUxQlFVMHNTMEZCU3l4SFFVRkhMRWxCUVVrc1EwRkJReXhWUVVGVkxFTkJRVU1zVDBGQlR5eERRVUZETEUxQlFVMHNRMEZCUXl4RFFVRkRPMUZCUXpsRExFbEJRVWtzUzBGQlN5eEhRVUZITEVOQlFVTXNRMEZCUXp0WlFVRkZMRWxCUVVrc1EwRkJReXhWUVVGVkxFTkJRVU1zVFVGQlRTeERRVUZETEV0QlFVc3NSVUZCUlN4RFFVRkRMRU5CUVVNc1EwRkJRenRKUVVOdVJDeERRVUZETzBsQlJVUXNiMFJCUVc5RU8wbEJRM0JFTEdWQlFXVXNRMEZCUXl4SlFVRlpMRVZCUVVVc1NVRkJTU3hIUVVGSExFOUJRVThzUlVGQlJTeEhRVUZITEVkQlFVY3NTVUZCU1R0UlFVTjBSQ3hOUVVGTkxHVkJRV1VzUjBGQlowSXNSVUZCUlN4RFFVRkRPMUZCUTNoRExFbEJRVWtzV1VGQmIwTXNRMEZCUXp0UlFVVjZReXhOUVVGTkxFdEJRVXNzUjBGQlJ5eHhSa0ZCY1VZc1EwRkJRenRSUVVWd1J5eFBRVUZQTEVOQlFVTXNXVUZCV1N4SFFVRkhMRXRCUVVzc1EwRkJReXhKUVVGSkxFTkJRVU1zU1VGQlNTeERRVUZETEVOQlFVTXNTMEZCU3l4SlFVRkpMRVZCUVVVN1dVRkRha1FzWlVGQlpTeERRVUZETEVsQlFVa3NRMEZCUXl4RlFVRkZMRTlCUVU4c1JVRkJSU3haUVVGWkxFTkJRVU1zUTBGQlF5eERRVUZETEVWQlFVVXNSMEZCUnl4RlFVRkZMRmxCUVZrc1EwRkJReXhEUVVGRExFTkJRVU1zUlVGQlJTeERRVUZETEVOQlFVTTdVMEZETVVVN1VVRkZSQ3hOUVVGTkxGVkJRVlVzUjBGQlZ5eEpRVUZKTEhGQ1FVRk5MRU5CUVVNc1JVRkJSU3hKUVVGSkxFVkJRVVVzU1VGQlNTeEZRVUZGTEU5QlFVOHNSVUZCUlN4bFFVRmxMRVZCUVVVc1IwRkJSeXhGUVVGRkxFZEJRVWNzUlVGQlJTeERRVUZETEVOQlFVTTdVVUZETVVZc1NVRkJTU3hEUVVGRExGVkJRVlVzUTBGQlF5eEpRVUZKTEVOQlFVTXNWVUZCVlN4RFFVRkRMRU5CUVVNN1NVRkRia01zUTBGQlF6dEpRVVZFTERSQ1FVRTBRanRKUVVOMFFpeHJRa0ZCYTBJc1EwRkJReXhWUVVGelFpeEZRVUZGTEdOQlFYTkNPenRaUVVOeVJTeEpRVUZKTzJkQ1FVTkdMRTFCUVUwc1owSkJRV2RDTEVkQlFVY3NUVUZCVFN4SlFVRkpMRU5CUVVNc1lVRkJZU3hEUVVGRExHMUNRVUZ0UWl4RFFVRkRMRWxCUVVrc1EwRkJReXhYUVVGWExFVkJRVVVzVlVGQlZTeEZRVUZGTEdOQlFXTXNRMEZCUXl4RFFVRkRPMmRDUVVOd1NDeFBRVUZQTEVOQlFVTXNSMEZCUnl4RFFVRkRMR3RDUVVGclFpeEZRVUZGTEZWQlFWVXNSVUZCUlN4blFrRkJaMElzUTBGQlF5eExRVUZMTEVOQlFVTXNVVUZCVVN4RFFVRkRMR2xDUVVGcFFpeERRVUZETEVOQlFVTXNRMEZCUXp0blFrRkRhRWNzVFVGQlRTeFJRVUZSTEVkQlFVY3NUVUZCVFN4SlFVRkpMRU5CUVVNc1lVRkJZU3hEUVVGRExFOUJRVThzUTBGQlF5eEpRVUZKTEVOQlFVTXNWMEZCVnl4RlFVRkZMR2RDUVVGblFpeERRVUZETEVOQlFVTTdaMEpCUTNSR0xFbEJRVWtzUTBGQlF5eGxRVUZsTEVOQlFVTXNVVUZCVVN4RlFVRkZMRlZCUVZVc1EwRkJReXhEUVVGRE8yRkJRelZETzFsQlFVTXNUMEZCVHl4RFFVRkRMRVZCUVVVN1owSkJRMVlzVVVGQlVTeERRVUZETEVOQlFVTXNRMEZCUXl4RFFVRkRPMkZCUTJJN1VVRkRTQ3hEUVVGRE8wdEJRVUU3U1VGRlJDeHhRa0ZCY1VJc1EwRkJReXhWUVVGelFqdFJRVU14UXl3eVFrRkJNa0k3VVVGRE0wSXNUVUZCVFN4UFFVRlBMRWRCUVVjc1NVRkJTU3hEUVVGRExGVkJRVlVzUTBGQlF5eE5RVUZOTEVOQlFVTXNRMEZCUXl4RFFVRkRMRVZCUVVVc1JVRkJSU3hEUVVGRExFTkJRVU1zUTBGQlF5eEpRVUZKTEVsQlFVa3NWVUZCVlN4RFFVRkRMRU5CUVVNN1VVRkRjRVVzU1VGQlNTeERRVUZETEU5QlFVODdXVUZCUlN4UFFVRlBMRVZCUVVVc1EwRkJRenRSUVVWNFFpeFBRVUZQTEU5QlFVOHNRMEZCUXp0SlFVTnFRaXhEUVVGRE8wTkJRMFk3UVVGcVJFUXNkMEpCYVVSREluMD0iLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuVHdpdGNoU2VydmljZSA9IHZvaWQgMDtcclxuY2xhc3MgVHdpdGNoU2VydmljZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihpbnRlZ3JpdHlUb2tlbikge1xyXG4gICAgICAgIHRoaXMuaW50ZWdyaXR5VG9rZW4gPSBpbnRlZ3JpdHlUb2tlbjtcclxuICAgIH1cclxuICAgIHBsYXliYWNrQWNjZXNzVG9rZW4oY2hhbm5lbE5hbWUsIHBsYXllclR5cGUsIGludGVncml0eVRva2VuKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgYm9keSA9IHtcclxuICAgICAgICAgICAgICAgIG9wZXJhdGlvbk5hbWU6ICdQbGF5YmFja0FjY2Vzc1Rva2VuJyxcclxuICAgICAgICAgICAgICAgIHZhcmlhYmxlczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGlzTGl2ZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBsb2dpbjogY2hhbm5lbE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgaXNWb2Q6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHZvZElEOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJUeXBlOiBwbGF5ZXJUeXBlXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZXh0ZW5zaW9uczoge1xyXG4gICAgICAgICAgICAgICAgICAgIHBlcnNpc3RlZFF1ZXJ5OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNoYTI1Nkhhc2g6ICcwODI4MTE5ZGVkMWMxMzQ3Nzk2NjQzNGUxNTgwMGZmNTdkZGFjZjEzYmExOTExYzEyOWRjMjIwMDcwNWIwNzEyJ1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgZ3FsID0geWllbGQgZ2xvYmFsLnJlcXVlc3QoXCJodHRwczovL2dxbC50d2l0Y2gudHYvZ3FsI29yaWdpbj10d2lsaWdodFwiLCB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeyBcIkhvc3RcIjogXCJncWwudHdpdGNoLnR2XCIsIFwiQ2xpZW50LUlEXCI6IFwia2ltbmU3OGt4M25jeDZicmdvNG12NndraTVoMWtvXCIsIFwiQ2xpZW50LUludGVncml0eVwiOiBpbnRlZ3JpdHlUb2tlbiB9LFxyXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBzdHJlYW1EYXRhQWNjZXNzID0geWllbGQgZ3FsLmpzb24oKTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgdG9rZW46IHN0cmVhbURhdGFBY2Nlc3MuZGF0YS5zdHJlYW1QbGF5YmFja0FjY2Vzc1Rva2VuLnZhbHVlLCBzaWduYXR1cmU6IHN0cmVhbURhdGFBY2Nlc3MuZGF0YS5zdHJlYW1QbGF5YmFja0FjY2Vzc1Rva2VuLnNpZ25hdHVyZSB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcGxheWJhY2tBY2Nlc3NUb2tlbl9UZW1wbGF0ZShjaGFubmVsTmFtZSwgcGxheWVyVHlwZSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gJ3F1ZXJ5IFBsYXliYWNrQWNjZXNzVG9rZW5fVGVtcGxhdGUoJGxvZ2luOiBTdHJpbmchLCAkaXNMaXZlOiBCb29sZWFuISwgJHZvZElEOiBJRCEsICRpc1ZvZDogQm9vbGVhbiEsICRwbGF5ZXJUeXBlOiBTdHJpbmchKSB7IHN0cmVhbVBsYXliYWNrQWNjZXNzVG9rZW4oY2hhbm5lbE5hbWU6ICRsb2dpbiwgcGFyYW1zOiB7cGxhdGZvcm06IFwid2ViXCIsIHBsYXllckJhY2tlbmQ6IFwibWVkaWFwbGF5ZXJcIiwgcGxheWVyVHlwZTogJHBsYXllclR5cGV9KSBAaW5jbHVkZShpZjogJGlzTGl2ZSkgeyB2YWx1ZSBzaWduYXR1cmUgX190eXBlbmFtZSB9IHZpZGVvUGxheWJhY2tBY2Nlc3NUb2tlbihpZDogJHZvZElELCBwYXJhbXM6IHtwbGF0Zm9ybTogXCJ3ZWJcIiwgcGxheWVyQmFja2VuZDogXCJtZWRpYXBsYXllclwiLCBwbGF5ZXJUeXBlOiAkcGxheWVyVHlwZX0pIEBpbmNsdWRlKGlmOiAkaXNWb2QpIHsgdmFsdWUgc2lnbmF0dXJlIF9fdHlwZW5hbWUgfX0nO1xyXG4gICAgICAgICAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICAgICAgICAgICAgb3BlcmF0aW9uTmFtZTogXCJQbGF5YmFja0FjY2Vzc1Rva2VuX1RlbXBsYXRlXCIsXHJcbiAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnksXHJcbiAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBpc0xpdmU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgaXNWb2Q6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHZvZElEOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2luOiBjaGFubmVsTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJUeXBlOiBwbGF5ZXJUeXBlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgZ3FsID0geWllbGQgZ2xvYmFsLnJlcXVlc3QoXCJodHRwczovL2dxbC50d2l0Y2gudHYvZ3FsXCIsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7IFwiSG9zdFwiOiBcImdxbC50d2l0Y2gudHZcIiwgXCJDbGllbnQtSURcIjogXCJraW1uZTc4a3gzbmN4NmJyZ280bXY2d2tpNWgxa29cIiB9LFxyXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBzdHJlYW1EYXRhQWNjZXNzID0geWllbGQgZ3FsLmpzb24oKTtcclxuICAgICAgICAgICAgcmV0dXJuIHsgdG9rZW46IHN0cmVhbURhdGFBY2Nlc3MuZGF0YS5zdHJlYW1QbGF5YmFja0FjY2Vzc1Rva2VuLnZhbHVlLCBzaWduYXR1cmU6IHN0cmVhbURhdGFBY2Nlc3MuZGF0YS5zdHJlYW1QbGF5YmFja0FjY2Vzc1Rva2VuLnNpZ25hdHVyZSB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZ2V0TTNVOChjaGFubmVsTmFtZSwgcGxheWJhY2tBY2Nlc3NUb2tlbikge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IFwiYWxsb3dfc291cmNlPXRydWUmZmFzdF9icmVhZD10cnVlJnA9XCIgK1xyXG4gICAgICAgICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMWU3KSArXHJcbiAgICAgICAgICAgICAgICBcIiZwbGF5ZXJfYmFja2VuZD1tZWRpYXBsYXllciZwbGF5bGlzdF9pbmNsdWRlX2ZyYW1lcmF0ZT10cnVlJnJlYXNzaWdubWVudHNfc3VwcG9ydGVkPWZhbHNlJnNpZz1cIiArXHJcbiAgICAgICAgICAgICAgICBwbGF5YmFja0FjY2Vzc1Rva2VuLnNpZ25hdHVyZSArXHJcbiAgICAgICAgICAgICAgICBcIiZzdXBwb3J0ZWRfY29kZWNzPWF2YzEmdG9rZW49XCIgK1xyXG4gICAgICAgICAgICAgICAgcGxheWJhY2tBY2Nlc3NUb2tlbi50b2tlbjtcclxuICAgICAgICAgICAgcmV0dXJuICh5aWVsZCBnbG9iYWwucmVxdWVzdChcImh0dHBzOi8vdXNoZXIudHR2bncubmV0L2FwaS9jaGFubmVsL2hscy9cIiArIGNoYW5uZWxOYW1lICsgXCIubTN1OD9cIiArIHBhcmFtcykpLnRleHQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLlR3aXRjaFNlcnZpY2UgPSBUd2l0Y2hTZXJ2aWNlO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1kYXRhOmFwcGxpY2F0aW9uL2pzb247YmFzZTY0LGV5SjJaWEp6YVc5dUlqb3pMQ0ptYVd4bElqb2lkSGRwZEdOb0xuTmxjblpwWTJVdWFuTWlMQ0p6YjNWeVkyVlNiMjkwSWpvaUlpd2ljMjkxY21ObGN5STZXeUl1TGk4dUxpOHVMaTl6Y21NdmJXOWtkV3hsY3k5MGQybDBZMmd2ZEhkcGRHTm9Mbk5sY25acFkyVXVkSE1pWFN3aWJtRnRaWE1pT2x0ZExDSnRZWEJ3YVc1bmN5STZJanM3T3pzN096czdPenM3TzBGQlFVRXNUVUZCWVN4aFFVRmhPMGxCUTNSQ0xGbEJRVFpDTEdOQlFYTkNPMUZCUVhSQ0xHMUNRVUZqTEVkQlFXUXNZMEZCWXl4RFFVRlJPMGxCUVVrc1EwRkJRenRKUVVWc1JDeHRRa0ZCYlVJc1EwRkJReXhYUVVGdFFpeEZRVUZGTEZWQlFXdENMRVZCUVVVc1kwRkJjMEk3TzFsQlEzSkdMRTFCUVUwc1NVRkJTU3hIUVVGSE8yZENRVU5VTEdGQlFXRXNSVUZCUlN4eFFrRkJjVUk3WjBKQlEzQkRMRk5CUVZNc1JVRkJSVHR2UWtGRFVDeE5RVUZOTEVWQlFVVXNTVUZCU1R0dlFrRkRXaXhMUVVGTExFVkJRVVVzVjBGQlZ6dHZRa0ZEYkVJc1MwRkJTeXhGUVVGRkxFdEJRVXM3YjBKQlExb3NTMEZCU3l4RlFVRkZMRVZCUVVVN2IwSkJRMVFzVlVGQlZTeEZRVUZGTEZWQlFWVTdhVUpCUTNwQ08yZENRVU5FTEZWQlFWVXNSVUZCUlR0dlFrRkRVaXhqUVVGakxFVkJRVVU3ZDBKQlExb3NUMEZCVHl4RlFVRkZMRU5CUVVNN2QwSkJRMVlzVlVGQlZTeEZRVUZGTEd0RlFVRnJSVHR4UWtGRGFrWTdhVUpCUTBvN1lVRkRTaXhEUVVGQk8xbEJSVVFzVFVGQlRTeEhRVUZITEVkQlFVY3NUVUZCVFN4TlFVRk5MRU5CUVVNc1QwRkJUeXhEUVVGRExESkRRVUV5UXl4RlFVRkZPMmRDUVVNeFJTeE5RVUZOTEVWQlFVVXNUVUZCVFR0blFrRkRaQ3hQUVVGUExFVkJRVVVzUlVGQlJTeE5RVUZOTEVWQlFVVXNaVUZCWlN4RlFVRkZMRmRCUVZjc1JVRkJSU3huUTBGQlowTXNSVUZCUlN4clFrRkJhMElzUlVGQlJTeGpRVUZqTEVWQlFVVTdaMEpCUTNaSUxFbEJRVWtzUlVGQlJTeEpRVUZKTEVOQlFVTXNVMEZCVXl4RFFVRkRMRWxCUVVrc1EwRkJRenRoUVVNM1FpeERRVUZETEVOQlFVTTdXVUZGU0N4TlFVRk5MR2RDUVVGblFpeEhRVUZITEUxQlFVMHNSMEZCUnl4RFFVRkRMRWxCUVVrc1JVRkJSU3hEUVVGRE8xbEJRekZETEU5QlFVOHNSVUZCUlN4TFFVRkxMRVZCUVVVc1owSkJRV2RDTEVOQlFVTXNTVUZCU1N4RFFVRkRMSGxDUVVGNVFpeERRVUZETEV0QlFVc3NSVUZCUlN4VFFVRlRMRVZCUVVVc1owSkJRV2RDTEVOQlFVTXNTVUZCU1N4RFFVRkRMSGxDUVVGNVFpeERRVUZETEZOQlFWTXNSVUZCUlN4RFFVRkRPMUZCUTJ4S0xFTkJRVU03UzBGQlFUdEpRVVZMTERSQ1FVRTBRaXhEUVVGRExGZEJRVzFDTEVWQlFVVXNWVUZCYTBJN08xbEJRM1JGTEUxQlFVMHNTMEZCU3l4SFFVTlFMR2xsUVVGcFpTeERRVUZETzFsQlEzUmxMRTFCUVUwc1NVRkJTU3hIUVVGSE8yZENRVU5VTEdGQlFXRXNSVUZCUlN3NFFrRkJPRUk3WjBKQlF6ZERMRXRCUVVzc1JVRkJSU3hMUVVGTE8yZENRVU5hTEZOQlFWTXNSVUZCUlR0dlFrRkRVQ3hOUVVGTkxFVkJRVVVzU1VGQlNUdHZRa0ZEV2l4TFFVRkxMRVZCUVVVc1MwRkJTenR2UWtGRFdpeExRVUZMTEVWQlFVVXNSVUZCUlR0dlFrRkRWQ3hMUVVGTExFVkJRVVVzVjBGQlZ6dHZRa0ZEYkVJc1ZVRkJWU3hGUVVGRkxGVkJRVlU3YVVKQlEzcENPMkZCUTBvc1EwRkJRenRaUVVWR0xFMUJRVTBzUjBGQlJ5eEhRVUZITEUxQlFVMHNUVUZCVFN4RFFVRkRMRTlCUVU4c1EwRkJReXd5UWtGQk1rSXNSVUZCUlR0blFrRkRNVVFzVFVGQlRTeEZRVUZGTEUxQlFVMDdaMEpCUTJRc1QwRkJUeXhGUVVGRkxFVkJRVVVzVFVGQlRTeEZRVUZGTEdWQlFXVXNSVUZCUlN4WFFVRlhMRVZCUVVVc1owTkJRV2RETEVWQlFVVTdaMEpCUTI1R0xFbEJRVWtzUlVGQlJTeEpRVUZKTEVOQlFVTXNVMEZCVXl4RFFVRkRMRWxCUVVrc1EwRkJRenRoUVVNM1FpeERRVUZETEVOQlFVTTdXVUZEU0N4TlFVRk5MR2RDUVVGblFpeEhRVUZITEUxQlFVMHNSMEZCUnl4RFFVRkRMRWxCUVVrc1JVRkJSU3hEUVVGRE8xbEJSVEZETEU5QlFVOHNSVUZCUlN4TFFVRkxMRVZCUVVVc1owSkJRV2RDTEVOQlFVTXNTVUZCU1N4RFFVRkRMSGxDUVVGNVFpeERRVUZETEV0QlFVc3NSVUZCUlN4VFFVRlRMRVZCUVVVc1owSkJRV2RDTEVOQlFVTXNTVUZCU1N4RFFVRkRMSGxDUVVGNVFpeERRVUZETEZOQlFWTXNSVUZCUlN4RFFVRkRPMUZCUTJ4S0xFTkJRVU03UzBGQlFUdEpRVVZMTEU5QlFVOHNRMEZCUXl4WFFVRnRRaXhGUVVGRkxHMUNRVUY1UkRzN1dVRkRlRVlzVFVGQlRTeE5RVUZOTEVkQlExSXNjME5CUVhORE8yZENRVU4wUXl4SlFVRkpMRU5CUVVNc1MwRkJTeXhEUVVGRExFbEJRVWtzUTBGQlF5eE5RVUZOTEVWQlFVVXNSMEZCUnl4SFFVRkhMRU5CUVVNN1owSkJReTlDTEdkSFFVRm5SenRuUWtGRGFFY3NiVUpCUVcxQ0xFTkJRVU1zVTBGQlV6dG5Ra0ZETjBJc0swSkJRU3RDTzJkQ1FVTXZRaXh0UWtGQmJVSXNRMEZCUXl4TFFVRkxMRU5CUVVNN1dVRkZPVUlzVDBGQlR5eERRVUZETEUxQlFVMHNUVUZCVFN4RFFVRkRMRTlCUVU4c1EwRkJReXd3UTBGQk1FTXNSMEZCUnl4WFFVRlhMRWRCUVVjc1VVRkJVU3hIUVVGSExFMUJRVTBzUTBGQlF5eERRVUZETEVOQlFVTXNTVUZCU1N4RlFVRkZMRU5CUVVNN1VVRkRka2dzUTBGQlF6dExRVUZCTzBOQlEwbzdRVUZ1UlVRc2MwTkJiVVZESW4wPSIsImltcG9ydCB3aW5kb3cgZnJvbSAnZ2xvYmFsL3dpbmRvdyc7XG5cbnZhciBhdG9iID0gZnVuY3Rpb24gYXRvYihzKSB7XG4gIHJldHVybiB3aW5kb3cuYXRvYiA/IHdpbmRvdy5hdG9iKHMpIDogQnVmZmVyLmZyb20ocywgJ2Jhc2U2NCcpLnRvU3RyaW5nKCdiaW5hcnknKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGRlY29kZUI2NFRvVWludDhBcnJheShiNjRUZXh0KSB7XG4gIHZhciBkZWNvZGVkU3RyaW5nID0gYXRvYihiNjRUZXh0KTtcbiAgdmFyIGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoZGVjb2RlZFN0cmluZy5sZW5ndGgpO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZGVjb2RlZFN0cmluZy5sZW5ndGg7IGkrKykge1xuICAgIGFycmF5W2ldID0gZGVjb2RlZFN0cmluZy5jaGFyQ29kZUF0KGkpO1xuICB9XG5cbiAgcmV0dXJuIGFycmF5O1xufSIsIi8qKlxuICogQGZpbGUgc3RyZWFtLmpzXG4gKi9cblxuLyoqXG4gKiBBIGxpZ2h0d2VpZ2h0IHJlYWRhYmxlIHN0cmVhbSBpbXBsZW1lbnRpb24gdGhhdCBoYW5kbGVzIGV2ZW50IGRpc3BhdGNoaW5nLlxuICpcbiAqIEBjbGFzcyBTdHJlYW1cbiAqL1xudmFyIFN0cmVhbSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFN0cmVhbSgpIHtcbiAgICB0aGlzLmxpc3RlbmVycyA9IHt9O1xuICB9XG4gIC8qKlxuICAgKiBBZGQgYSBsaXN0ZW5lciBmb3IgYSBzcGVjaWZpZWQgZXZlbnQgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgdGhlIGV2ZW50IG5hbWVcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgdGhlIGNhbGxiYWNrIHRvIGJlIGludm9rZWQgd2hlbiBhbiBldmVudCBvZlxuICAgKiB0aGUgc3BlY2lmaWVkIHR5cGUgb2NjdXJzXG4gICAqL1xuXG5cbiAgdmFyIF9wcm90byA9IFN0cmVhbS5wcm90b3R5cGU7XG5cbiAgX3Byb3RvLm9uID0gZnVuY3Rpb24gb24odHlwZSwgbGlzdGVuZXIpIHtcbiAgICBpZiAoIXRoaXMubGlzdGVuZXJzW3R5cGVdKSB7XG4gICAgICB0aGlzLmxpc3RlbmVyc1t0eXBlXSA9IFtdO1xuICAgIH1cblxuICAgIHRoaXMubGlzdGVuZXJzW3R5cGVdLnB1c2gobGlzdGVuZXIpO1xuICB9XG4gIC8qKlxuICAgKiBSZW1vdmUgYSBsaXN0ZW5lciBmb3IgYSBzcGVjaWZpZWQgZXZlbnQgdHlwZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgdGhlIGV2ZW50IG5hbWVcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgIGEgZnVuY3Rpb24gcHJldmlvdXNseSByZWdpc3RlcmVkIGZvciB0aGlzXG4gICAqIHR5cGUgb2YgZXZlbnQgdGhyb3VnaCBgb25gXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IGlmIHdlIGNvdWxkIHR1cm4gaXQgb2ZmIG9yIG5vdFxuICAgKi9cbiAgO1xuXG4gIF9wcm90by5vZmYgPSBmdW5jdGlvbiBvZmYodHlwZSwgbGlzdGVuZXIpIHtcbiAgICBpZiAoIXRoaXMubGlzdGVuZXJzW3R5cGVdKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIGluZGV4ID0gdGhpcy5saXN0ZW5lcnNbdHlwZV0uaW5kZXhPZihsaXN0ZW5lcik7IC8vIFRPRE86IHdoaWNoIGlzIGJldHRlcj9cbiAgICAvLyBJbiBWaWRlby5qcyB3ZSBzbGljZSBsaXN0ZW5lciBmdW5jdGlvbnNcbiAgICAvLyBvbiB0cmlnZ2VyIHNvIHRoYXQgaXQgZG9lcyBub3QgbWVzcyB1cCB0aGUgb3JkZXJcbiAgICAvLyB3aGlsZSB3ZSBsb29wIHRocm91Z2guXG4gICAgLy9cbiAgICAvLyBIZXJlIHdlIHNsaWNlIG9uIG9mZiBzbyB0aGF0IHRoZSBsb29wIGluIHRyaWdnZXJcbiAgICAvLyBjYW4gY29udGludWUgdXNpbmcgaXQncyBvbGQgcmVmZXJlbmNlIHRvIGxvb3Agd2l0aG91dFxuICAgIC8vIG1lc3NpbmcgdXAgdGhlIG9yZGVyLlxuXG4gICAgdGhpcy5saXN0ZW5lcnNbdHlwZV0gPSB0aGlzLmxpc3RlbmVyc1t0eXBlXS5zbGljZSgwKTtcbiAgICB0aGlzLmxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIHJldHVybiBpbmRleCA+IC0xO1xuICB9XG4gIC8qKlxuICAgKiBUcmlnZ2VyIGFuIGV2ZW50IG9mIHRoZSBzcGVjaWZpZWQgdHlwZSBvbiB0aGlzIHN0cmVhbS4gQW55IGFkZGl0aW9uYWxcbiAgICogYXJndW1lbnRzIHRvIHRoaXMgZnVuY3Rpb24gYXJlIHBhc3NlZCBhcyBwYXJhbWV0ZXJzIHRvIGV2ZW50IGxpc3RlbmVycy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgdGhlIGV2ZW50IG5hbWVcbiAgICovXG4gIDtcblxuICBfcHJvdG8udHJpZ2dlciA9IGZ1bmN0aW9uIHRyaWdnZXIodHlwZSkge1xuICAgIHZhciBjYWxsYmFja3MgPSB0aGlzLmxpc3RlbmVyc1t0eXBlXTtcblxuICAgIGlmICghY2FsbGJhY2tzKSB7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBTbGljaW5nIHRoZSBhcmd1bWVudHMgb24gZXZlcnkgaW52b2NhdGlvbiBvZiB0aGlzIG1ldGhvZFxuICAgIC8vIGNhbiBhZGQgYSBzaWduaWZpY2FudCBhbW91bnQgb2Ygb3ZlcmhlYWQuIEF2b2lkIHRoZVxuICAgIC8vIGludGVybWVkaWF0ZSBvYmplY3QgY3JlYXRpb24gZm9yIHRoZSBjb21tb24gY2FzZSBvZiBhXG4gICAgLy8gc2luZ2xlIGNhbGxiYWNrIGFyZ3VtZW50XG5cblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gY2FsbGJhY2tzLmxlbmd0aDtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICBjYWxsYmFja3NbaV0uY2FsbCh0aGlzLCBhcmd1bWVudHNbMV0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgICB2YXIgX2xlbmd0aCA9IGNhbGxiYWNrcy5sZW5ndGg7XG5cbiAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBfbGVuZ3RoOyArK19pKSB7XG4gICAgICAgIGNhbGxiYWNrc1tfaV0uYXBwbHkodGhpcywgYXJncyk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBEZXN0cm95cyB0aGUgc3RyZWFtIGFuZCBjbGVhbnMgdXAuXG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLmRpc3Bvc2UgPSBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICAgIHRoaXMubGlzdGVuZXJzID0ge307XG4gIH1cbiAgLyoqXG4gICAqIEZvcndhcmRzIGFsbCBgZGF0YWAgZXZlbnRzIG9uIHRoaXMgc3RyZWFtIHRvIHRoZSBkZXN0aW5hdGlvbiBzdHJlYW0uIFRoZVxuICAgKiBkZXN0aW5hdGlvbiBzdHJlYW0gc2hvdWxkIHByb3ZpZGUgYSBtZXRob2QgYHB1c2hgIHRvIHJlY2VpdmUgdGhlIGRhdGFcbiAgICogZXZlbnRzIGFzIHRoZXkgYXJyaXZlLlxuICAgKlxuICAgKiBAcGFyYW0ge1N0cmVhbX0gZGVzdGluYXRpb24gdGhlIHN0cmVhbSB0aGF0IHdpbGwgcmVjZWl2ZSBhbGwgYGRhdGFgIGV2ZW50c1xuICAgKiBAc2VlIGh0dHA6Ly9ub2RlanMub3JnL2FwaS9zdHJlYW0uaHRtbCNzdHJlYW1fcmVhZGFibGVfcGlwZV9kZXN0aW5hdGlvbl9vcHRpb25zXG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLnBpcGUgPSBmdW5jdGlvbiBwaXBlKGRlc3RpbmF0aW9uKSB7XG4gICAgdGhpcy5vbignZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICBkZXN0aW5hdGlvbi5wdXNoKGRhdGEpO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBTdHJlYW07XG59KCk7XG5cbmV4cG9ydCB7IFN0cmVhbSBhcyBkZWZhdWx0IH07IiwidmFyIHdpbjtcblxuaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICB3aW4gPSB3aW5kb3c7XG59IGVsc2UgaWYgKHR5cGVvZiBnbG9iYWwgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICB3aW4gPSBnbG9iYWw7XG59IGVsc2UgaWYgKHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiKXtcbiAgICB3aW4gPSBzZWxmO1xufSBlbHNlIHtcbiAgICB3aW4gPSB7fTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB3aW47XG4iLCIvKiEgQG5hbWUgbTN1OC1wYXJzZXIgQHZlcnNpb24gNi4wLjAgQGxpY2Vuc2UgQXBhY2hlLTIuMCAqL1xuaW1wb3J0IFN0cmVhbSBmcm9tICdAdmlkZW9qcy92aHMtdXRpbHMvZXMvc3RyZWFtLmpzJztcbmltcG9ydCBfZXh0ZW5kcyBmcm9tICdAYmFiZWwvcnVudGltZS9oZWxwZXJzL2V4dGVuZHMnO1xuaW1wb3J0IGRlY29kZUI2NFRvVWludDhBcnJheSBmcm9tICdAdmlkZW9qcy92aHMtdXRpbHMvZXMvZGVjb2RlLWI2NC10by11aW50OC1hcnJheS5qcyc7XG5cbi8qKlxuICogQGZpbGUgbTN1OC9saW5lLXN0cmVhbS5qc1xuICovXG4vKipcbiAqIEEgc3RyZWFtIHRoYXQgYnVmZmVycyBzdHJpbmcgaW5wdXQgYW5kIGdlbmVyYXRlcyBhIGBkYXRhYCBldmVudCBmb3IgZWFjaFxuICogbGluZS5cbiAqXG4gKiBAY2xhc3MgTGluZVN0cmVhbVxuICogQGV4dGVuZHMgU3RyZWFtXG4gKi9cblxuY2xhc3MgTGluZVN0cmVhbSBleHRlbmRzIFN0cmVhbSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5idWZmZXIgPSAnJztcbiAgfVxuICAvKipcbiAgICogQWRkIG5ldyBkYXRhIHRvIGJlIHBhcnNlZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGEgdGhlIHRleHQgdG8gcHJvY2Vzc1xuICAgKi9cblxuXG4gIHB1c2goZGF0YSkge1xuICAgIGxldCBuZXh0TmV3bGluZTtcbiAgICB0aGlzLmJ1ZmZlciArPSBkYXRhO1xuICAgIG5leHROZXdsaW5lID0gdGhpcy5idWZmZXIuaW5kZXhPZignXFxuJyk7XG5cbiAgICBmb3IgKDsgbmV4dE5ld2xpbmUgPiAtMTsgbmV4dE5ld2xpbmUgPSB0aGlzLmJ1ZmZlci5pbmRleE9mKCdcXG4nKSkge1xuICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgdGhpcy5idWZmZXIuc3Vic3RyaW5nKDAsIG5leHROZXdsaW5lKSk7XG4gICAgICB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLnN1YnN0cmluZyhuZXh0TmV3bGluZSArIDEpO1xuICAgIH1cbiAgfVxuXG59XG5cbmNvbnN0IFRBQiA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHgwOSk7XG5cbmNvbnN0IHBhcnNlQnl0ZXJhbmdlID0gZnVuY3Rpb24gKGJ5dGVyYW5nZVN0cmluZykge1xuICAvLyBvcHRpb25hbGx5IG1hdGNoIGFuZCBjYXB0dXJlIDArIGRpZ2l0cyBiZWZvcmUgYEBgXG4gIC8vIG9wdGlvbmFsbHkgbWF0Y2ggYW5kIGNhcHR1cmUgMCsgZGlnaXRzIGFmdGVyIGBAYFxuICBjb25zdCBtYXRjaCA9IC8oWzAtOS5dKik/QD8oWzAtOS5dKik/Ly5leGVjKGJ5dGVyYW5nZVN0cmluZyB8fCAnJyk7XG4gIGNvbnN0IHJlc3VsdCA9IHt9O1xuXG4gIGlmIChtYXRjaFsxXSkge1xuICAgIHJlc3VsdC5sZW5ndGggPSBwYXJzZUludChtYXRjaFsxXSwgMTApO1xuICB9XG5cbiAgaWYgKG1hdGNoWzJdKSB7XG4gICAgcmVzdWx0Lm9mZnNldCA9IHBhcnNlSW50KG1hdGNoWzJdLCAxMCk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufTtcbi8qKlxuICogXCJmb3JnaXZpbmdcIiBhdHRyaWJ1dGUgbGlzdCBwc3VlZG8tZ3JhbW1hcjpcbiAqIGF0dHJpYnV0ZXMgLT4ga2V5dmFsdWUgKCcsJyBrZXl2YWx1ZSkqXG4gKiBrZXl2YWx1ZSAgIC0+IGtleSAnPScgdmFsdWVcbiAqIGtleSAgICAgICAgLT4gW149XSpcbiAqIHZhbHVlICAgICAgLT4gJ1wiJyBbXlwiXSogJ1wiJyB8IFteLF0qXG4gKi9cblxuXG5jb25zdCBhdHRyaWJ1dGVTZXBhcmF0b3IgPSBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGtleSA9ICdbXj1dKic7XG4gIGNvbnN0IHZhbHVlID0gJ1wiW15cIl0qXCJ8W14sXSonO1xuICBjb25zdCBrZXl2YWx1ZSA9ICcoPzonICsga2V5ICsgJyk9KD86JyArIHZhbHVlICsgJyknO1xuICByZXR1cm4gbmV3IFJlZ0V4cCgnKD86XnwsKSgnICsga2V5dmFsdWUgKyAnKScpO1xufTtcbi8qKlxuICogUGFyc2UgYXR0cmlidXRlcyBmcm9tIGEgbGluZSBnaXZlbiB0aGUgc2VwYXJhdG9yXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGF0dHJpYnV0ZXMgdGhlIGF0dHJpYnV0ZSBsaW5lIHRvIHBhcnNlXG4gKi9cblxuXG5jb25zdCBwYXJzZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAoYXR0cmlidXRlcykge1xuICBjb25zdCByZXN1bHQgPSB7fTtcblxuICBpZiAoIWF0dHJpYnV0ZXMpIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IC8vIHNwbGl0IHRoZSBzdHJpbmcgdXNpbmcgYXR0cmlidXRlcyBhcyB0aGUgc2VwYXJhdG9yXG5cblxuICBjb25zdCBhdHRycyA9IGF0dHJpYnV0ZXMuc3BsaXQoYXR0cmlidXRlU2VwYXJhdG9yKCkpO1xuICBsZXQgaSA9IGF0dHJzLmxlbmd0aDtcbiAgbGV0IGF0dHI7XG5cbiAgd2hpbGUgKGktLSkge1xuICAgIC8vIGZpbHRlciBvdXQgdW5tYXRjaGVkIHBvcnRpb25zIG9mIHRoZSBzdHJpbmdcbiAgICBpZiAoYXR0cnNbaV0gPT09ICcnKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9IC8vIHNwbGl0IHRoZSBrZXkgYW5kIHZhbHVlXG5cblxuICAgIGF0dHIgPSAvKFtePV0qKT0oLiopLy5leGVjKGF0dHJzW2ldKS5zbGljZSgxKTsgLy8gdHJpbSB3aGl0ZXNwYWNlIGFuZCByZW1vdmUgb3B0aW9uYWwgcXVvdGVzIGFyb3VuZCB0aGUgdmFsdWVcblxuICAgIGF0dHJbMF0gPSBhdHRyWzBdLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKTtcbiAgICBhdHRyWzFdID0gYXR0clsxXS5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XG4gICAgYXR0clsxXSA9IGF0dHJbMV0ucmVwbGFjZSgvXlsnXCJdKC4qKVsnXCJdJC9nLCAnJDEnKTtcbiAgICByZXN1bHRbYXR0clswXV0gPSBhdHRyWzFdO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG4vKipcbiAqIEEgbGluZS1sZXZlbCBNM1U4IHBhcnNlciBldmVudCBzdHJlYW0uIEl0IGV4cGVjdHMgdG8gcmVjZWl2ZSBpbnB1dCBvbmVcbiAqIGxpbmUgYXQgYSB0aW1lIGFuZCBwZXJmb3JtcyBhIGNvbnRleHQtZnJlZSBwYXJzZSBvZiBpdHMgY29udGVudHMuIEEgc3RyZWFtXG4gKiBpbnRlcnByZXRhdGlvbiBvZiBhIG1hbmlmZXN0IGNhbiBiZSB1c2VmdWwgaWYgdGhlIG1hbmlmZXN0IGlzIGV4cGVjdGVkIHRvXG4gKiBiZSB0b28gbGFyZ2UgdG8gZml0IGNvbWZvcnRhYmx5IGludG8gbWVtb3J5IG9yIHRoZSBlbnRpcmV0eSBvZiB0aGUgaW5wdXRcbiAqIGlzIG5vdCBpbW1lZGlhdGVseSBhdmFpbGFibGUuIE90aGVyd2lzZSwgaXQncyBwcm9iYWJseSBtdWNoIGVhc2llciB0byB3b3JrXG4gKiB3aXRoIGEgcmVndWxhciBgUGFyc2VyYCBvYmplY3QuXG4gKlxuICogUHJvZHVjZXMgYGRhdGFgIGV2ZW50cyB3aXRoIGFuIG9iamVjdCB0aGF0IGNhcHR1cmVzIHRoZSBwYXJzZXInc1xuICogaW50ZXJwcmV0YXRpb24gb2YgdGhlIGlucHV0LiBUaGF0IG9iamVjdCBoYXMgYSBwcm9wZXJ0eSBgdGFnYCB0aGF0IGlzIG9uZVxuICogb2YgYHVyaWAsIGBjb21tZW50YCwgb3IgYHRhZ2AuIFVSSXMgb25seSBoYXZlIGEgc2luZ2xlIGFkZGl0aW9uYWxcbiAqIHByb3BlcnR5LCBgbGluZWAsIHdoaWNoIGNhcHR1cmVzIHRoZSBlbnRpcmV0eSBvZiB0aGUgaW5wdXQgd2l0aG91dFxuICogaW50ZXJwcmV0YXRpb24uIENvbW1lbnRzIHNpbWlsYXJseSBoYXZlIGEgc2luZ2xlIGFkZGl0aW9uYWwgcHJvcGVydHlcbiAqIGB0ZXh0YCB3aGljaCBpcyB0aGUgaW5wdXQgd2l0aG91dCB0aGUgbGVhZGluZyBgI2AuXG4gKlxuICogVGFncyBhbHdheXMgaGF2ZSBhIHByb3BlcnR5IGB0YWdUeXBlYCB3aGljaCBpcyB0aGUgbG93ZXItY2FzZWQgdmVyc2lvbiBvZlxuICogdGhlIE0zVTggZGlyZWN0aXZlIHdpdGhvdXQgdGhlIGAjRVhUYCBvciBgI0VYVC1YLWAgcHJlZml4LiBGb3IgaW5zdGFuY2UsXG4gKiBgI0VYVC1YLU1FRElBLVNFUVVFTkNFYCBiZWNvbWVzIGBtZWRpYS1zZXF1ZW5jZWAgd2hlbiBwYXJzZWQuIFVucmVjb2duaXplZFxuICogdGFncyBhcmUgZ2l2ZW4gdGhlIHRhZyB0eXBlIGB1bmtub3duYCBhbmQgYSBzaW5nbGUgYWRkaXRpb25hbCBwcm9wZXJ0eVxuICogYGRhdGFgIHdpdGggdGhlIHJlbWFpbmRlciBvZiB0aGUgaW5wdXQuXG4gKlxuICogQGNsYXNzIFBhcnNlU3RyZWFtXG4gKiBAZXh0ZW5kcyBTdHJlYW1cbiAqL1xuXG5cbmNsYXNzIFBhcnNlU3RyZWFtIGV4dGVuZHMgU3RyZWFtIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmN1c3RvbVBhcnNlcnMgPSBbXTtcbiAgICB0aGlzLnRhZ01hcHBlcnMgPSBbXTtcbiAgfVxuICAvKipcbiAgICogUGFyc2VzIGFuIGFkZGl0aW9uYWwgbGluZSBvZiBpbnB1dC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxpbmUgYSBzaW5nbGUgbGluZSBvZiBhbiBNM1U4IGZpbGUgdG8gcGFyc2VcbiAgICovXG5cblxuICBwdXNoKGxpbmUpIHtcbiAgICBsZXQgbWF0Y2g7XG4gICAgbGV0IGV2ZW50OyAvLyBzdHJpcCB3aGl0ZXNwYWNlXG5cbiAgICBsaW5lID0gbGluZS50cmltKCk7XG5cbiAgICBpZiAobGluZS5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIGlnbm9yZSBlbXB0eSBsaW5lc1xuICAgICAgcmV0dXJuO1xuICAgIH0gLy8gVVJJc1xuXG5cbiAgICBpZiAobGluZVswXSAhPT0gJyMnKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCB7XG4gICAgICAgIHR5cGU6ICd1cmknLFxuICAgICAgICB1cmk6IGxpbmVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH0gLy8gbWFwIHRhZ3NcblxuXG4gICAgY29uc3QgbmV3TGluZXMgPSB0aGlzLnRhZ01hcHBlcnMucmVkdWNlKChhY2MsIG1hcHBlcikgPT4ge1xuICAgICAgY29uc3QgbWFwcGVkTGluZSA9IG1hcHBlcihsaW5lKTsgLy8gc2tpcCBpZiB1bmNoYW5nZWRcblxuICAgICAgaWYgKG1hcHBlZExpbmUgPT09IGxpbmUpIHtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGFjYy5jb25jYXQoW21hcHBlZExpbmVdKTtcbiAgICB9LCBbbGluZV0pO1xuICAgIG5ld0xpbmVzLmZvckVhY2gobmV3TGluZSA9PiB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY3VzdG9tUGFyc2Vycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAodGhpcy5jdXN0b21QYXJzZXJzW2ldLmNhbGwodGhpcywgbmV3TGluZSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH0gLy8gQ29tbWVudHNcblxuXG4gICAgICBpZiAobmV3TGluZS5pbmRleE9mKCcjRVhUJykgIT09IDApIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywge1xuICAgICAgICAgIHR5cGU6ICdjb21tZW50JyxcbiAgICAgICAgICB0ZXh0OiBuZXdMaW5lLnNsaWNlKDEpXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIHN0cmlwIG9mZiBhbnkgY2FycmlhZ2UgcmV0dXJucyBoZXJlIHNvIHRoZSByZWdleCBtYXRjaGluZ1xuICAgICAgLy8gZG9lc24ndCBoYXZlIHRvIGFjY291bnQgZm9yIHRoZW0uXG5cblxuICAgICAgbmV3TGluZSA9IG5ld0xpbmUucmVwbGFjZSgnXFxyJywgJycpOyAvLyBUYWdzXG5cbiAgICAgIG1hdGNoID0gL14jRVhUTTNVLy5leGVjKG5ld0xpbmUpO1xuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdtM3UnXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhUSU5GOihbMC05XFwuXSopPyw/KC4qKT8kLy5leGVjKG5ld0xpbmUpO1xuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgZXZlbnQgPSB7XG4gICAgICAgICAgdHlwZTogJ3RhZycsXG4gICAgICAgICAgdGFnVHlwZTogJ2luZidcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAobWF0Y2hbMV0pIHtcbiAgICAgICAgICBldmVudC5kdXJhdGlvbiA9IHBhcnNlRmxvYXQobWF0Y2hbMV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1hdGNoWzJdKSB7XG4gICAgICAgICAgZXZlbnQudGl0bGUgPSBtYXRjaFsyXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudHJpZ2dlcignZGF0YScsIGV2ZW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtYXRjaCA9IC9eI0VYVC1YLVRBUkdFVERVUkFUSU9OOihbMC05Ll0qKT8vLmV4ZWMobmV3TGluZSk7XG5cbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBldmVudCA9IHtcbiAgICAgICAgICB0eXBlOiAndGFnJyxcbiAgICAgICAgICB0YWdUeXBlOiAndGFyZ2V0ZHVyYXRpb24nXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKG1hdGNoWzFdKSB7XG4gICAgICAgICAgZXZlbnQuZHVyYXRpb24gPSBwYXJzZUludChtYXRjaFsxXSwgMTApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhULVgtVkVSU0lPTjooWzAtOS5dKik/Ly5leGVjKG5ld0xpbmUpO1xuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgZXZlbnQgPSB7XG4gICAgICAgICAgdHlwZTogJ3RhZycsXG4gICAgICAgICAgdGFnVHlwZTogJ3ZlcnNpb24nXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKG1hdGNoWzFdKSB7XG4gICAgICAgICAgZXZlbnQudmVyc2lvbiA9IHBhcnNlSW50KG1hdGNoWzFdLCAxMCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCBldmVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWF0Y2ggPSAvXiNFWFQtWC1NRURJQS1TRVFVRU5DRTooXFwtP1swLTkuXSopPy8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGV2ZW50ID0ge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdtZWRpYS1zZXF1ZW5jZSdcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAobWF0Y2hbMV0pIHtcbiAgICAgICAgICBldmVudC5udW1iZXIgPSBwYXJzZUludChtYXRjaFsxXSwgMTApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhULVgtRElTQ09OVElOVUlUWS1TRVFVRU5DRTooXFwtP1swLTkuXSopPy8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGV2ZW50ID0ge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdkaXNjb250aW51aXR5LXNlcXVlbmNlJ1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChtYXRjaFsxXSkge1xuICAgICAgICAgIGV2ZW50Lm51bWJlciA9IHBhcnNlSW50KG1hdGNoWzFdLCAxMCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCBldmVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWF0Y2ggPSAvXiNFWFQtWC1QTEFZTElTVC1UWVBFOiguKik/JC8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGV2ZW50ID0ge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdwbGF5bGlzdC10eXBlJ1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChtYXRjaFsxXSkge1xuICAgICAgICAgIGV2ZW50LnBsYXlsaXN0VHlwZSA9IG1hdGNoWzFdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhULVgtQllURVJBTkdFOiguKik/JC8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGV2ZW50ID0gX2V4dGVuZHMocGFyc2VCeXRlcmFuZ2UobWF0Y2hbMV0pLCB7XG4gICAgICAgICAgdHlwZTogJ3RhZycsXG4gICAgICAgICAgdGFnVHlwZTogJ2J5dGVyYW5nZSdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudHJpZ2dlcignZGF0YScsIGV2ZW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtYXRjaCA9IC9eI0VYVC1YLUFMTE9XLUNBQ0hFOihZRVN8Tk8pPy8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGV2ZW50ID0ge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdhbGxvdy1jYWNoZSdcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAobWF0Y2hbMV0pIHtcbiAgICAgICAgICBldmVudC5hbGxvd2VkID0gIS9OTy8udGVzdChtYXRjaFsxXSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCBldmVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWF0Y2ggPSAvXiNFWFQtWC1NQVA6KC4qKSQvLmV4ZWMobmV3TGluZSk7XG5cbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBldmVudCA9IHtcbiAgICAgICAgICB0eXBlOiAndGFnJyxcbiAgICAgICAgICB0YWdUeXBlOiAnbWFwJ1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChtYXRjaFsxXSkge1xuICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBwYXJzZUF0dHJpYnV0ZXMobWF0Y2hbMV0pO1xuXG4gICAgICAgICAgaWYgKGF0dHJpYnV0ZXMuVVJJKSB7XG4gICAgICAgICAgICBldmVudC51cmkgPSBhdHRyaWJ1dGVzLlVSSTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoYXR0cmlidXRlcy5CWVRFUkFOR0UpIHtcbiAgICAgICAgICAgIGV2ZW50LmJ5dGVyYW5nZSA9IHBhcnNlQnl0ZXJhbmdlKGF0dHJpYnV0ZXMuQllURVJBTkdFKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCBldmVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWF0Y2ggPSAvXiNFWFQtWC1TVFJFQU0tSU5GOiguKikkLy5leGVjKG5ld0xpbmUpO1xuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgZXZlbnQgPSB7XG4gICAgICAgICAgdHlwZTogJ3RhZycsXG4gICAgICAgICAgdGFnVHlwZTogJ3N0cmVhbS1pbmYnXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKG1hdGNoWzFdKSB7XG4gICAgICAgICAgZXZlbnQuYXR0cmlidXRlcyA9IHBhcnNlQXR0cmlidXRlcyhtYXRjaFsxXSk7XG5cbiAgICAgICAgICBpZiAoZXZlbnQuYXR0cmlidXRlcy5SRVNPTFVUSU9OKSB7XG4gICAgICAgICAgICBjb25zdCBzcGxpdCA9IGV2ZW50LmF0dHJpYnV0ZXMuUkVTT0xVVElPTi5zcGxpdCgneCcpO1xuICAgICAgICAgICAgY29uc3QgcmVzb2x1dGlvbiA9IHt9O1xuXG4gICAgICAgICAgICBpZiAoc3BsaXRbMF0pIHtcbiAgICAgICAgICAgICAgcmVzb2x1dGlvbi53aWR0aCA9IHBhcnNlSW50KHNwbGl0WzBdLCAxMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzcGxpdFsxXSkge1xuICAgICAgICAgICAgICByZXNvbHV0aW9uLmhlaWdodCA9IHBhcnNlSW50KHNwbGl0WzFdLCAxMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXMuUkVTT0xVVElPTiA9IHJlc29sdXRpb247XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGV2ZW50LmF0dHJpYnV0ZXMuQkFORFdJRFRIKSB7XG4gICAgICAgICAgICBldmVudC5hdHRyaWJ1dGVzLkJBTkRXSURUSCA9IHBhcnNlSW50KGV2ZW50LmF0dHJpYnV0ZXMuQkFORFdJRFRILCAxMCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGV2ZW50LmF0dHJpYnV0ZXNbJ0ZSQU1FLVJBVEUnXSkge1xuICAgICAgICAgICAgZXZlbnQuYXR0cmlidXRlc1snRlJBTUUtUkFURSddID0gcGFyc2VGbG9hdChldmVudC5hdHRyaWJ1dGVzWydGUkFNRS1SQVRFJ10pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChldmVudC5hdHRyaWJ1dGVzWydQUk9HUkFNLUlEJ10pIHtcbiAgICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXNbJ1BST0dSQU0tSUQnXSA9IHBhcnNlSW50KGV2ZW50LmF0dHJpYnV0ZXNbJ1BST0dSQU0tSUQnXSwgMTApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudHJpZ2dlcignZGF0YScsIGV2ZW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtYXRjaCA9IC9eI0VYVC1YLU1FRElBOiguKikkLy5leGVjKG5ld0xpbmUpO1xuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgZXZlbnQgPSB7XG4gICAgICAgICAgdHlwZTogJ3RhZycsXG4gICAgICAgICAgdGFnVHlwZTogJ21lZGlhJ1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChtYXRjaFsxXSkge1xuICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXMgPSBwYXJzZUF0dHJpYnV0ZXMobWF0Y2hbMV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhULVgtRU5ETElTVC8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcignZGF0YScsIHtcbiAgICAgICAgICB0eXBlOiAndGFnJyxcbiAgICAgICAgICB0YWdUeXBlOiAnZW5kbGlzdCdcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWF0Y2ggPSAvXiNFWFQtWC1ESVNDT05USU5VSVRZLy5leGVjKG5ld0xpbmUpO1xuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdkaXNjb250aW51aXR5J1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtYXRjaCA9IC9eI0VYVC1YLVBST0dSQU0tREFURS1USU1FOiguKikkLy5leGVjKG5ld0xpbmUpO1xuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgZXZlbnQgPSB7XG4gICAgICAgICAgdHlwZTogJ3RhZycsXG4gICAgICAgICAgdGFnVHlwZTogJ3Byb2dyYW0tZGF0ZS10aW1lJ1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChtYXRjaFsxXSkge1xuICAgICAgICAgIGV2ZW50LmRhdGVUaW1lU3RyaW5nID0gbWF0Y2hbMV07XG4gICAgICAgICAgZXZlbnQuZGF0ZVRpbWVPYmplY3QgPSBuZXcgRGF0ZShtYXRjaFsxXSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCBldmVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWF0Y2ggPSAvXiNFWFQtWC1LRVk6KC4qKSQvLmV4ZWMobmV3TGluZSk7XG5cbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBldmVudCA9IHtcbiAgICAgICAgICB0eXBlOiAndGFnJyxcbiAgICAgICAgICB0YWdUeXBlOiAna2V5J1xuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChtYXRjaFsxXSkge1xuICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXMgPSBwYXJzZUF0dHJpYnV0ZXMobWF0Y2hbMV0pOyAvLyBwYXJzZSB0aGUgSVYgc3RyaW5nIGludG8gYSBVaW50MzJBcnJheVxuXG4gICAgICAgICAgaWYgKGV2ZW50LmF0dHJpYnV0ZXMuSVYpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5hdHRyaWJ1dGVzLklWLnN1YnN0cmluZygwLCAyKS50b0xvd2VyQ2FzZSgpID09PSAnMHgnKSB7XG4gICAgICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXMuSVYgPSBldmVudC5hdHRyaWJ1dGVzLklWLnN1YnN0cmluZygyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZXZlbnQuYXR0cmlidXRlcy5JViA9IGV2ZW50LmF0dHJpYnV0ZXMuSVYubWF0Y2goLy57OH0vZyk7XG4gICAgICAgICAgICBldmVudC5hdHRyaWJ1dGVzLklWWzBdID0gcGFyc2VJbnQoZXZlbnQuYXR0cmlidXRlcy5JVlswXSwgMTYpO1xuICAgICAgICAgICAgZXZlbnQuYXR0cmlidXRlcy5JVlsxXSA9IHBhcnNlSW50KGV2ZW50LmF0dHJpYnV0ZXMuSVZbMV0sIDE2KTtcbiAgICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXMuSVZbMl0gPSBwYXJzZUludChldmVudC5hdHRyaWJ1dGVzLklWWzJdLCAxNik7XG4gICAgICAgICAgICBldmVudC5hdHRyaWJ1dGVzLklWWzNdID0gcGFyc2VJbnQoZXZlbnQuYXR0cmlidXRlcy5JVlszXSwgMTYpO1xuICAgICAgICAgICAgZXZlbnQuYXR0cmlidXRlcy5JViA9IG5ldyBVaW50MzJBcnJheShldmVudC5hdHRyaWJ1dGVzLklWKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCBldmVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWF0Y2ggPSAvXiNFWFQtWC1TVEFSVDooLiopJC8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGV2ZW50ID0ge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdzdGFydCdcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAobWF0Y2hbMV0pIHtcbiAgICAgICAgICBldmVudC5hdHRyaWJ1dGVzID0gcGFyc2VBdHRyaWJ1dGVzKG1hdGNoWzFdKTtcbiAgICAgICAgICBldmVudC5hdHRyaWJ1dGVzWydUSU1FLU9GRlNFVCddID0gcGFyc2VGbG9hdChldmVudC5hdHRyaWJ1dGVzWydUSU1FLU9GRlNFVCddKTtcbiAgICAgICAgICBldmVudC5hdHRyaWJ1dGVzLlBSRUNJU0UgPSAvWUVTLy50ZXN0KGV2ZW50LmF0dHJpYnV0ZXMuUFJFQ0lTRSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCBldmVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWF0Y2ggPSAvXiNFWFQtWC1DVUUtT1VULUNPTlQ6KC4qKT8kLy5leGVjKG5ld0xpbmUpO1xuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgZXZlbnQgPSB7XG4gICAgICAgICAgdHlwZTogJ3RhZycsXG4gICAgICAgICAgdGFnVHlwZTogJ2N1ZS1vdXQtY29udCdcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAobWF0Y2hbMV0pIHtcbiAgICAgICAgICBldmVudC5kYXRhID0gbWF0Y2hbMV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXZlbnQuZGF0YSA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhULVgtQ1VFLU9VVDooLiopPyQvLmV4ZWMobmV3TGluZSk7XG5cbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBldmVudCA9IHtcbiAgICAgICAgICB0eXBlOiAndGFnJyxcbiAgICAgICAgICB0YWdUeXBlOiAnY3VlLW91dCdcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAobWF0Y2hbMV0pIHtcbiAgICAgICAgICBldmVudC5kYXRhID0gbWF0Y2hbMV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXZlbnQuZGF0YSA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhULVgtQ1VFLUlOOiguKik/JC8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGV2ZW50ID0ge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdjdWUtaW4nXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKG1hdGNoWzFdKSB7XG4gICAgICAgICAgZXZlbnQuZGF0YSA9IG1hdGNoWzFdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGV2ZW50LmRhdGEgPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudHJpZ2dlcignZGF0YScsIGV2ZW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtYXRjaCA9IC9eI0VYVC1YLVNLSVA6KC4qKSQvLmV4ZWMobmV3TGluZSk7XG5cbiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSkge1xuICAgICAgICBldmVudCA9IHtcbiAgICAgICAgICB0eXBlOiAndGFnJyxcbiAgICAgICAgICB0YWdUeXBlOiAnc2tpcCdcbiAgICAgICAgfTtcbiAgICAgICAgZXZlbnQuYXR0cmlidXRlcyA9IHBhcnNlQXR0cmlidXRlcyhtYXRjaFsxXSk7XG5cbiAgICAgICAgaWYgKGV2ZW50LmF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkoJ1NLSVBQRUQtU0VHTUVOVFMnKSkge1xuICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXNbJ1NLSVBQRUQtU0VHTUVOVFMnXSA9IHBhcnNlSW50KGV2ZW50LmF0dHJpYnV0ZXNbJ1NLSVBQRUQtU0VHTUVOVFMnXSwgMTApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV2ZW50LmF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkoJ1JFQ0VOVExZLVJFTU9WRUQtREFURVJBTkdFUycpKSB7XG4gICAgICAgICAgZXZlbnQuYXR0cmlidXRlc1snUkVDRU5UTFktUkVNT1ZFRC1EQVRFUkFOR0VTJ10gPSBldmVudC5hdHRyaWJ1dGVzWydSRUNFTlRMWS1SRU1PVkVELURBVEVSQU5HRVMnXS5zcGxpdChUQUIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhULVgtUEFSVDooLiopJC8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XG4gICAgICAgIGV2ZW50ID0ge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdwYXJ0J1xuICAgICAgICB9O1xuICAgICAgICBldmVudC5hdHRyaWJ1dGVzID0gcGFyc2VBdHRyaWJ1dGVzKG1hdGNoWzFdKTtcbiAgICAgICAgWydEVVJBVElPTiddLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgIGlmIChldmVudC5hdHRyaWJ1dGVzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXNba2V5XSA9IHBhcnNlRmxvYXQoZXZlbnQuYXR0cmlidXRlc1trZXldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBbJ0lOREVQRU5ERU5UJywgJ0dBUCddLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgIGlmIChldmVudC5hdHRyaWJ1dGVzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXNba2V5XSA9IC9ZRVMvLnRlc3QoZXZlbnQuYXR0cmlidXRlc1trZXldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChldmVudC5hdHRyaWJ1dGVzLmhhc093blByb3BlcnR5KCdCWVRFUkFOR0UnKSkge1xuICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXMuYnl0ZXJhbmdlID0gcGFyc2VCeXRlcmFuZ2UoZXZlbnQuYXR0cmlidXRlcy5CWVRFUkFOR0UpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhULVgtU0VSVkVSLUNPTlRST0w6KC4qKSQvLmV4ZWMobmV3TGluZSk7XG5cbiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSkge1xuICAgICAgICBldmVudCA9IHtcbiAgICAgICAgICB0eXBlOiAndGFnJyxcbiAgICAgICAgICB0YWdUeXBlOiAnc2VydmVyLWNvbnRyb2wnXG4gICAgICAgIH07XG4gICAgICAgIGV2ZW50LmF0dHJpYnV0ZXMgPSBwYXJzZUF0dHJpYnV0ZXMobWF0Y2hbMV0pO1xuICAgICAgICBbJ0NBTi1TS0lQLVVOVElMJywgJ1BBUlQtSE9MRC1CQUNLJywgJ0hPTEQtQkFDSyddLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgIGlmIChldmVudC5hdHRyaWJ1dGVzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXNba2V5XSA9IHBhcnNlRmxvYXQoZXZlbnQuYXR0cmlidXRlc1trZXldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBbJ0NBTi1TS0lQLURBVEVSQU5HRVMnLCAnQ0FOLUJMT0NLLVJFTE9BRCddLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgIGlmIChldmVudC5hdHRyaWJ1dGVzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXNba2V5XSA9IC9ZRVMvLnRlc3QoZXZlbnQuYXR0cmlidXRlc1trZXldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCBldmVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWF0Y2ggPSAvXiNFWFQtWC1QQVJULUlORjooLiopJC8uZXhlYyhuZXdMaW5lKTtcblxuICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XG4gICAgICAgIGV2ZW50ID0ge1xuICAgICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICAgIHRhZ1R5cGU6ICdwYXJ0LWluZidcbiAgICAgICAgfTtcbiAgICAgICAgZXZlbnQuYXR0cmlidXRlcyA9IHBhcnNlQXR0cmlidXRlcyhtYXRjaFsxXSk7XG4gICAgICAgIFsnUEFSVC1UQVJHRVQnXS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICBpZiAoZXZlbnQuYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICBldmVudC5hdHRyaWJ1dGVzW2tleV0gPSBwYXJzZUZsb2F0KGV2ZW50LmF0dHJpYnV0ZXNba2V5XSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG1hdGNoID0gL14jRVhULVgtUFJFTE9BRC1ISU5UOiguKikkLy5leGVjKG5ld0xpbmUpO1xuXG4gICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcbiAgICAgICAgZXZlbnQgPSB7XG4gICAgICAgICAgdHlwZTogJ3RhZycsXG4gICAgICAgICAgdGFnVHlwZTogJ3ByZWxvYWQtaGludCdcbiAgICAgICAgfTtcbiAgICAgICAgZXZlbnQuYXR0cmlidXRlcyA9IHBhcnNlQXR0cmlidXRlcyhtYXRjaFsxXSk7XG4gICAgICAgIFsnQllURVJBTkdFLVNUQVJUJywgJ0JZVEVSQU5HRS1MRU5HVEgnXS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICBpZiAoZXZlbnQuYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICBldmVudC5hdHRyaWJ1dGVzW2tleV0gPSBwYXJzZUludChldmVudC5hdHRyaWJ1dGVzW2tleV0sIDEwKTtcbiAgICAgICAgICAgIGNvbnN0IHN1YmtleSA9IGtleSA9PT0gJ0JZVEVSQU5HRS1MRU5HVEgnID8gJ2xlbmd0aCcgOiAnb2Zmc2V0JztcbiAgICAgICAgICAgIGV2ZW50LmF0dHJpYnV0ZXMuYnl0ZXJhbmdlID0gZXZlbnQuYXR0cmlidXRlcy5ieXRlcmFuZ2UgfHwge307XG4gICAgICAgICAgICBldmVudC5hdHRyaWJ1dGVzLmJ5dGVyYW5nZVtzdWJrZXldID0gZXZlbnQuYXR0cmlidXRlc1trZXldOyAvLyBvbmx5IGtlZXAgdGhlIHBhcnNlZCBieXRlcmFuZ2Ugb2JqZWN0LlxuXG4gICAgICAgICAgICBkZWxldGUgZXZlbnQuYXR0cmlidXRlc1trZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudHJpZ2dlcignZGF0YScsIGV2ZW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtYXRjaCA9IC9eI0VYVC1YLVJFTkRJVElPTi1SRVBPUlQ6KC4qKSQvLmV4ZWMobmV3TGluZSk7XG5cbiAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSkge1xuICAgICAgICBldmVudCA9IHtcbiAgICAgICAgICB0eXBlOiAndGFnJyxcbiAgICAgICAgICB0YWdUeXBlOiAncmVuZGl0aW9uLXJlcG9ydCdcbiAgICAgICAgfTtcbiAgICAgICAgZXZlbnQuYXR0cmlidXRlcyA9IHBhcnNlQXR0cmlidXRlcyhtYXRjaFsxXSk7XG4gICAgICAgIFsnTEFTVC1NU04nLCAnTEFTVC1QQVJUJ10uZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgaWYgKGV2ZW50LmF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgZXZlbnQuYXR0cmlidXRlc1trZXldID0gcGFyc2VJbnQoZXZlbnQuYXR0cmlidXRlc1trZXldLCAxMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywgZXZlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIHVua25vd24gdGFnIHR5cGVcblxuXG4gICAgICB0aGlzLnRyaWdnZXIoJ2RhdGEnLCB7XG4gICAgICAgIHR5cGU6ICd0YWcnLFxuICAgICAgICBkYXRhOiBuZXdMaW5lLnNsaWNlKDQpXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICogQWRkIGEgcGFyc2VyIGZvciBjdXN0b20gaGVhZGVyc1xuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gICBvcHRpb25zICAgICAgICAgICAgICBhIG1hcCBvZiBvcHRpb25zIGZvciB0aGUgYWRkZWQgcGFyc2VyXG4gICAqIEBwYXJhbSB7UmVnRXhwfSAgIG9wdGlvbnMuZXhwcmVzc2lvbiAgIGEgcmVndWxhciBleHByZXNzaW9uIHRvIG1hdGNoIHRoZSBjdXN0b20gaGVhZGVyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSAgIG9wdGlvbnMuY3VzdG9tVHlwZSAgIHRoZSBjdXN0b20gdHlwZSB0byByZWdpc3RlciB0byB0aGUgb3V0cHV0XG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtvcHRpb25zLmRhdGFQYXJzZXJdIGZ1bmN0aW9uIHRvIHBhcnNlIHRoZSBsaW5lIGludG8gYW4gb2JqZWN0XG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gIFtvcHRpb25zLnNlZ21lbnRdICAgIHNob3VsZCB0YWcgZGF0YSBiZSBhdHRhY2hlZCB0byB0aGUgc2VnbWVudCBvYmplY3RcbiAgICovXG5cblxuICBhZGRQYXJzZXIoe1xuICAgIGV4cHJlc3Npb24sXG4gICAgY3VzdG9tVHlwZSxcbiAgICBkYXRhUGFyc2VyLFxuICAgIHNlZ21lbnRcbiAgfSkge1xuICAgIGlmICh0eXBlb2YgZGF0YVBhcnNlciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgZGF0YVBhcnNlciA9IGxpbmUgPT4gbGluZTtcbiAgICB9XG5cbiAgICB0aGlzLmN1c3RvbVBhcnNlcnMucHVzaChsaW5lID0+IHtcbiAgICAgIGNvbnN0IG1hdGNoID0gZXhwcmVzc2lvbi5leGVjKGxpbmUpO1xuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdkYXRhJywge1xuICAgICAgICAgIHR5cGU6ICdjdXN0b20nLFxuICAgICAgICAgIGRhdGE6IGRhdGFQYXJzZXIobGluZSksXG4gICAgICAgICAgY3VzdG9tVHlwZSxcbiAgICAgICAgICBzZWdtZW50XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICogQWRkIGEgY3VzdG9tIGhlYWRlciBtYXBwZXJcbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9ICAgb3B0aW9uc1xuICAgKiBAcGFyYW0ge1JlZ0V4cH0gICBvcHRpb25zLmV4cHJlc3Npb24gICBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBtYXRjaCB0aGUgY3VzdG9tIGhlYWRlclxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvcHRpb25zLm1hcCAgICAgICAgICBmdW5jdGlvbiB0byB0cmFuc2xhdGUgdGFnIGludG8gYSBkaWZmZXJlbnQgdGFnXG4gICAqL1xuXG5cbiAgYWRkVGFnTWFwcGVyKHtcbiAgICBleHByZXNzaW9uLFxuICAgIG1hcFxuICB9KSB7XG4gICAgY29uc3QgbWFwRm4gPSBsaW5lID0+IHtcbiAgICAgIGlmIChleHByZXNzaW9uLnRlc3QobGluZSkpIHtcbiAgICAgICAgcmV0dXJuIG1hcChsaW5lKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGxpbmU7XG4gICAgfTtcblxuICAgIHRoaXMudGFnTWFwcGVycy5wdXNoKG1hcEZuKTtcbiAgfVxuXG59XG5cbmNvbnN0IGNhbWVsQ2FzZSA9IHN0ciA9PiBzdHIudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC8tKFxcdykvZywgYSA9PiBhWzFdLnRvVXBwZXJDYXNlKCkpO1xuXG5jb25zdCBjYW1lbENhc2VLZXlzID0gZnVuY3Rpb24gKGF0dHJpYnV0ZXMpIHtcbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgIHJlc3VsdFtjYW1lbENhc2Uoa2V5KV0gPSBhdHRyaWJ1dGVzW2tleV07XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0O1xufTsgLy8gc2V0IFNFUlZFUi1DT05UUk9MIGhvbGQgYmFjayBiYXNlZCB1cG9uIHRhcmdldER1cmF0aW9uIGFuZCBwYXJ0VGFyZ2V0RHVyYXRpb25cbi8vIHdlIG5lZWQgdGhpcyBoZWxwZXIgYmVjYXVzZSBkZWZhdWx0cyBhcmUgYmFzZWQgdXBvbiB0YXJnZXREdXJhdGlvbiBhbmRcbi8vIHBhcnRUYXJnZXREdXJhdGlvbiBiZWluZyBzZXQsIGJ1dCB0aGV5IG1heSBub3QgYmUgaWYgU0VSVkVSLUNPTlRST0wgYXBwZWFycyBiZWZvcmVcbi8vIHRhcmdldCBkdXJhdGlvbnMgYXJlIHNldC5cblxuXG5jb25zdCBzZXRIb2xkQmFjayA9IGZ1bmN0aW9uIChtYW5pZmVzdCkge1xuICBjb25zdCB7XG4gICAgc2VydmVyQ29udHJvbCxcbiAgICB0YXJnZXREdXJhdGlvbixcbiAgICBwYXJ0VGFyZ2V0RHVyYXRpb25cbiAgfSA9IG1hbmlmZXN0O1xuXG4gIGlmICghc2VydmVyQ29udHJvbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHRhZyA9ICcjRVhULVgtU0VSVkVSLUNPTlRST0wnO1xuICBjb25zdCBoYiA9ICdob2xkQmFjayc7XG4gIGNvbnN0IHBoYiA9ICdwYXJ0SG9sZEJhY2snO1xuICBjb25zdCBtaW5UYXJnZXREdXJhdGlvbiA9IHRhcmdldER1cmF0aW9uICYmIHRhcmdldER1cmF0aW9uICogMztcbiAgY29uc3QgbWluUGFydER1cmF0aW9uID0gcGFydFRhcmdldER1cmF0aW9uICYmIHBhcnRUYXJnZXREdXJhdGlvbiAqIDI7XG5cbiAgaWYgKHRhcmdldER1cmF0aW9uICYmICFzZXJ2ZXJDb250cm9sLmhhc093blByb3BlcnR5KGhiKSkge1xuICAgIHNlcnZlckNvbnRyb2xbaGJdID0gbWluVGFyZ2V0RHVyYXRpb247XG4gICAgdGhpcy50cmlnZ2VyKCdpbmZvJywge1xuICAgICAgbWVzc2FnZTogYCR7dGFnfSBkZWZhdWx0aW5nIEhPTEQtQkFDSyB0byB0YXJnZXREdXJhdGlvbiAqIDMgKCR7bWluVGFyZ2V0RHVyYXRpb259KS5gXG4gICAgfSk7XG4gIH1cblxuICBpZiAobWluVGFyZ2V0RHVyYXRpb24gJiYgc2VydmVyQ29udHJvbFtoYl0gPCBtaW5UYXJnZXREdXJhdGlvbikge1xuICAgIHRoaXMudHJpZ2dlcignd2FybicsIHtcbiAgICAgIG1lc3NhZ2U6IGAke3RhZ30gY2xhbXBpbmcgSE9MRC1CQUNLICgke3NlcnZlckNvbnRyb2xbaGJdfSkgdG8gdGFyZ2V0RHVyYXRpb24gKiAzICgke21pblRhcmdldER1cmF0aW9ufSlgXG4gICAgfSk7XG4gICAgc2VydmVyQ29udHJvbFtoYl0gPSBtaW5UYXJnZXREdXJhdGlvbjtcbiAgfSAvLyBkZWZhdWx0IG5vIHBhcnQgaG9sZCBiYWNrIHRvIHBhcnQgdGFyZ2V0IGR1cmF0aW9uICogM1xuXG5cbiAgaWYgKHBhcnRUYXJnZXREdXJhdGlvbiAmJiAhc2VydmVyQ29udHJvbC5oYXNPd25Qcm9wZXJ0eShwaGIpKSB7XG4gICAgc2VydmVyQ29udHJvbFtwaGJdID0gcGFydFRhcmdldER1cmF0aW9uICogMztcbiAgICB0aGlzLnRyaWdnZXIoJ2luZm8nLCB7XG4gICAgICBtZXNzYWdlOiBgJHt0YWd9IGRlZmF1bHRpbmcgUEFSVC1IT0xELUJBQ0sgdG8gcGFydFRhcmdldER1cmF0aW9uICogMyAoJHtzZXJ2ZXJDb250cm9sW3BoYl19KS5gXG4gICAgfSk7XG4gIH0gLy8gaWYgcGFydCBob2xkIGJhY2sgaXMgdG9vIHNtYWxsIGRlZmF1bHQgaXQgdG8gcGFydCB0YXJnZXQgZHVyYXRpb24gKiAyXG5cblxuICBpZiAocGFydFRhcmdldER1cmF0aW9uICYmIHNlcnZlckNvbnRyb2xbcGhiXSA8IG1pblBhcnREdXJhdGlvbikge1xuICAgIHRoaXMudHJpZ2dlcignd2FybicsIHtcbiAgICAgIG1lc3NhZ2U6IGAke3RhZ30gY2xhbXBpbmcgUEFSVC1IT0xELUJBQ0sgKCR7c2VydmVyQ29udHJvbFtwaGJdfSkgdG8gcGFydFRhcmdldER1cmF0aW9uICogMiAoJHttaW5QYXJ0RHVyYXRpb259KS5gXG4gICAgfSk7XG4gICAgc2VydmVyQ29udHJvbFtwaGJdID0gbWluUGFydER1cmF0aW9uO1xuICB9XG59O1xuLyoqXG4gKiBBIHBhcnNlciBmb3IgTTNVOCBmaWxlcy4gVGhlIGN1cnJlbnQgaW50ZXJwcmV0YXRpb24gb2YgdGhlIGlucHV0IGlzXG4gKiBleHBvc2VkIGFzIGEgcHJvcGVydHkgYG1hbmlmZXN0YCBvbiBwYXJzZXIgb2JqZWN0cy4gSXQncyBqdXN0IHR3byBsaW5lcyB0b1xuICogY3JlYXRlIGFuZCBwYXJzZSBhIG1hbmlmZXN0IG9uY2UgeW91IGhhdmUgdGhlIGNvbnRlbnRzIGF2YWlsYWJsZSBhcyBhIHN0cmluZzpcbiAqXG4gKiBgYGBqc1xuICogdmFyIHBhcnNlciA9IG5ldyBtM3U4LlBhcnNlcigpO1xuICogcGFyc2VyLnB1c2goeGhyLnJlc3BvbnNlVGV4dCk7XG4gKiBgYGBcbiAqXG4gKiBOZXcgaW5wdXQgY2FuIGxhdGVyIGJlIGFwcGxpZWQgdG8gdXBkYXRlIHRoZSBtYW5pZmVzdCBvYmplY3QgYnkgY2FsbGluZ1xuICogYHB1c2hgIGFnYWluLlxuICpcbiAqIFRoZSBwYXJzZXIgYXR0ZW1wdHMgdG8gY3JlYXRlIGEgdXNhYmxlIG1hbmlmZXN0IG9iamVjdCBldmVuIGlmIHRoZVxuICogdW5kZXJseWluZyBpbnB1dCBpcyBzb21ld2hhdCBub25zZW5zaWNhbC4gSXQgZW1pdHMgYGluZm9gIGFuZCBgd2FybmluZ2BcbiAqIGV2ZW50cyBkdXJpbmcgdGhlIHBhcnNlIGlmIGl0IGVuY291bnRlcnMgaW5wdXQgdGhhdCBzZWVtcyBpbnZhbGlkIG9yXG4gKiByZXF1aXJlcyBzb21lIHByb3BlcnR5IG9mIHRoZSBtYW5pZmVzdCBvYmplY3QgdG8gYmUgZGVmYXVsdGVkLlxuICpcbiAqIEBjbGFzcyBQYXJzZXJcbiAqIEBleHRlbmRzIFN0cmVhbVxuICovXG5cblxuY2xhc3MgUGFyc2VyIGV4dGVuZHMgU3RyZWFtIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmxpbmVTdHJlYW0gPSBuZXcgTGluZVN0cmVhbSgpO1xuICAgIHRoaXMucGFyc2VTdHJlYW0gPSBuZXcgUGFyc2VTdHJlYW0oKTtcbiAgICB0aGlzLmxpbmVTdHJlYW0ucGlwZSh0aGlzLnBhcnNlU3RyZWFtKTtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBjb25zaXN0ZW50LXRoaXMgKi9cblxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIC8qIGVzbGludC1lbmFibGUgY29uc2lzdGVudC10aGlzICovXG5cbiAgICBjb25zdCB1cmlzID0gW107XG4gICAgbGV0IGN1cnJlbnRVcmkgPSB7fTsgLy8gaWYgc3BlY2lmaWVkLCB0aGUgYWN0aXZlIEVYVC1YLU1BUCBkZWZpbml0aW9uXG5cbiAgICBsZXQgY3VycmVudE1hcDsgLy8gaWYgc3BlY2lmaWVkLCB0aGUgYWN0aXZlIGRlY3J5cHRpb24ga2V5XG5cbiAgICBsZXQga2V5O1xuICAgIGxldCBoYXNQYXJ0cyA9IGZhbHNlO1xuXG4gICAgY29uc3Qgbm9vcCA9IGZ1bmN0aW9uICgpIHt9O1xuXG4gICAgY29uc3QgZGVmYXVsdE1lZGlhR3JvdXBzID0ge1xuICAgICAgJ0FVRElPJzoge30sXG4gICAgICAnVklERU8nOiB7fSxcbiAgICAgICdDTE9TRUQtQ0FQVElPTlMnOiB7fSxcbiAgICAgICdTVUJUSVRMRVMnOiB7fVxuICAgIH07IC8vIFRoaXMgaXMgdGhlIFdpZGV2aW5lIFVVSUQgZnJvbSBEQVNIIElGIElPUC4gVGhlIHNhbWUgZXhhY3Qgc3RyaW5nIGlzXG4gICAgLy8gdXNlZCBpbiBNUERzIHdpdGggV2lkZXZpbmUgZW5jcnlwdGVkIHN0cmVhbXMuXG5cbiAgICBjb25zdCB3aWRldmluZVV1aWQgPSAndXJuOnV1aWQ6ZWRlZjhiYTktNzlkNi00YWNlLWEzYzgtMjdkY2Q1MWQyMWVkJzsgLy8gZ3JvdXAgc2VnbWVudHMgaW50byBudW1iZXJlZCB0aW1lbGluZXMgZGVsaW5lYXRlZCBieSBkaXNjb250aW51aXRpZXNcblxuICAgIGxldCBjdXJyZW50VGltZWxpbmUgPSAwOyAvLyB0aGUgbWFuaWZlc3QgaXMgZW1wdHkgdW50aWwgdGhlIHBhcnNlIHN0cmVhbSBiZWdpbnMgZGVsaXZlcmluZyBkYXRhXG5cbiAgICB0aGlzLm1hbmlmZXN0ID0ge1xuICAgICAgYWxsb3dDYWNoZTogdHJ1ZSxcbiAgICAgIGRpc2NvbnRpbnVpdHlTdGFydHM6IFtdLFxuICAgICAgc2VnbWVudHM6IFtdXG4gICAgfTsgLy8ga2VlcCB0cmFjayBvZiB0aGUgbGFzdCBzZWVuIHNlZ21lbnQncyBieXRlIHJhbmdlIGVuZCwgYXMgc2VnbWVudHMgYXJlIG5vdCByZXF1aXJlZFxuICAgIC8vIHRvIHByb3ZpZGUgdGhlIG9mZnNldCwgaW4gd2hpY2ggY2FzZSBpdCBkZWZhdWx0cyB0byB0aGUgbmV4dCBieXRlIGFmdGVyIHRoZVxuICAgIC8vIHByZXZpb3VzIHNlZ21lbnRcblxuICAgIGxldCBsYXN0Qnl0ZXJhbmdlRW5kID0gMDsgLy8ga2VlcCB0cmFjayBvZiB0aGUgbGFzdCBzZWVuIHBhcnQncyBieXRlIHJhbmdlIGVuZC5cblxuICAgIGxldCBsYXN0UGFydEJ5dGVyYW5nZUVuZCA9IDA7XG4gICAgdGhpcy5vbignZW5kJywgKCkgPT4ge1xuICAgICAgLy8gb25seSBhZGQgcHJlbG9hZFNlZ21lbnQgaWYgd2UgZG9uJ3QgeWV0IGhhdmUgYSB1cmkgZm9yIGl0LlxuICAgICAgLy8gYW5kIHdlIGFjdHVhbGx5IGhhdmUgcGFydHMvcHJlbG9hZEhpbnRzXG4gICAgICBpZiAoY3VycmVudFVyaS51cmkgfHwgIWN1cnJlbnRVcmkucGFydHMgJiYgIWN1cnJlbnRVcmkucHJlbG9hZEhpbnRzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFjdXJyZW50VXJpLm1hcCAmJiBjdXJyZW50TWFwKSB7XG4gICAgICAgIGN1cnJlbnRVcmkubWFwID0gY3VycmVudE1hcDtcbiAgICAgIH1cblxuICAgICAgaWYgKCFjdXJyZW50VXJpLmtleSAmJiBrZXkpIHtcbiAgICAgICAgY3VycmVudFVyaS5rZXkgPSBrZXk7XG4gICAgICB9XG5cbiAgICAgIGlmICghY3VycmVudFVyaS50aW1lbGluZSAmJiB0eXBlb2YgY3VycmVudFRpbWVsaW5lID09PSAnbnVtYmVyJykge1xuICAgICAgICBjdXJyZW50VXJpLnRpbWVsaW5lID0gY3VycmVudFRpbWVsaW5lO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm1hbmlmZXN0LnByZWxvYWRTZWdtZW50ID0gY3VycmVudFVyaTtcbiAgICB9KTsgLy8gdXBkYXRlIHRoZSBtYW5pZmVzdCB3aXRoIHRoZSBtM3U4IGVudHJ5IGZyb20gdGhlIHBhcnNlIHN0cmVhbVxuXG4gICAgdGhpcy5wYXJzZVN0cmVhbS5vbignZGF0YScsIGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgbGV0IG1lZGlhR3JvdXA7XG4gICAgICBsZXQgcmVuZGl0aW9uO1xuICAgICAgKHtcbiAgICAgICAgdGFnKCkge1xuICAgICAgICAgIC8vIHN3aXRjaCBiYXNlZCBvbiB0aGUgdGFnIHR5cGVcbiAgICAgICAgICAoKHtcbiAgICAgICAgICAgIHZlcnNpb24oKSB7XG4gICAgICAgICAgICAgIGlmIChlbnRyeS52ZXJzaW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC52ZXJzaW9uID0gZW50cnkudmVyc2lvbjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ2FsbG93LWNhY2hlJygpIHtcbiAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC5hbGxvd0NhY2hlID0gZW50cnkuYWxsb3dlZDtcblxuICAgICAgICAgICAgICBpZiAoISgnYWxsb3dlZCcgaW4gZW50cnkpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdpbmZvJywge1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2RlZmF1bHRpbmcgYWxsb3dDYWNoZSB0byBZRVMnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC5hbGxvd0NhY2hlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgYnl0ZXJhbmdlKCkge1xuICAgICAgICAgICAgICBjb25zdCBieXRlcmFuZ2UgPSB7fTtcblxuICAgICAgICAgICAgICBpZiAoJ2xlbmd0aCcgaW4gZW50cnkpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50VXJpLmJ5dGVyYW5nZSA9IGJ5dGVyYW5nZTtcbiAgICAgICAgICAgICAgICBieXRlcmFuZ2UubGVuZ3RoID0gZW50cnkubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgaWYgKCEoJ29mZnNldCcgaW4gZW50cnkpKSB7XG4gICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICogRnJvbSB0aGUgbGF0ZXN0IHNwZWMgKGFzIG9mIHRoaXMgd3JpdGluZyk6XG4gICAgICAgICAgICAgICAgICAgKiBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvZHJhZnQtcGFudG9zLWh0dHAtbGl2ZS1zdHJlYW1pbmctMjMjc2VjdGlvbi00LjMuMi4yXG4gICAgICAgICAgICAgICAgICAgKlxuICAgICAgICAgICAgICAgICAgICogU2FtZSB0ZXh0IHNpbmNlIEVYVC1YLUJZVEVSQU5HRSdzIGludHJvZHVjdGlvbiBpbiBkcmFmdCA3OlxuICAgICAgICAgICAgICAgICAgICogaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL2RyYWZ0LXBhbnRvcy1odHRwLWxpdmUtc3RyZWFtaW5nLTA3I3NlY3Rpb24tMy4zLjEpXG4gICAgICAgICAgICAgICAgICAgKlxuICAgICAgICAgICAgICAgICAgICogXCJJZiBvIFtvZmZzZXRdIGlzIG5vdCBwcmVzZW50LCB0aGUgc3ViLXJhbmdlIGJlZ2lucyBhdCB0aGUgbmV4dCBieXRlXG4gICAgICAgICAgICAgICAgICAgKiBmb2xsb3dpbmcgdGhlIHN1Yi1yYW5nZSBvZiB0aGUgcHJldmlvdXMgbWVkaWEgc2VnbWVudC5cIlxuICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICBlbnRyeS5vZmZzZXQgPSBsYXN0Qnl0ZXJhbmdlRW5kO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmICgnb2Zmc2V0JyBpbiBlbnRyeSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRVcmkuYnl0ZXJhbmdlID0gYnl0ZXJhbmdlO1xuICAgICAgICAgICAgICAgIGJ5dGVyYW5nZS5vZmZzZXQgPSBlbnRyeS5vZmZzZXQ7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBsYXN0Qnl0ZXJhbmdlRW5kID0gYnl0ZXJhbmdlLm9mZnNldCArIGJ5dGVyYW5nZS5sZW5ndGg7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBlbmRsaXN0KCkge1xuICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0LmVuZExpc3QgPSB0cnVlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaW5mKCkge1xuICAgICAgICAgICAgICBpZiAoISgnbWVkaWFTZXF1ZW5jZScgaW4gdGhpcy5tYW5pZmVzdCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0Lm1lZGlhU2VxdWVuY2UgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignaW5mbycsIHtcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdkZWZhdWx0aW5nIG1lZGlhIHNlcXVlbmNlIHRvIHplcm8nXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoISgnZGlzY29udGludWl0eVNlcXVlbmNlJyBpbiB0aGlzLm1hbmlmZXN0KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QuZGlzY29udGludWl0eVNlcXVlbmNlID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2luZm8nLCB7XG4gICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnZGVmYXVsdGluZyBkaXNjb250aW51aXR5IHNlcXVlbmNlIHRvIHplcm8nXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoZW50cnkuZHVyYXRpb24gPiAwKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFVyaS5kdXJhdGlvbiA9IGVudHJ5LmR1cmF0aW9uO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGVudHJ5LmR1cmF0aW9uID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFVyaS5kdXJhdGlvbiA9IDAuMDE7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdpbmZvJywge1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3VwZGF0aW5nIHplcm8gc2VnbWVudCBkdXJhdGlvbiB0byBhIHNtYWxsIHZhbHVlJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC5zZWdtZW50cyA9IHVyaXM7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBrZXkoKSB7XG4gICAgICAgICAgICAgIGlmICghZW50cnkuYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignd2FybicsIHtcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdpZ25vcmluZyBrZXkgZGVjbGFyYXRpb24gd2l0aG91dCBhdHRyaWJ1dGUgbGlzdCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH0gLy8gY2xlYXIgdGhlIGFjdGl2ZSBlbmNyeXB0aW9uIGtleVxuXG5cbiAgICAgICAgICAgICAgaWYgKGVudHJ5LmF0dHJpYnV0ZXMuTUVUSE9EID09PSAnTk9ORScpIHtcbiAgICAgICAgICAgICAgICBrZXkgPSBudWxsO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmICghZW50cnkuYXR0cmlidXRlcy5VUkkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3dhcm4nLCB7XG4gICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnaWdub3Jpbmcga2V5IGRlY2xhcmF0aW9uIHdpdGhvdXQgVVJJJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChlbnRyeS5hdHRyaWJ1dGVzLktFWUZPUk1BVCA9PT0gJ2NvbS5hcHBsZS5zdHJlYW1pbmdrZXlkZWxpdmVyeScpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0LmNvbnRlbnRQcm90ZWN0aW9uID0gdGhpcy5tYW5pZmVzdC5jb250ZW50UHJvdGVjdGlvbiB8fCB7fTsgLy8gVE9ETzogYWRkIGZ1bGwgc3VwcG9ydCBmb3IgdGhpcy5cblxuICAgICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QuY29udGVudFByb3RlY3Rpb25bJ2NvbS5hcHBsZS5mcHMuMV8wJ10gPSB7XG4gICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiBlbnRyeS5hdHRyaWJ1dGVzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoZW50cnkuYXR0cmlidXRlcy5LRVlGT1JNQVQgPT09ICdjb20ubWljcm9zb2Z0LnBsYXlyZWFkeScpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0LmNvbnRlbnRQcm90ZWN0aW9uID0gdGhpcy5tYW5pZmVzdC5jb250ZW50UHJvdGVjdGlvbiB8fCB7fTsgLy8gVE9ETzogYWRkIGZ1bGwgc3VwcG9ydCBmb3IgdGhpcy5cblxuICAgICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QuY29udGVudFByb3RlY3Rpb25bJ2NvbS5taWNyb3NvZnQucGxheXJlYWR5J10gPSB7XG4gICAgICAgICAgICAgICAgICB1cmk6IGVudHJ5LmF0dHJpYnV0ZXMuVVJJXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH0gLy8gY2hlY2sgaWYgdGhlIGNvbnRlbnQgaXMgZW5jcnlwdGVkIGZvciBXaWRldmluZVxuICAgICAgICAgICAgICAvLyBXaWRldmluZS9ITFMgc3BlYzogaHR0cHM6Ly9zdG9yYWdlLmdvb2dsZWFwaXMuY29tL3d2ZG9jcy9XaWRldmluZV9EUk1fSExTLnBkZlxuXG5cbiAgICAgICAgICAgICAgaWYgKGVudHJ5LmF0dHJpYnV0ZXMuS0VZRk9STUFUID09PSB3aWRldmluZVV1aWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBWQUxJRF9NRVRIT0RTID0gWydTQU1QTEUtQUVTJywgJ1NBTVBMRS1BRVMtQ1RSJywgJ1NBTVBMRS1BRVMtQ0VOQyddO1xuXG4gICAgICAgICAgICAgICAgaWYgKFZBTElEX01FVEhPRFMuaW5kZXhPZihlbnRyeS5hdHRyaWJ1dGVzLk1FVEhPRCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3dhcm4nLCB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdpbnZhbGlkIGtleSBtZXRob2QgcHJvdmlkZWQgZm9yIFdpZGV2aW5lJ1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGVudHJ5LmF0dHJpYnV0ZXMuTUVUSE9EID09PSAnU0FNUExFLUFFUy1DRU5DJykge1xuICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCd3YXJuJywge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU0FNUExFLUFFUy1DRU5DIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgU0FNUExFLUFFUy1DVFIgaW5zdGVhZCdcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChlbnRyeS5hdHRyaWJ1dGVzLlVSSS5zdWJzdHJpbmcoMCwgMjMpICE9PSAnZGF0YTp0ZXh0L3BsYWluO2Jhc2U2NCwnKSB7XG4gICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3dhcm4nLCB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdpbnZhbGlkIGtleSBVUkkgcHJvdmlkZWQgZm9yIFdpZGV2aW5lJ1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCEoZW50cnkuYXR0cmlidXRlcy5LRVlJRCAmJiBlbnRyeS5hdHRyaWJ1dGVzLktFWUlELnN1YnN0cmluZygwLCAyKSA9PT0gJzB4JykpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignd2FybicsIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2ludmFsaWQga2V5IElEIHByb3ZpZGVkIGZvciBXaWRldmluZSdcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH0gLy8gaWYgV2lkZXZpbmUga2V5IGF0dHJpYnV0ZXMgYXJlIHZhbGlkLCBzdG9yZSB0aGVtIGFzIGBjb250ZW50UHJvdGVjdGlvbmBcbiAgICAgICAgICAgICAgICAvLyBvbiB0aGUgbWFuaWZlc3QgdG8gZW11bGF0ZSBXaWRldmluZSB0YWcgc3RydWN0dXJlIGluIGEgREFTSCBtcGRcblxuXG4gICAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC5jb250ZW50UHJvdGVjdGlvbiA9IHRoaXMubWFuaWZlc3QuY29udGVudFByb3RlY3Rpb24gfHwge307XG4gICAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC5jb250ZW50UHJvdGVjdGlvblsnY29tLndpZGV2aW5lLmFscGhhJ10gPSB7XG4gICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHNjaGVtZUlkVXJpOiBlbnRyeS5hdHRyaWJ1dGVzLktFWUZPUk1BVCxcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlICcweCcgZnJvbSB0aGUga2V5IGlkIHN0cmluZ1xuICAgICAgICAgICAgICAgICAgICBrZXlJZDogZW50cnkuYXR0cmlidXRlcy5LRVlJRC5zdWJzdHJpbmcoMilcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAvLyBkZWNvZGUgdGhlIGJhc2U2NC1lbmNvZGVkIFBTU0ggYm94XG4gICAgICAgICAgICAgICAgICBwc3NoOiBkZWNvZGVCNjRUb1VpbnQ4QXJyYXkoZW50cnkuYXR0cmlidXRlcy5VUkkuc3BsaXQoJywnKVsxXSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmICghZW50cnkuYXR0cmlidXRlcy5NRVRIT0QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3dhcm4nLCB7XG4gICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnZGVmYXVsdGluZyBrZXkgbWV0aG9kIHRvIEFFUy0xMjgnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gLy8gc2V0dXAgYW4gZW5jcnlwdGlvbiBrZXkgZm9yIHVwY29taW5nIHNlZ21lbnRzXG5cblxuICAgICAgICAgICAgICBrZXkgPSB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBlbnRyeS5hdHRyaWJ1dGVzLk1FVEhPRCB8fCAnQUVTLTEyOCcsXG4gICAgICAgICAgICAgICAgdXJpOiBlbnRyeS5hdHRyaWJ1dGVzLlVSSVxuICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgZW50cnkuYXR0cmlidXRlcy5JViAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBrZXkuaXYgPSBlbnRyeS5hdHRyaWJ1dGVzLklWO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnbWVkaWEtc2VxdWVuY2UnKCkge1xuICAgICAgICAgICAgICBpZiAoIWlzRmluaXRlKGVudHJ5Lm51bWJlcikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3dhcm4nLCB7XG4gICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnaWdub3JpbmcgaW52YWxpZCBtZWRpYSBzZXF1ZW5jZTogJyArIGVudHJ5Lm51bWJlclxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QubWVkaWFTZXF1ZW5jZSA9IGVudHJ5Lm51bWJlcjtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdkaXNjb250aW51aXR5LXNlcXVlbmNlJygpIHtcbiAgICAgICAgICAgICAgaWYgKCFpc0Zpbml0ZShlbnRyeS5udW1iZXIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCd3YXJuJywge1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2lnbm9yaW5nIGludmFsaWQgZGlzY29udGludWl0eSBzZXF1ZW5jZTogJyArIGVudHJ5Lm51bWJlclxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QuZGlzY29udGludWl0eVNlcXVlbmNlID0gZW50cnkubnVtYmVyO1xuICAgICAgICAgICAgICBjdXJyZW50VGltZWxpbmUgPSBlbnRyeS5udW1iZXI7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAncGxheWxpc3QtdHlwZScoKSB7XG4gICAgICAgICAgICAgIGlmICghL1ZPRHxFVkVOVC8udGVzdChlbnRyeS5wbGF5bGlzdFR5cGUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCd3YXJuJywge1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2lnbm9yaW5nIHVua25vd24gcGxheWxpc3QgdHlwZTogJyArIGVudHJ5LnBsYXlsaXN0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC5wbGF5bGlzdFR5cGUgPSBlbnRyeS5wbGF5bGlzdFR5cGU7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBtYXAoKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRNYXAgPSB7fTtcblxuICAgICAgICAgICAgICBpZiAoZW50cnkudXJpKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudE1hcC51cmkgPSBlbnRyeS51cmk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoZW50cnkuYnl0ZXJhbmdlKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudE1hcC5ieXRlcmFuZ2UgPSBlbnRyeS5ieXRlcmFuZ2U7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICAgICAgY3VycmVudE1hcC5rZXkgPSBrZXk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdzdHJlYW0taW5mJygpIHtcbiAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC5wbGF5bGlzdHMgPSB1cmlzO1xuICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0Lm1lZGlhR3JvdXBzID0gdGhpcy5tYW5pZmVzdC5tZWRpYUdyb3VwcyB8fCBkZWZhdWx0TWVkaWFHcm91cHM7XG5cbiAgICAgICAgICAgICAgaWYgKCFlbnRyeS5hdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCd3YXJuJywge1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2lnbm9yaW5nIGVtcHR5IHN0cmVhbS1pbmYgYXR0cmlidXRlcydcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRVcmkuYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRVcmkuYXR0cmlidXRlcyA9IHt9O1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgX2V4dGVuZHMoY3VycmVudFVyaS5hdHRyaWJ1dGVzLCBlbnRyeS5hdHRyaWJ1dGVzKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIG1lZGlhKCkge1xuICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0Lm1lZGlhR3JvdXBzID0gdGhpcy5tYW5pZmVzdC5tZWRpYUdyb3VwcyB8fCBkZWZhdWx0TWVkaWFHcm91cHM7XG5cbiAgICAgICAgICAgICAgaWYgKCEoZW50cnkuYXR0cmlidXRlcyAmJiBlbnRyeS5hdHRyaWJ1dGVzLlRZUEUgJiYgZW50cnkuYXR0cmlidXRlc1snR1JPVVAtSUQnXSAmJiBlbnRyeS5hdHRyaWJ1dGVzLk5BTUUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCd3YXJuJywge1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2lnbm9yaW5nIGluY29tcGxldGUgb3IgbWlzc2luZyBtZWRpYSBncm91cCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH0gLy8gZmluZCB0aGUgbWVkaWEgZ3JvdXAsIGNyZWF0aW5nIGRlZmF1bHRzIGFzIG5lY2Vzc2FyeVxuXG5cbiAgICAgICAgICAgICAgY29uc3QgbWVkaWFHcm91cFR5cGUgPSB0aGlzLm1hbmlmZXN0Lm1lZGlhR3JvdXBzW2VudHJ5LmF0dHJpYnV0ZXMuVFlQRV07XG4gICAgICAgICAgICAgIG1lZGlhR3JvdXBUeXBlW2VudHJ5LmF0dHJpYnV0ZXNbJ0dST1VQLUlEJ11dID0gbWVkaWFHcm91cFR5cGVbZW50cnkuYXR0cmlidXRlc1snR1JPVVAtSUQnXV0gfHwge307XG4gICAgICAgICAgICAgIG1lZGlhR3JvdXAgPSBtZWRpYUdyb3VwVHlwZVtlbnRyeS5hdHRyaWJ1dGVzWydHUk9VUC1JRCddXTsgLy8gY29sbGVjdCB0aGUgcmVuZGl0aW9uIG1ldGFkYXRhXG5cbiAgICAgICAgICAgICAgcmVuZGl0aW9uID0ge1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IC95ZXMvaS50ZXN0KGVudHJ5LmF0dHJpYnV0ZXMuREVGQVVMVClcbiAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICBpZiAocmVuZGl0aW9uLmRlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICByZW5kaXRpb24uYXV0b3NlbGVjdCA9IHRydWU7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVuZGl0aW9uLmF1dG9zZWxlY3QgPSAveWVzL2kudGVzdChlbnRyeS5hdHRyaWJ1dGVzLkFVVE9TRUxFQ1QpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGVudHJ5LmF0dHJpYnV0ZXMuTEFOR1VBR0UpIHtcbiAgICAgICAgICAgICAgICByZW5kaXRpb24ubGFuZ3VhZ2UgPSBlbnRyeS5hdHRyaWJ1dGVzLkxBTkdVQUdFO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGVudHJ5LmF0dHJpYnV0ZXMuVVJJKSB7XG4gICAgICAgICAgICAgICAgcmVuZGl0aW9uLnVyaSA9IGVudHJ5LmF0dHJpYnV0ZXMuVVJJO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGVudHJ5LmF0dHJpYnV0ZXNbJ0lOU1RSRUFNLUlEJ10pIHtcbiAgICAgICAgICAgICAgICByZW5kaXRpb24uaW5zdHJlYW1JZCA9IGVudHJ5LmF0dHJpYnV0ZXNbJ0lOU1RSRUFNLUlEJ107XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoZW50cnkuYXR0cmlidXRlcy5DSEFSQUNURVJJU1RJQ1MpIHtcbiAgICAgICAgICAgICAgICByZW5kaXRpb24uY2hhcmFjdGVyaXN0aWNzID0gZW50cnkuYXR0cmlidXRlcy5DSEFSQUNURVJJU1RJQ1M7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoZW50cnkuYXR0cmlidXRlcy5GT1JDRUQpIHtcbiAgICAgICAgICAgICAgICByZW5kaXRpb24uZm9yY2VkID0gL3llcy9pLnRlc3QoZW50cnkuYXR0cmlidXRlcy5GT1JDRUQpO1xuICAgICAgICAgICAgICB9IC8vIGluc2VydCB0aGUgbmV3IHJlbmRpdGlvblxuXG5cbiAgICAgICAgICAgICAgbWVkaWFHcm91cFtlbnRyeS5hdHRyaWJ1dGVzLk5BTUVdID0gcmVuZGl0aW9uO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZGlzY29udGludWl0eSgpIHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWVsaW5lICs9IDE7XG4gICAgICAgICAgICAgIGN1cnJlbnRVcmkuZGlzY29udGludWl0eSA9IHRydWU7XG4gICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QuZGlzY29udGludWl0eVN0YXJ0cy5wdXNoKHVyaXMubGVuZ3RoKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdwcm9ncmFtLWRhdGUtdGltZScoKSB7XG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5tYW5pZmVzdC5kYXRlVGltZVN0cmluZyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAvLyBQUk9HUkFNLURBVEUtVElNRSBpcyBhIG1lZGlhLXNlZ21lbnQgdGFnLCBidXQgZm9yIGJhY2t3YXJkc1xuICAgICAgICAgICAgICAgIC8vIGNvbXBhdGliaWxpdHksIHdlIGFkZCB0aGUgZmlyc3Qgb2NjdXJlbmNlIG9mIHRoZSBQUk9HUkFNLURBVEUtVElNRSB0YWdcbiAgICAgICAgICAgICAgICAvLyB0byB0aGUgbWFuaWZlc3Qgb2JqZWN0XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogQ29uc2lkZXIgcmVtb3ZpbmcgdGhpcyBpbiBmdXR1cmUgbWFqb3IgdmVyc2lvblxuICAgICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QuZGF0ZVRpbWVTdHJpbmcgPSBlbnRyeS5kYXRlVGltZVN0cmluZztcbiAgICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0LmRhdGVUaW1lT2JqZWN0ID0gZW50cnkuZGF0ZVRpbWVPYmplY3Q7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBjdXJyZW50VXJpLmRhdGVUaW1lU3RyaW5nID0gZW50cnkuZGF0ZVRpbWVTdHJpbmc7XG4gICAgICAgICAgICAgIGN1cnJlbnRVcmkuZGF0ZVRpbWVPYmplY3QgPSBlbnRyeS5kYXRlVGltZU9iamVjdDtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHRhcmdldGR1cmF0aW9uKCkge1xuICAgICAgICAgICAgICBpZiAoIWlzRmluaXRlKGVudHJ5LmR1cmF0aW9uKSB8fCBlbnRyeS5kdXJhdGlvbiA8IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3dhcm4nLCB7XG4gICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnaWdub3JpbmcgaW52YWxpZCB0YXJnZXQgZHVyYXRpb246ICcgKyBlbnRyeS5kdXJhdGlvblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QudGFyZ2V0RHVyYXRpb24gPSBlbnRyeS5kdXJhdGlvbjtcbiAgICAgICAgICAgICAgc2V0SG9sZEJhY2suY2FsbCh0aGlzLCB0aGlzLm1hbmlmZXN0KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHN0YXJ0KCkge1xuICAgICAgICAgICAgICBpZiAoIWVudHJ5LmF0dHJpYnV0ZXMgfHwgaXNOYU4oZW50cnkuYXR0cmlidXRlc1snVElNRS1PRkZTRVQnXSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3dhcm4nLCB7XG4gICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnaWdub3Jpbmcgc3RhcnQgZGVjbGFyYXRpb24gd2l0aG91dCBhcHByb3ByaWF0ZSBhdHRyaWJ1dGUgbGlzdCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0LnN0YXJ0ID0ge1xuICAgICAgICAgICAgICAgIHRpbWVPZmZzZXQ6IGVudHJ5LmF0dHJpYnV0ZXNbJ1RJTUUtT0ZGU0VUJ10sXG4gICAgICAgICAgICAgICAgcHJlY2lzZTogZW50cnkuYXR0cmlidXRlcy5QUkVDSVNFXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnY3VlLW91dCcoKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRVcmkuY3VlT3V0ID0gZW50cnkuZGF0YTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdjdWUtb3V0LWNvbnQnKCkge1xuICAgICAgICAgICAgICBjdXJyZW50VXJpLmN1ZU91dENvbnQgPSBlbnRyeS5kYXRhO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ2N1ZS1pbicoKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRVcmkuY3VlSW4gPSBlbnRyeS5kYXRhO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ3NraXAnKCkge1xuICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0LnNraXAgPSBjYW1lbENhc2VLZXlzKGVudHJ5LmF0dHJpYnV0ZXMpO1xuICAgICAgICAgICAgICB0aGlzLndhcm5Pbk1pc3NpbmdBdHRyaWJ1dGVzXygnI0VYVC1YLVNLSVAnLCBlbnRyeS5hdHRyaWJ1dGVzLCBbJ1NLSVBQRUQtU0VHTUVOVFMnXSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAncGFydCcoKSB7XG4gICAgICAgICAgICAgIGhhc1BhcnRzID0gdHJ1ZTsgLy8gcGFydHMgYXJlIGFsd2F5cyBzcGVjaWZlZCBiZWZvcmUgYSBzZWdtZW50XG5cbiAgICAgICAgICAgICAgY29uc3Qgc2VnbWVudEluZGV4ID0gdGhpcy5tYW5pZmVzdC5zZWdtZW50cy5sZW5ndGg7XG4gICAgICAgICAgICAgIGNvbnN0IHBhcnQgPSBjYW1lbENhc2VLZXlzKGVudHJ5LmF0dHJpYnV0ZXMpO1xuICAgICAgICAgICAgICBjdXJyZW50VXJpLnBhcnRzID0gY3VycmVudFVyaS5wYXJ0cyB8fCBbXTtcbiAgICAgICAgICAgICAgY3VycmVudFVyaS5wYXJ0cy5wdXNoKHBhcnQpO1xuXG4gICAgICAgICAgICAgIGlmIChwYXJ0LmJ5dGVyYW5nZSkge1xuICAgICAgICAgICAgICAgIGlmICghcGFydC5ieXRlcmFuZ2UuaGFzT3duUHJvcGVydHkoJ29mZnNldCcpKSB7XG4gICAgICAgICAgICAgICAgICBwYXJ0LmJ5dGVyYW5nZS5vZmZzZXQgPSBsYXN0UGFydEJ5dGVyYW5nZUVuZDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsYXN0UGFydEJ5dGVyYW5nZUVuZCA9IHBhcnQuYnl0ZXJhbmdlLm9mZnNldCArIHBhcnQuYnl0ZXJhbmdlLmxlbmd0aDtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGNvbnN0IHBhcnRJbmRleCA9IGN1cnJlbnRVcmkucGFydHMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgdGhpcy53YXJuT25NaXNzaW5nQXR0cmlidXRlc18oYCNFWFQtWC1QQVJUICMke3BhcnRJbmRleH0gZm9yIHNlZ21lbnQgIyR7c2VnbWVudEluZGV4fWAsIGVudHJ5LmF0dHJpYnV0ZXMsIFsnVVJJJywgJ0RVUkFUSU9OJ10pO1xuXG4gICAgICAgICAgICAgIGlmICh0aGlzLm1hbmlmZXN0LnJlbmRpdGlvblJlcG9ydHMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hbmlmZXN0LnJlbmRpdGlvblJlcG9ydHMuZm9yRWFjaCgociwgaSkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKCFyLmhhc093blByb3BlcnR5KCdsYXN0UGFydCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignd2FybicsIHtcbiAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgI0VYVC1YLVJFTkRJVElPTi1SRVBPUlQgIyR7aX0gbGFja3MgcmVxdWlyZWQgYXR0cmlidXRlKHMpOiBMQVNULVBBUlRgXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnc2VydmVyLWNvbnRyb2wnKCkge1xuICAgICAgICAgICAgICBjb25zdCBhdHRycyA9IHRoaXMubWFuaWZlc3Quc2VydmVyQ29udHJvbCA9IGNhbWVsQ2FzZUtleXMoZW50cnkuYXR0cmlidXRlcyk7XG5cbiAgICAgICAgICAgICAgaWYgKCFhdHRycy5oYXNPd25Qcm9wZXJ0eSgnY2FuQmxvY2tSZWxvYWQnKSkge1xuICAgICAgICAgICAgICAgIGF0dHJzLmNhbkJsb2NrUmVsb2FkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdpbmZvJywge1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJyNFWFQtWC1TRVJWRVItQ09OVFJPTCBkZWZhdWx0aW5nIENBTi1CTE9DSy1SRUxPQUQgdG8gZmFsc2UnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBzZXRIb2xkQmFjay5jYWxsKHRoaXMsIHRoaXMubWFuaWZlc3QpO1xuXG4gICAgICAgICAgICAgIGlmIChhdHRycy5jYW5Ta2lwRGF0ZXJhbmdlcyAmJiAhYXR0cnMuaGFzT3duUHJvcGVydHkoJ2NhblNraXBVbnRpbCcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCd3YXJuJywge1xuICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJyNFWFQtWC1TRVJWRVItQ09OVFJPTCBsYWNrcyByZXF1aXJlZCBhdHRyaWJ1dGUgQ0FOLVNLSVAtVU5USUwgd2hpY2ggaXMgcmVxdWlyZWQgd2hlbiBDQU4tU0tJUC1EQVRFUkFOR0VTIGlzIHNldCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgJ3ByZWxvYWQtaGludCcoKSB7XG4gICAgICAgICAgICAgIC8vIHBhcnRzIGFyZSBhbHdheXMgc3BlY2lmZWQgYmVmb3JlIGEgc2VnbWVudFxuICAgICAgICAgICAgICBjb25zdCBzZWdtZW50SW5kZXggPSB0aGlzLm1hbmlmZXN0LnNlZ21lbnRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgY29uc3QgaGludCA9IGNhbWVsQ2FzZUtleXMoZW50cnkuYXR0cmlidXRlcyk7XG4gICAgICAgICAgICAgIGNvbnN0IGlzUGFydCA9IGhpbnQudHlwZSAmJiBoaW50LnR5cGUgPT09ICdQQVJUJztcbiAgICAgICAgICAgICAgY3VycmVudFVyaS5wcmVsb2FkSGludHMgPSBjdXJyZW50VXJpLnByZWxvYWRIaW50cyB8fCBbXTtcbiAgICAgICAgICAgICAgY3VycmVudFVyaS5wcmVsb2FkSGludHMucHVzaChoaW50KTtcblxuICAgICAgICAgICAgICBpZiAoaGludC5ieXRlcmFuZ2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWhpbnQuYnl0ZXJhbmdlLmhhc093blByb3BlcnR5KCdvZmZzZXQnKSkge1xuICAgICAgICAgICAgICAgICAgLy8gdXNlIGxhc3QgcGFydCBieXRlcmFuZ2UgZW5kIG9yIHplcm8gaWYgbm90IGEgcGFydC5cbiAgICAgICAgICAgICAgICAgIGhpbnQuYnl0ZXJhbmdlLm9mZnNldCA9IGlzUGFydCA/IGxhc3RQYXJ0Qnl0ZXJhbmdlRW5kIDogMDtcblxuICAgICAgICAgICAgICAgICAgaWYgKGlzUGFydCkge1xuICAgICAgICAgICAgICAgICAgICBsYXN0UGFydEJ5dGVyYW5nZUVuZCA9IGhpbnQuYnl0ZXJhbmdlLm9mZnNldCArIGhpbnQuYnl0ZXJhbmdlLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGN1cnJlbnRVcmkucHJlbG9hZEhpbnRzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgIHRoaXMud2Fybk9uTWlzc2luZ0F0dHJpYnV0ZXNfKGAjRVhULVgtUFJFTE9BRC1ISU5UICMke2luZGV4fSBmb3Igc2VnbWVudCAjJHtzZWdtZW50SW5kZXh9YCwgZW50cnkuYXR0cmlidXRlcywgWydUWVBFJywgJ1VSSSddKTtcblxuICAgICAgICAgICAgICBpZiAoIWhpbnQudHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfSAvLyBzZWFyY2ggdGhyb3VnaCBhbGwgcHJlbG9hZCBoaW50cyBleGNlcHQgZm9yIHRoZSBjdXJyZW50IG9uZSBmb3JcbiAgICAgICAgICAgICAgLy8gYSBkdXBsaWNhdGUgdHlwZS5cblxuXG4gICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VycmVudFVyaS5wcmVsb2FkSGludHMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJIaW50ID0gY3VycmVudFVyaS5wcmVsb2FkSGludHNbaV07XG5cbiAgICAgICAgICAgICAgICBpZiAoIW90aGVySGludC50eXBlKSB7XG4gICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob3RoZXJIaW50LnR5cGUgPT09IGhpbnQudHlwZSkge1xuICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCd3YXJuJywge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgI0VYVC1YLVBSRUxPQUQtSElOVCAjJHtpbmRleH0gZm9yIHNlZ21lbnQgIyR7c2VnbWVudEluZGV4fSBoYXMgdGhlIHNhbWUgVFlQRSAke2hpbnQudHlwZX0gYXMgcHJlbG9hZCBoaW50ICMke2l9YFxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAncmVuZGl0aW9uLXJlcG9ydCcoKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHJlcG9ydCA9IGNhbWVsQ2FzZUtleXMoZW50cnkuYXR0cmlidXRlcyk7XG4gICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QucmVuZGl0aW9uUmVwb3J0cyA9IHRoaXMubWFuaWZlc3QucmVuZGl0aW9uUmVwb3J0cyB8fCBbXTtcbiAgICAgICAgICAgICAgdGhpcy5tYW5pZmVzdC5yZW5kaXRpb25SZXBvcnRzLnB1c2gocmVwb3J0KTtcbiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm1hbmlmZXN0LnJlbmRpdGlvblJlcG9ydHMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgY29uc3QgcmVxdWlyZWQgPSBbJ0xBU1QtTVNOJywgJ1VSSSddO1xuXG4gICAgICAgICAgICAgIGlmIChoYXNQYXJ0cykge1xuICAgICAgICAgICAgICAgIHJlcXVpcmVkLnB1c2goJ0xBU1QtUEFSVCcpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdGhpcy53YXJuT25NaXNzaW5nQXR0cmlidXRlc18oYCNFWFQtWC1SRU5ESVRJT04tUkVQT1JUICMke2luZGV4fWAsIGVudHJ5LmF0dHJpYnV0ZXMsIHJlcXVpcmVkKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdwYXJ0LWluZicoKSB7XG4gICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QucGFydEluZiA9IGNhbWVsQ2FzZUtleXMoZW50cnkuYXR0cmlidXRlcyk7XG4gICAgICAgICAgICAgIHRoaXMud2Fybk9uTWlzc2luZ0F0dHJpYnV0ZXNfKCcjRVhULVgtUEFSVC1JTkYnLCBlbnRyeS5hdHRyaWJ1dGVzLCBbJ1BBUlQtVEFSR0VUJ10pO1xuXG4gICAgICAgICAgICAgIGlmICh0aGlzLm1hbmlmZXN0LnBhcnRJbmYucGFydFRhcmdldCkge1xuICAgICAgICAgICAgICAgIHRoaXMubWFuaWZlc3QucGFydFRhcmdldER1cmF0aW9uID0gdGhpcy5tYW5pZmVzdC5wYXJ0SW5mLnBhcnRUYXJnZXQ7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBzZXRIb2xkQmFjay5jYWxsKHRoaXMsIHRoaXMubWFuaWZlc3QpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgfSlbZW50cnkudGFnVHlwZV0gfHwgbm9vcCkuY2FsbChzZWxmKTtcbiAgICAgICAgfSxcblxuICAgICAgICB1cmkoKSB7XG4gICAgICAgICAgY3VycmVudFVyaS51cmkgPSBlbnRyeS51cmk7XG4gICAgICAgICAgdXJpcy5wdXNoKGN1cnJlbnRVcmkpOyAvLyBpZiBubyBleHBsaWNpdCBkdXJhdGlvbiB3YXMgZGVjbGFyZWQsIHVzZSB0aGUgdGFyZ2V0IGR1cmF0aW9uXG5cbiAgICAgICAgICBpZiAodGhpcy5tYW5pZmVzdC50YXJnZXREdXJhdGlvbiAmJiAhKCdkdXJhdGlvbicgaW4gY3VycmVudFVyaSkpIHtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcignd2FybicsIHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ2RlZmF1bHRpbmcgc2VnbWVudCBkdXJhdGlvbiB0byB0aGUgdGFyZ2V0IGR1cmF0aW9uJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjdXJyZW50VXJpLmR1cmF0aW9uID0gdGhpcy5tYW5pZmVzdC50YXJnZXREdXJhdGlvbjtcbiAgICAgICAgICB9IC8vIGFubm90YXRlIHdpdGggZW5jcnlwdGlvbiBpbmZvcm1hdGlvbiwgaWYgbmVjZXNzYXJ5XG5cblxuICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgIGN1cnJlbnRVcmkua2V5ID0ga2V5O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGN1cnJlbnRVcmkudGltZWxpbmUgPSBjdXJyZW50VGltZWxpbmU7IC8vIGFubm90YXRlIHdpdGggaW5pdGlhbGl6YXRpb24gc2VnbWVudCBpbmZvcm1hdGlvbiwgaWYgbmVjZXNzYXJ5XG5cbiAgICAgICAgICBpZiAoY3VycmVudE1hcCkge1xuICAgICAgICAgICAgY3VycmVudFVyaS5tYXAgPSBjdXJyZW50TWFwO1xuICAgICAgICAgIH0gLy8gcmVzZXQgdGhlIGxhc3QgYnl0ZXJhbmdlIGVuZCBhcyBpdCBuZWVkcyB0byBiZSAwIGJldHdlZW4gcGFydHNcblxuXG4gICAgICAgICAgbGFzdFBhcnRCeXRlcmFuZ2VFbmQgPSAwOyAvLyBwcmVwYXJlIGZvciB0aGUgbmV4dCBVUklcblxuICAgICAgICAgIGN1cnJlbnRVcmkgPSB7fTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb21tZW50KCkgey8vIGNvbW1lbnRzIGFyZSBub3QgaW1wb3J0YW50IGZvciBwbGF5YmFja1xuICAgICAgICB9LFxuXG4gICAgICAgIGN1c3RvbSgpIHtcbiAgICAgICAgICAvLyBpZiB0aGlzIGlzIHNlZ21lbnQtbGV2ZWwgZGF0YSBhdHRhY2ggdGhlIG91dHB1dCB0byB0aGUgc2VnbWVudFxuICAgICAgICAgIGlmIChlbnRyeS5zZWdtZW50KSB7XG4gICAgICAgICAgICBjdXJyZW50VXJpLmN1c3RvbSA9IGN1cnJlbnRVcmkuY3VzdG9tIHx8IHt9O1xuICAgICAgICAgICAgY3VycmVudFVyaS5jdXN0b21bZW50cnkuY3VzdG9tVHlwZV0gPSBlbnRyeS5kYXRhOyAvLyBpZiB0aGlzIGlzIG1hbmlmZXN0LWxldmVsIGRhdGEgYXR0YWNoIHRvIHRoZSB0b3AgbGV2ZWwgbWFuaWZlc3Qgb2JqZWN0XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWFuaWZlc3QuY3VzdG9tID0gdGhpcy5tYW5pZmVzdC5jdXN0b20gfHwge307XG4gICAgICAgICAgICB0aGlzLm1hbmlmZXN0LmN1c3RvbVtlbnRyeS5jdXN0b21UeXBlXSA9IGVudHJ5LmRhdGE7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIH0pW2VudHJ5LnR5cGVdLmNhbGwoc2VsZik7XG4gICAgfSk7XG4gIH1cblxuICB3YXJuT25NaXNzaW5nQXR0cmlidXRlc18oaWRlbnRpZmllciwgYXR0cmlidXRlcywgcmVxdWlyZWQpIHtcbiAgICBjb25zdCBtaXNzaW5nID0gW107XG4gICAgcmVxdWlyZWQuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICBpZiAoIWF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICBtaXNzaW5nLnB1c2goa2V5KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChtaXNzaW5nLmxlbmd0aCkge1xuICAgICAgdGhpcy50cmlnZ2VyKCd3YXJuJywge1xuICAgICAgICBtZXNzYWdlOiBgJHtpZGVudGlmaWVyfSBsYWNrcyByZXF1aXJlZCBhdHRyaWJ1dGUocyk6ICR7bWlzc2luZy5qb2luKCcsICcpfWBcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUGFyc2UgdGhlIGlucHV0IHN0cmluZyBhbmQgdXBkYXRlIHRoZSBtYW5pZmVzdCBvYmplY3QuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjaHVuayBhIHBvdGVudGlhbGx5IGluY29tcGxldGUgcG9ydGlvbiBvZiB0aGUgbWFuaWZlc3RcbiAgICovXG5cblxuICBwdXNoKGNodW5rKSB7XG4gICAgdGhpcy5saW5lU3RyZWFtLnB1c2goY2h1bmspO1xuICB9XG4gIC8qKlxuICAgKiBGbHVzaCBhbnkgcmVtYWluaW5nIGlucHV0LiBUaGlzIGNhbiBiZSBoYW5keSBpZiB0aGUgbGFzdCBsaW5lIG9mIGFuIE0zVThcbiAgICogbWFuaWZlc3QgZGlkIG5vdCBjb250YWluIGEgdHJhaWxpbmcgbmV3bGluZSBidXQgdGhlIGZpbGUgaGFzIGJlZW5cbiAgICogY29tcGxldGVseSByZWNlaXZlZC5cbiAgICovXG5cblxuICBlbmQoKSB7XG4gICAgLy8gZmx1c2ggYW55IGJ1ZmZlcmVkIGlucHV0XG4gICAgdGhpcy5saW5lU3RyZWFtLnB1c2goJ1xcbicpO1xuICAgIHRoaXMudHJpZ2dlcignZW5kJyk7XG4gIH1cbiAgLyoqXG4gICAqIEFkZCBhbiBhZGRpdGlvbmFsIHBhcnNlciBmb3Igbm9uLXN0YW5kYXJkIHRhZ3NcbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9ICAgb3B0aW9ucyAgICAgICAgICAgICAgYSBtYXAgb2Ygb3B0aW9ucyBmb3IgdGhlIGFkZGVkIHBhcnNlclxuICAgKiBAcGFyYW0ge1JlZ0V4cH0gICBvcHRpb25zLmV4cHJlc3Npb24gICBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBtYXRjaCB0aGUgY3VzdG9tIGhlYWRlclxuICAgKiBAcGFyYW0ge3N0cmluZ30gICBvcHRpb25zLnR5cGUgICAgICAgICB0aGUgdHlwZSB0byByZWdpc3RlciB0byB0aGUgb3V0cHV0XG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtvcHRpb25zLmRhdGFQYXJzZXJdIGZ1bmN0aW9uIHRvIHBhcnNlIHRoZSBsaW5lIGludG8gYW4gb2JqZWN0XG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gIFtvcHRpb25zLnNlZ21lbnRdICAgIHNob3VsZCB0YWcgZGF0YSBiZSBhdHRhY2hlZCB0byB0aGUgc2VnbWVudCBvYmplY3RcbiAgICovXG5cblxuICBhZGRQYXJzZXIob3B0aW9ucykge1xuICAgIHRoaXMucGFyc2VTdHJlYW0uYWRkUGFyc2VyKG9wdGlvbnMpO1xuICB9XG4gIC8qKlxuICAgKiBBZGQgYSBjdXN0b20gaGVhZGVyIG1hcHBlclxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gICBvcHRpb25zXG4gICAqIEBwYXJhbSB7UmVnRXhwfSAgIG9wdGlvbnMuZXhwcmVzc2lvbiAgIGEgcmVndWxhciBleHByZXNzaW9uIHRvIG1hdGNoIHRoZSBjdXN0b20gaGVhZGVyXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IG9wdGlvbnMubWFwICAgICAgICAgIGZ1bmN0aW9uIHRvIHRyYW5zbGF0ZSB0YWcgaW50byBhIGRpZmZlcmVudCB0YWdcbiAgICovXG5cblxuICBhZGRUYWdNYXBwZXIob3B0aW9ucykge1xuICAgIHRoaXMucGFyc2VTdHJlYW0uYWRkVGFnTWFwcGVyKG9wdGlvbnMpO1xuICB9XG5cbn1cblxuZXhwb3J0IHsgTGluZVN0cmVhbSwgUGFyc2VTdHJlYW0sIFBhcnNlciB9O1xuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gX2V4dGVuZHMoKSB7XG4gIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiA/IE9iamVjdC5hc3NpZ24uYmluZCgpIDogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldO1xuICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkge1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkge1xuICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfTtcbiAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG59IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSAobW9kdWxlKSA9PiB7XG5cdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuXHRcdCgpID0+IChtb2R1bGVbJ2RlZmF1bHQnXSkgOlxuXHRcdCgpID0+IChtb2R1bGUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCB7IGE6IGdldHRlciB9KTtcblx0cmV0dXJuIGdldHRlcjtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKFwiLi9zcmMvYXBwLndvcmtlci50c1wiKTtcbiIsIiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==";

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.ts");
/******/ 	
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBYTtBQUNiO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RDtBQUNBO0FBQ0Esd0NBQXdDLG1CQUFPLENBQUMsbURBQXVCO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEMsdUJBQXVCLGNBQWMsR0FBRztBQUN4QywrREFBK0QseUJBQXlCO0FBQ3hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHFCQUFNO0FBQ3RCLGdCQUFnQixxQkFBTTtBQUN0QiwyQ0FBMkMscUJBQU07QUFDakQ7QUFDQTtBQUNBLGlEQUFpRCx1Q0FBdUM7QUFDeEY7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLGtDQUFrQztBQUMvRTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsb0RBQW9EO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCwyQ0FBMkM7QUFDNUY7QUFDQTtBQUNBO0FBQ0EsaURBQWlELDBDQUEwQztBQUMzRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELDBEQUEwRDtBQUMzRztBQUNBO0FBQ0E7QUFDQSxpREFBaUQsZ0NBQWdDO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELGtEQUFrRDtBQUNuRztBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsMkNBQTJDOzs7Ozs7Ozs7Ozs7Ozs7O1VDL0czQztVQUNBOztVQUVBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBOztVQUVBO1VBQ0E7O1VBRUE7VUFDQTtVQUNBOzs7OztXQ3RCQTtXQUNBO1dBQ0E7V0FDQTtXQUNBLEdBQUc7V0FDSDtXQUNBO1dBQ0EsQ0FBQzs7Ozs7VUVQRDtVQUNBO1VBQ0E7VUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYmVmb3JlLXN0YXJ0dXAiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly8vd2VicGFjay9hZnRlci1zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuLy90aGlzIGxpbmUgZ29ubmEgaW1wb3J0IHRoZSBjb250ZW50IGZyb20gY29tcGlsZSB3b3JrZXIgYXMgc3RyaW5nXHJcbi8vQHRzLWV4cGVjdC1lcnJvclxyXG5jb25zdCBhcHBfd29ya2VyX2pzXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4uL2Rpc3QvYXBwLndvcmtlci5qc1wiKSk7XHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBsZXQgbWFpbldvcmtlcjtcclxuICAgIHdpbmRvdy5Xb3JrZXIgPSBjbGFzcyBXb3JrZXJJbmplY3RvciBleHRlbmRzIFdvcmtlciB7XHJcbiAgICAgICAgY29uc3RydWN0b3IodHdpdGNoQmxvYlVybCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIm5ldyB3b3JrZXIgaW50YW5jZSBcIiArIHR3aXRjaEJsb2JVcmwpO1xyXG4gICAgICAgICAgICBpZiAodHdpdGNoQmxvYlVybCA9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgc3VwZXIodHdpdGNoQmxvYlVybCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW1B1cnBsZV06IGluaXQgXCIgKyB0d2l0Y2hCbG9iVXJsKTtcclxuICAgICAgICAgICAgY29uc3QgbmV3QmxvYlN0ciA9IGAke2FwcF93b3JrZXJfanNfMS5kZWZhdWx0fVxuICAgICAgaW1wb3J0U2NyaXB0cygnJHt0d2l0Y2hCbG9iVXJsfScpO2A7XHJcbiAgICAgICAgICAgIHN1cGVyKFVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW25ld0Jsb2JTdHJdLCB7IHR5cGU6IFwidGV4dC9qYXZhc2NyaXB0XCIgfSkpKTtcclxuICAgICAgICAgICAgbWFpbldvcmtlciA9IHRoaXM7XHJcbiAgICAgICAgICAgIG1haW5Xb3JrZXIuZGVjbGFyZUV2ZW50V29ya2VyKCk7XHJcbiAgICAgICAgICAgIG1haW5Xb3JrZXIuZGVjbGFyZUV2ZW50V2luZG93KCk7XHJcbiAgICAgICAgICAgIG1haW5Xb3JrZXIuaW50ZWdyaXR5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGludGVncml0eSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgIGdsb2JhbC5yZXF1ZXN0ID0gZmV0Y2g7XHJcbiAgICAgICAgICAgICAgICBnbG9iYWwuZmV0Y2ggPSAodXJsLCBvcHRpb25zKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBnbG9iYWwucmVxdWVzdCh1cmwsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJvZHkgPSB5aWVsZCByZXNwb25zZS50ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVybCA9PSBcImh0dHBzOi8vZ3FsLnR3aXRjaC50di9pbnRlZ3JpdHlcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWluV29ya2VyLnBvc3RNZXNzYWdlKHsgZnVuY05hbWU6IFwic2V0SW50ZWdyaXR5XCIsIHZhbHVlOiBib2R5IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKGJvZHksIHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVjbGFyZUV2ZW50V29ya2VyKCkge1xyXG4gICAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZTtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoKF9hID0gZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50LmRhdGEpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImdldFNldHRpbmdzXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnBvc3RNZXNzYWdlKHsgdHlwZTogXCJnZXRTZXR0aW5nc1wiLCB2YWx1ZTogbnVsbCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJQbGF5ZXJRdWFsaXR5Q2hhbmdlZFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5Xb3JrZXIucG9zdE1lc3NhZ2UoeyBmdW5jTmFtZTogXCJzZXRRdWFsaXR5XCIsIHZhbHVlOiBldmVudC5kYXRhLmFyZy5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInBhdXNlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFpbldvcmtlci5wb3N0TWVzc2FnZSh7IGZ1bmNOYW1lOiBcInBhdXNlXCIsIGFyZ3M6IHVuZGVmaW5lZCwgaWQ6IDEgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicGxheVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5Xb3JrZXIucG9zdE1lc3NhZ2UoeyBmdW5jTmFtZTogXCJwbGF5XCIsIGFyZ3M6IHVuZGVmaW5lZCwgaWQ6IDEgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoKF9jID0gKF9iID0gZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50LmRhdGEpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hcmcpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5rZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicXVhbGl0eVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZXZlbnQuZGF0YS5hcmcudmFsdWUubmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNoYW5nZWQgcXVhbGl0eSBieSBwbGF5ZXI6IFwiICsgZXZlbnQuZGF0YS5hcmcudmFsdWUubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5Xb3JrZXIucG9zdE1lc3NhZ2UoeyBmdW5jTmFtZTogXCJzZXRRdWFsaXR5XCIsIHZhbHVlOiBldmVudC5kYXRhLmFyZy52YWx1ZS5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInN0YXRlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFpbldvcmtlci5wb3N0TWVzc2FnZSh7IGZ1bmNOYW1lOiBldmVudC5kYXRhLmFyZy52YWx1ZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKChfZSA9IChfZCA9IGV2ZW50ID09PSBudWxsIHx8IGV2ZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBldmVudC5kYXRhKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuYXJnKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJwYXVzZVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwicGxheVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlY2xhcmVFdmVudFdpbmRvdygpIHtcclxuICAgICAgICAgICAgLy9FdmVudCBsaXN0ZW5lciBmcm9tIHdpbmRvdyBhbmQgZXh0ZW5zaW9uLlxyXG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmRhdGEudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJzZXRTZXR0aW5nc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2VuZCBzZXR0aW5ncyB0byB3b3JrZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFpbldvcmtlci5wb3N0TWVzc2FnZSh7IGZ1bmNOYW1lOiBcInNldFNldHRpbmdzXCIsIHZhbHVlOiBldmVudC5kYXRhLnZhbHVlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSkoKTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2Jhc2U2NCxleUoyWlhKemFXOXVJam96TENKbWFXeGxJam9pYVc1a1pYZ3Vhbk1pTENKemIzVnlZMlZTYjI5MElqb2lJaXdpYzI5MWNtTmxjeUk2V3lJdUxpOXpjbU12YVc1a1pYZ3VkSE1pWFN3aWJtRnRaWE1pT2x0ZExDSnRZWEJ3YVc1bmN5STZJanM3T3pzN096czdPenM3T3pzN1FVRkJRU3hyUlVGQmEwVTdRVUZEYkVVc2EwSkJRV3RDTzBGQlEyeENMREJGUVVGM1F6dEJRVVY0UXl4RFFVRkRPMGxCUTBNc1NVRkJTU3hWUVVGbExFTkJRVU03U1VGRmNFSXNUVUZCVFN4RFFVRkRMRTFCUVUwc1IwRkJSeXhOUVVGTkxHTkJRV1VzVTBGQlVTeE5RVUZOTzFGQlEycEVMRmxCUVZrc1lVRkJhMEk3V1VGRE5VSXNUMEZCVHl4RFFVRkRMRWRCUVVjc1EwRkJReXh4UWtGQmNVSXNSMEZCUnl4aFFVRmhMRU5CUVVNc1EwRkJRenRaUVVWdVJDeEpRVUZKTEdGQlFXRXNTVUZCU1N4RlFVRkZPMmRDUVVGRkxFdEJRVXNzUTBGQlF5eGhRVUZoTEVOQlFVTXNRMEZCUXp0WlFVTTVReXhQUVVGUExFTkJRVU1zUjBGQlJ5eERRVUZETEdsQ1FVRnBRaXhIUVVGSExHRkJRV0VzUTBGQlF5eERRVUZETzFsQlJTOURMRTFCUVUwc1ZVRkJWU3hIUVVGSExFZEJRVWNzZFVKQlFVYzdkVUpCUTFJc1lVRkJZU3hMUVVGTExFTkJRVU03V1VGRmNFTXNTMEZCU3l4RFFVRkRMRWRCUVVjc1EwRkJReXhsUVVGbExFTkJRVU1zU1VGQlNTeEpRVUZKTEVOQlFVTXNRMEZCUXl4VlFVRlZMRU5CUVVNc1JVRkJSU3hGUVVGRkxFbEJRVWtzUlVGQlJTeHBRa0ZCYVVJc1JVRkJSU3hEUVVGRExFTkJRVU1zUTBGQlF5eERRVUZETzFsQlEyaEdMRlZCUVZVc1IwRkJSeXhKUVVGSkxFTkJRVU03V1VGRGJFSXNWVUZCVlN4RFFVRkRMR3RDUVVGclFpeEZRVUZGTEVOQlFVTTdXVUZEYUVNc1ZVRkJWU3hEUVVGRExHdENRVUZyUWl4RlFVRkZMRU5CUVVNN1dVRkRhRU1zVlVGQlZTeERRVUZETEZOQlFWTXNSVUZCUlN4RFFVRkRPMUZCUTNwQ0xFTkJRVU03VVVGRlN5eFRRVUZUT3p0blFrRkRZaXhOUVVGTkxFTkJRVU1zVDBGQlR5eEhRVUZITEV0QlFVc3NRMEZCUVR0blFrRkRkRUlzVFVGQlRTeERRVUZETEV0QlFVc3NSMEZCUnl4RFFVRlBMRWRCUVZFc1JVRkJSU3hQUVVGWkxFVkJRVVVzUlVGQlJUdHZRa0ZET1VNc1RVRkJUU3hSUVVGUkxFZEJRVWNzVFVGQlRTeE5RVUZOTEVOQlFVTXNUMEZCVHl4RFFVRkRMRWRCUVVjc1JVRkJSU3hQUVVGUExFTkJRVU1zUTBGQlF6dHZRa0ZEY0VRc1RVRkJUU3hKUVVGSkxFZEJRVWNzVFVGQlRTeFJRVUZSTEVOQlFVTXNTVUZCU1N4RlFVRkZMRU5CUVVNN2IwSkJSVzVETEVsQlFVa3NSMEZCUnl4SlFVRkpMR2xEUVVGcFF5eEZRVUZGTzNkQ1FVTTFReXhWUVVGVkxFTkJRVU1zVjBGQlZ5eERRVUZETEVWQlFVVXNVVUZCVVN4RlFVRkZMR05CUVdNc1JVRkJSU3hMUVVGTExFVkJRVVVzU1VGQlNTeEZRVUZGTEVOQlFVTXNRMEZCUXp0eFFrRkRia1U3YjBKQlJVUXNUMEZCVHl4SlFVRkpMRkZCUVZFc1EwRkJReXhKUVVGSkxFVkJRVVVzVVVGQlVTeERRVUZETEVOQlFVTTdaMEpCUTNSRExFTkJRVU1zUTBGQlFTeERRVUZETzFsQlEwb3NRMEZCUXp0VFFVRkJPMUZCUjBRc2EwSkJRV3RDTzFsQlEyaENMRWxCUVVrc1EwRkJReXhuUWtGQlowSXNRMEZCUXl4VFFVRlRMRVZCUVVVc1EwRkJReXhMUVVGTExFVkJRVVVzUlVGQlJUczdaMEpCUlhwRExGRkJRVkVzVFVGQlFTeExRVUZMTEdGQlFVd3NTMEZCU3l4MVFrRkJUQ3hMUVVGTExFTkJRVVVzU1VGQlNTd3dRMEZCUlN4SlFVRkpMRVZCUVVVN2IwSkJRM3BDTEV0QlFVc3NZVUZCWVN4RFFVRkRMRU5CUVVNN2QwSkJRMnhDTEUxQlFVMHNRMEZCUXl4WFFVRlhMRU5CUVVNc1JVRkJSU3hKUVVGSkxFVkJRVVVzWVVGQllTeEZRVUZGTEV0QlFVc3NSVUZCUlN4SlFVRkpMRVZCUVVVc1EwRkJReXhEUVVGRE8zZENRVU42UkN4TlFVRk5PM0ZDUVVOUU8yOUNRVU5FTEV0QlFVc3NjMEpCUVhOQ0xFTkJRVU1zUTBGQlF6dDNRa0ZETTBJc1ZVRkJWU3hEUVVGRExGZEJRVmNzUTBGQlF5eEZRVUZGTEZGQlFWRXNSVUZCUlN4WlFVRlpMRVZCUVVVc1MwRkJTeXhGUVVGRkxFdEJRVXNzUTBGQlF5eEpRVUZKTEVOQlFVTXNSMEZCUnl4RFFVRkRMRWxCUVVrc1JVRkJSU3hEUVVGRExFTkJRVU03ZDBKQlF5OUZMRTFCUVUwN2NVSkJRMUE3YjBKQlEwUXNTMEZCU3l4UFFVRlBMRU5CUVVNc1EwRkJRenQzUWtGRFdpeFZRVUZWTEVOQlFVTXNWMEZCVnl4RFFVRkRMRVZCUVVVc1VVRkJVU3hGUVVGRkxFOUJRVThzUlVGQlJTeEpRVUZKTEVWQlFVVXNVMEZCVXl4RlFVRkZMRVZCUVVVc1JVRkJSU3hEUVVGRExFVkJRVVVzUTBGQlF5eERRVUZETzNkQ1FVTjBSU3hOUVVGTk8zRkNRVU5RTzI5Q1FVTkVMRXRCUVVzc1RVRkJUU3hEUVVGRExFTkJRVU03ZDBKQlExZ3NWVUZCVlN4RFFVRkRMRmRCUVZjc1EwRkJReXhGUVVGRkxGRkJRVkVzUlVGQlJTeE5RVUZOTEVWQlFVVXNTVUZCU1N4RlFVRkZMRk5CUVZNc1JVRkJSU3hGUVVGRkxFVkJRVVVzUTBGQlF5eEZRVUZGTEVOQlFVTXNRMEZCUXp0M1FrRkRja1VzVFVGQlRUdHhRa0ZEVUR0dlFrRkRSQ3hQUVVGUExFTkJRVU1zUTBGQlF6dDNRa0ZEVUN4TlFVRk5PM0ZDUVVOUU8ybENRVU5HTzJkQ1FVVkVMRkZCUVZFc1RVRkJRU3hOUVVGQkxFdEJRVXNzWVVGQlRDeExRVUZMTEhWQ1FVRk1MRXRCUVVzc1EwRkJSU3hKUVVGSkxEQkRRVUZGTEVkQlFVY3NNRU5CUVVVc1IwRkJSeXhGUVVGRk8yOUNRVU0zUWl4TFFVRkxMRk5CUVZNc1EwRkJReXhEUVVGRE8zZENRVU5rTEVsQlFVa3NRMEZCUXl4TFFVRkxMRU5CUVVNc1NVRkJTU3hEUVVGRExFZEJRVWNzUTBGQlF5eExRVUZMTEVOQlFVTXNTVUZCU1RzMFFrRkJSU3hOUVVGTk8zZENRVU4wUXl4UFFVRlBMRU5CUVVNc1IwRkJSeXhEUVVGRExEWkNRVUUyUWl4SFFVRkhMRXRCUVVzc1EwRkJReXhKUVVGSkxFTkJRVU1zUjBGQlJ5eERRVUZETEV0QlFVc3NRMEZCUXl4SlFVRkpMRU5CUVVNc1EwRkJRenQzUWtGRGRrVXNWVUZCVlN4RFFVRkRMRmRCUVZjc1EwRkJReXhGUVVGRkxGRkJRVkVzUlVGQlJTeFpRVUZaTEVWQlFVVXNTMEZCU3l4RlFVRkZMRXRCUVVzc1EwRkJReXhKUVVGSkxFTkJRVU1zUjBGQlJ5eERRVUZETEV0QlFVc3NRMEZCUXl4SlFVRkpMRVZCUVVVc1EwRkJReXhEUVVGRE8zZENRVU55Uml4TlFVRk5PM0ZDUVVOUU8yOUNRVU5FTEV0QlFVc3NUMEZCVHl4RFFVRkRMRU5CUVVNN2QwSkJRMW9zVlVGQlZTeERRVUZETEZkQlFWY3NRMEZCUXl4RlFVRkZMRkZCUVZFc1JVRkJSU3hMUVVGTExFTkJRVU1zU1VGQlNTeERRVUZETEVkQlFVY3NRMEZCUXl4TFFVRkxMRVZCUVVVc1EwRkJReXhEUVVGRE8zRkNRVU0xUkR0dlFrRkRSQ3hQUVVGUExFTkJRVU1zUTBGQlF6dDNRa0ZEVUN4TlFVRk5PM0ZDUVVOUU8ybENRVU5HTzJkQ1FVVkVMRkZCUVZFc1RVRkJRU3hOUVVGQkxFdEJRVXNzWVVGQlRDeExRVUZMTEhWQ1FVRk1MRXRCUVVzc1EwRkJSU3hKUVVGSkxEQkRRVUZGTEVkQlFVY3NNRU5CUVVVc1NVRkJTU3hGUVVGRk8yOUNRVU01UWl4TFFVRkxMRTlCUVU4c1EwRkJReXhEUVVGRE8zZENRVU5hTEUxQlFVMDdjVUpCUTFBN2IwSkJRMFFzUzBGQlN5eE5RVUZOTEVOQlFVTXNRMEZCUXp0M1FrRkRXQ3hOUVVGTk8zRkNRVU5RTzI5Q1FVTkVMRTlCUVU4c1EwRkJReXhEUVVGRE8zZENRVU5RTEUxQlFVMDdjVUpCUTFBN2FVSkJRMFk3V1VGRFNDeERRVUZETEVOQlFVTXNRMEZCUXp0UlFVTk1MRU5CUVVNN1VVRkZSQ3hyUWtGQmEwSTdXVUZEYUVJc01rTkJRVEpETzFsQlF6TkRMRTFCUVUwc1EwRkJReXhuUWtGQlowSXNRMEZCUXl4VFFVRlRMRVZCUVVVc1EwRkJReXhMUVVGTExFVkJRVVVzUlVGQlJUdG5Ra0ZETTBNc1VVRkJVU3hMUVVGTExFTkJRVU1zU1VGQlNTeERRVUZETEVsQlFVa3NSVUZCUlR0dlFrRkRka0lzUzBGQlN5eGhRVUZoTEVOQlFVTXNRMEZCUXp0M1FrRkRiRUlzZVVKQlFYbENPM2RDUVVONlFpeFZRVUZWTEVOQlFVTXNWMEZCVnl4RFFVRkRMRVZCUVVVc1VVRkJVU3hGUVVGRkxHRkJRV0VzUlVGQlJTeExRVUZMTEVWQlFVVXNTMEZCU3l4RFFVRkRMRWxCUVVrc1EwRkJReXhMUVVGTExFVkJRVVVzUTBGQlF5eERRVUZETzNGQ1FVTTVSVHRwUWtGRFJqdFpRVU5JTEVOQlFVTXNRMEZCUXl4RFFVRkRPMUZCUTB3c1EwRkJRenRMUVVOR0xFTkJRVU03UVVGRFNpeERRVUZETEVOQlFVTXNSVUZCUlN4RFFVRkRJbjA9IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKFwiLi9zcmMvaW5kZXgudHNcIik7XG4iLCIiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=